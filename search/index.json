[{"categories":["Docker"],"contents":"脚本一键安装部署docker19.03\n安装脚本  使用阿里云镜像源 docker参数 native.cgroupdriver=systemd  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47  #!/bin/bash  # 安装docker # VAR SET DOCKER_VERSION=\u0026#34;19.03.8\u0026#34; echo \u0026#34;START to install docker $DOCKER_VERSION\u0026#34; export REGISTRY_MIRROR=https://registry.cn-hangzhou.aliyuncs.com # a) 检查和卸载旧版本(如果之前有安装docker) echo \u0026#34;check and uninstall old docker...\u0026#34; yum remove -y docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-selinux \\ docker-engine-selinux \\ docker-engine # b) 配置yum repository echo \u0026#34;config yum repository...\u0026#34; yum install -y yum-utils \\ device-mapper-persistent-data \\ lvm2 yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo # c) 安装并启动docker echo \u0026#34;install docker $DOCKER_VERSION\u0026#34; yum install -y docker-ce-$DOCKER_VERSION docker-ce-cli-$DOCKER_VERSION containerd.io systemctl enable docker systemctl start docker # d) 修改docker Cgroup Driver为systemd echo \u0026#34;config docker Cgroup Driver: systemd\u0026#34; sed -i \u0026#34;s#^ExecStart=/usr/bin/dockerd.*#ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd#g\u0026#34; /usr/lib/systemd/system/docker.service # e) 设置 docker 镜像，提高 docker 镜像下载速度和稳定性 echo \u0026#34;set docker mirror...\u0026#34; curl -sSL https://kuboard.cn/install-script/set_mirror.sh | sh -s ${REGISTRY_MIRROR} systemctl daemon-reload systemctl restart docker docker version   ","permalink":"http://bingerambo.com/2020-12-21-deploy-docker/","tags":["Docker","运维"],"title":"脚本部署Docker"},{"categories":["Python"],"contents":"脚本一键安装部署Python3\n安装脚本  centos系统自带默认python2 py3命令需要跟py2进行区别  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  #! /bin/bash yum -y install zlib-devel bzip2-devel libffi-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel wget gcc wget https://www.python.org/ftp/python/3.7.1/Python-3.7.1.tgz mkdir -p /usr/local/python3 tar -xf Python-3.7.1.tgz yum install libffi-devel -y cd Python-3.7.1 pwd ./configure --prefix=/usr/local/python3 make make install ln -s /usr/local/python3/bin/python3 /usr/bin/python3 ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3 echo \u0026#39;PATH=$PATH:$HOME/bin:/usr/local/python3/bin\u0026#39; \u0026gt;\u0026gt;/etc/profile echo \u0026#39;export PATH\u0026#39; \u0026gt;\u0026gt;/etc/profile source /etc/profile   ","permalink":"http://bingerambo.com/2020-12-19-install-python3/","tags":["Python","运维"],"title":"脚本部署Python3"},{"categories":["K8S"],"contents":"如何使用perf-test的clusterloader进行性能测试\n1 K8S的性能指标：SLIs/SLOs K8S的SLI (服务等级指标) 和 SLO (服务等级目标)： Kubernetes 社区提供的K8S系统性能测试指标定义。\n社区参考文档：Kubernetes scalability and performance SLIs/SLOs\n目前社区提供的官方正式的性能指标有3个，如下表：\n   Status SLI SLO     Official Latency of mutating API calls for single objects for every (resource, verb) pair, measured as 99th percentile over last 5 minutes In default Kubernetes installation, for every (resource, verb) pair, excluding virtual and aggregated resources and Custom Resource Definitions, 99th percentile per cluster-day1 \u0026lt;= 1s   Official Latency of non-streaming read-only API calls for every (resource, scope pair, measured as 99th percentile over last 5 minutes In default Kubernetes installation, for every (resource, scope) pair, excluding virtual and aggregated resources and Custom Resource Definitions, 99th percentile per cluster-day1 (a) \u0026lt;= 1s if scope=resource (b) \u0026lt;= 5s if scope=namespace (c) \u0026lt;= 30s if scope=cluster   Official Startup latency of schedulable stateless pods, excluding time to pull images and run init containers, measured from pod creation timestamp to when all its containers are reported as started and observed via watch, measured as 99th percentile over last 5 minutes In default Kubernetes installation, 99th percentile per cluster-day1 \u0026lt;= 5s    2 clusterloader准备  从github上拉取perf-test项目，其中包含clusterloader2。perf-tests位置为：$GOPATH/src/k8s.io/perf-tests  需要选择与测试k8s集群匹配的版本，这里选择了1.14版本   进入clusterloader2目录，进行编译  1 2 3  export GOPATH=/home/wangb/goprojects cd $GOPATH/src/k8s.io/perf-tests/clusterloader2 go build -o clusterloader \u0026#39;./cmd/\u0026#39;   clusterloader2的测试配置文件在testing目录下。可以参考修改配置 按修改后的测试配置文件，指定参数变量，执行clusterloader测试  3 clusterloader测试 1. 运行命令 说明：运行命令前，需要根据测试场景，修改测试配置文件中的变量参数，配置文件包括有config.yaml， rc.yaml，deployment.yaml 具体配置参数说明，见下文。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  # 进入clusterloader可执行文件目录，配置文件也需转移到了此位置 cd /home/wangb/perf-test/clusterloader2 # ssh访问参数 export KUBE_SSH_KEY_PATH=/root/.ssh/id_rsa # master节点信息 MASTER_NAME=node1 TEST_MASTER_IP=192.168.182.101 TEST_MASTER_INTERNAL_IP=192.168.182.101 KUBE_CONFIG=${HOME}/.kube/config # 测试配置文件 TEST_CONFIG=\u0026#39;/home/wangb/perf-test/clusterloader2/testing/density/config2.yaml\u0026#39; # 测试报告目录位置 REPORT_DIR=\u0026#39;./reports\u0026#39; # 测试日志打印文件 LOG_FILE=\u0026#39;test.log\u0026#39; ./clusterloader --kubeconfig=$KUBE_CONFIG \\  --mastername=$TEST_MASTER_IP \\  --masterip=$MASTER_IP \\  --master-internal-ip=TEST_MASTER_INTERNAL_IP \\  --testconfig=$TEST_CONFIG \\  --report-dir=$REPORT_DIR \\  --alsologtostderr 2\u0026gt;\u0026amp;1 | tee $LOG_FILE   运行命令可以指定nodes数量，不过这里默认使用集群全部节点。\n2. 测试配置文件 test config（默认） density 测试配置   Steps is the procedures you defined. Each step might contain phases, measurements Meansurement defines what you want to supervise or capture. Phase describes the attributes of some certain tasks.     This config defines the following steps:   Starting measurements : don’t care about what happens during preparation. Starting saturation pod measurements : same as above Creating saturation pods : the first case is saturation pods Collecting saturation pod measurements Starting latency pod measurements Creating latency pods : the second case is latency pods Waiting for latency pods to be running Deleting latency pods Waiting for latency pods to be deleted Collecting pod startup latency Deleting saturation pods Waiting for saturation pods to be deleted Collecting measurements     So we can see the testing mainly gathers measurements during the CRUD of saturation pods and latency pods:\n saturation pods: pods in deployments with quite a large repliacas latency pods: pods in deployments with one replicas  So you see the differences between the two modes. When saturation pods are created, replicas-controller in kube-controller-manager is handling one event. But in terms of latency pods, it’s hundreds of events. But what’s the difference anyway? It’s because the various rate-limiter inside kubernetes affects the performance of scheduler and controller-manager.\nIn each case, what we’re concerned is the number of pods, deployments and namespaces. We all know that kubernetes limits the pods/node, pods/namespace, so it’s quite essential to adust relative parameters to achieve a reasonable load.\ntest config.yaml（默认配置） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203  # ASSUMPTIONS:# - Underlying cluster should have 100+ nodes.# - Number of nodes should be divisible by NODES_PER_NAMESPACE (default 100).#Constants{{$DENSITY_RESOURCE_CONSTRAINTS_FILE := DefaultParam .DENSITY_RESOURCE_CONSTRAINTS_FILE \u0026#34;\u0026#34;}}{{$NODE_MODE := DefaultParam .NODE_MODE \u0026#34;allnodes\u0026#34;}}{{$NODES_PER_NAMESPACE := DefaultParam .NODES_PER_NAMESPACE 100}}{{$PODS_PER_NODE := DefaultParam .PODS_PER_NODE 30}}{{$DENSITY_TEST_THROUGHPUT := DefaultParam .DENSITY_TEST_THROUGHPUT 20}}# LATENCY_POD_MEMORY and LATENCY_POD_CPU are calculated for 1-core 4GB node.# Increasing allocation of both memory and cpu by 10%# decreases the value of priority function in scheduler by one point.# This results in decreased probability of choosing the same node again.{{$LATENCY_POD_CPU := DefaultParam .LATENCY_POD_CPU 100}}{{$LATENCY_POD_MEMORY := DefaultParam .LATENCY_POD_MEMORY 350}}{{$MIN_LATENCY_PODS := 500}}{{$MIN_SATURATION_PODS_TIMEOUT := 180}}{{$ENABLE_CHAOSMONKEY := DefaultParam .ENABLE_CHAOSMONKEY false}}{{$ENABLE_SYSTEM_POD_METRICS:= DefaultParam .ENABLE_SYSTEM_POD_METRICS true}}{{$ENABLE_RESTART_COUNT_CHECK := DefaultParam .ENABLE_RESTART_COUNT_CHECK false}}{{$RESTART_COUNT_THRESHOLD_OVERRIDES:= DefaultParam .RESTART_COUNT_THRESHOLD_OVERRIDES \u0026#34;\u0026#34;}}#Variables{{$namespaces := DivideInt .Nodes $NODES_PER_NAMESPACE}}{{$podsPerNamespace := MultiplyInt $PODS_PER_NODE $NODES_PER_NAMESPACE}}{{$totalPods := MultiplyInt $podsPerNamespace $namespaces}}{{$latencyReplicas := DivideInt (MaxInt $MIN_LATENCY_PODS .Nodes) $namespaces}}{{$totalLatencyPods := MultiplyInt $namespaces $latencyReplicas}}{{$saturationRCTimeout := DivideFloat $totalPods $DENSITY_TEST_THROUGHPUT | AddInt $MIN_SATURATION_PODS_TIMEOUT}}# saturationRCHardTimeout must be at least 20m to make sure that ~10m node# failure won\u0026#39;t fail the test. See https://github.com/kubernetes/kubernetes/issues/73461#issuecomment-467338711{{$saturationRCHardTimeout := MaxInt $saturationRCTimeout 1200}}name:densityautomanagedNamespaces:{{$namespaces}}tuningSets:- name:Uniform5qpsqpsLoad:qps:5{{if $ENABLE_CHAOSMONKEY}}chaosMonkey:nodeFailure:failureRate:0.01interval:1mjitterFactor:10.0simulatedDowntime:10m{{end}}steps:- measurements:- Identifier:APIResponsivenessMethod:APIResponsivenessParams:action:reset- Identifier:TestMetricsMethod:TestMetricsParams:action:startnodeMode:{{$NODE_MODE}}resourceConstraints:{{$DENSITY_RESOURCE_CONSTRAINTS_FILE}}systemPodMetricsEnabled:{{$ENABLE_SYSTEM_POD_METRICS}}restartCountThresholdOverrides:{{YamlQuote $RESTART_COUNT_THRESHOLD_OVERRIDES 4}}enableRestartCountCheck:{{$ENABLE_RESTART_COUNT_CHECK}}# Create saturation pods- measurements:- Identifier:SaturationPodStartupLatencyMethod:PodStartupLatencyParams:action:startlabelSelector:group = saturationthreshold:{{$saturationRCTimeout}}s- measurements:- Identifier:WaitForRunningSaturationRCsMethod:WaitForControlledPodsRunningParams:action:startapiVersion:v1kind:ReplicationControllerlabelSelector:group = saturationoperationTimeout:{{$saturationRCHardTimeout}}s- phases:- namespaceRange:min:1max:{{$namespaces}}replicasPerNamespace:1tuningSet:Uniform5qpsobjectBundle:- basename:saturation-rcobjectTemplatePath:rc.yamltemplateFillMap:Replicas:{{$podsPerNamespace}}Group:saturationCpuRequest:1mMemoryRequest:10M- measurements:- Identifier:SchedulingThroughputMethod:SchedulingThroughputParams:action:startlabelSelector:group = saturation- measurements:- Identifier:WaitForRunningSaturationRCsMethod:WaitForControlledPodsRunningParams:action:gather- measurements:- Identifier:SaturationPodStartupLatencyMethod:PodStartupLatencyParams:action:gather- measurements:- Identifier:SchedulingThroughputMethod:SchedulingThroughputParams:action:gather- name:Creating saturation pods# Create latency pods- measurements:- Identifier:PodStartupLatencyMethod:PodStartupLatencyParams:action:startlabelSelector:group = latency- measurements:- Identifier:WaitForRunningLatencyRCsMethod:WaitForControlledPodsRunningParams:action:startapiVersion:v1kind:ReplicationControllerlabelSelector:group = latencyoperationTimeout:15m- phases:- namespaceRange:min:1max:{{$namespaces}}replicasPerNamespace:{{$latencyReplicas}}tuningSet:Uniform5qpsobjectBundle:- basename:latency-pod-rcobjectTemplatePath:rc.yamltemplateFillMap:Replicas:1Group:latencyCpuRequest:{{$LATENCY_POD_CPU}}mMemoryRequest:{{$LATENCY_POD_MEMORY}}M- measurements:- Identifier:WaitForRunningLatencyRCsMethod:WaitForControlledPodsRunningParams:action:gather- name:Creating latency pods# Remove latency pods- phases:- namespaceRange:min:1max:{{$namespaces}}replicasPerNamespace:0tuningSet:Uniform5qpsobjectBundle:- basename:latency-pod-rcobjectTemplatePath:rc.yaml- measurements:- Identifier:WaitForRunningLatencyRCsMethod:WaitForControlledPodsRunningParams:action:gather- measurements:- Identifier:PodStartupLatencyMethod:PodStartupLatencyParams:action:gather- name:Deleting latancy pods# Delete pods- phases:- namespaceRange:min:1max:{{$namespaces}}replicasPerNamespace:0tuningSet:Uniform5qpsobjectBundle:- basename:saturation-rcobjectTemplatePath:rc.yaml- measurements:- Identifier:WaitForRunningSaturationRCsMethod:WaitForControlledPodsRunningParams:action:gather- name:Deleting saturation pods# Collect measurements- measurements:- Identifier:APIResponsivenessMethod:APIResponsivenessParams:action:gather- Identifier:TestMetricsMethod:TestMetricsParams:action:gathersystemPodMetricsEnabled:{{$ENABLE_SYSTEM_POD_METRICS}}restartCountThresholdOverrides:{{YamlQuote $RESTART_COUNT_THRESHOLD_OVERRIDES 4}}enableRestartCountCheck:{{$ENABLE_RESTART_COUNT_CHECK}}  rc.yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  apiVersion:v1kind:ReplicationControllermetadata:name:{{.Name}}labels:group:{{.Group}}spec:replicas:{{.Replicas}}selector:name:{{.Name}}template:metadata:labels:name:{{.Name}}group:{{.Group}}spec:containers:- image:k8s.gcr.io/pause:3.1imagePullPolicy:IfNotPresentname:{{.Name}}ports:resources:requests:cpu:{{.CpuRequest}}memory:{{.MemoryRequest}}# Add not-ready/unreachable tolerations for 15 minutes so that node# failure doesn\u0026#39;t trigger pod deletion.tolerations:- key:\u0026#34;node.kubernetes.io/not-ready\u0026#34;operator:\u0026#34;Exists\u0026#34;effect:\u0026#34;NoExecute\u0026#34;tolerationSeconds:900- key:\u0026#34;node.kubernetes.io/unreachable\u0026#34;operator:\u0026#34;Exists\u0026#34;effect:\u0026#34;NoExecute\u0026#34;tolerationSeconds:900  deployment.yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38  apiVersion:apps/v1kind:Deploymentmetadata:name:{{.Name}}labels:group:{{.Group}}spec:replicas:{{.Replicas}}selector:matchLabels:name:{{.Name}}template:metadata:labels:name:{{.Name}}group:{{.Group}}spec:containers:- image:k8s.gcr.io/pause:3.1imagePullPolicy:IfNotPresentname:{{.Name}}ports:resources:requests:cpu:{{.CpuRequest}}memory:{{.MemoryRequest}}# Add not-ready/unreachable tolerations for 15 minutes so that node# failure doesn\u0026#39;t trigger pod deletion.tolerations:- key:\u0026#34;node.kubernetes.io/not-ready\u0026#34;operator:\u0026#34;Exists\u0026#34;effect:\u0026#34;NoExecute\u0026#34;tolerationSeconds:900- key:\u0026#34;node.kubernetes.io/unreachable\u0026#34;operator:\u0026#34;Exists\u0026#34;effect:\u0026#34;NoExecute\u0026#34;tolerationSeconds:900  3. clusterloader2 源码简析 解析测试配置信息，执行测试测试用例 clusterloader2/cmd/clusterloader.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  void main(){ // 构造clusterLoaderConfig  // 构造framework，即各种k8s client  f, err := framework.NewFramework( \u0026amp;clusterLoaderConfig.ClusterConfig, getClientsNumber(clusterLoaderConfig.ClusterConfig.Nodes), ) // 遍历测试配置文件（可多个），按配置用例运行测试  for _, clusterLoaderConfig.TestConfigPath = range testConfigPaths { test.RunTest(f, prometheusFramework, \u0026amp;clusterLoaderConfig) } }   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  // RunTest runs test based on provided test configuration. func RunTest(clusterFramework, prometheusFramework *framework.Framework, clusterLoaderConfig *config.ClusterLoaderConfig) *errors.ErrorList { // simpleContext上下文信息  ctx := CreateContext(clusterLoaderConfig, clusterFramework, prometheusFramework, state.NewState()) testConfigFilename := filepath.Base(clusterLoaderConfig.TestConfigPath) // 按参数 设置override config 和 nodes参数  mapping, errList := config.GetMapping(clusterLoaderConfig) if errList != nil { return errList } // 使用emplateProvider根据mapping信息把testConfig的模板文件渲染成可用的api.Config  testConfig, err := ctx.GetTemplateProvider().TemplateToConfig(testConfigFilename, mapping) if err != nil { return errors.NewErrorList(fmt.Errorf(\u0026#34;config reading error: %v\u0026#34;, err)) } return Test.ExecuteTest(ctx, testConfig) } // api.Config 定义 // Config is a structure that represents configuration // for a single test scenario. type Config struct { // Name of the test case.  Name string `json: name` // AutomanagedNamespaces is a number of automanaged namespaces.  AutomanagedNamespaces int32 `json: automanagedNamespaces` // Steps is a sequence of test steps executed in serial.  Steps []Step `json: steps` // TuningSets is a collection of tuning sets that can be used by steps.  TuningSets []TuningSet `json: tuningSets` // ChaosMonkey is a config for simulated component failures.  ChaosMonkey ChaosMonkeyConfig `json: chaosMonkey` }   RunTest 又调用了 ExecuteTest，示例代码如下： 循环steps，按顺序执行ExecuteStep\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  // ExecuteTest executes test based on provided configuration. func (ste *simpleTestExecutor) ExecuteTest(ctx Context, conf *api.Config) { // auto set test namespace  ctx.GetClusterFramework().SetAutomanagedNamespacePrefix(fmt.Sprintf(\u0026#34;test-%s\u0026#34;, util.RandomDNS1123String(6))) // clear test resource  defer cleanupResources(ctx) // create test namespace  err = ctx.GetClusterFramework().CreateAutomanagedNamespaces(int(conf.AutomanagedNamespaces)) // 遍历steps，分步执行，如果某step出错stepErr，则退出。  for i := range conf.Steps { if stepErrList := ste.ExecuteStep(ctx, \u0026amp;conf.Steps[i]); !stepErrList.IsEmpty() { errList.Concat(stepErrList) if isErrsCritical(stepErrList) { return errList } } } // 输出测试汇总信息  for _, summary := range ctx.GetMeasurementManager().GetSummaries() { if ctx.GetClusterLoaderConfig().ReportDir == \u0026#34;\u0026#34; { klog.Infof(\u0026#34;%v: %v\u0026#34;, summary.SummaryName(), summary.SummaryContent()) } else { // TODO(krzysied): Remember to keep original filename style for backward compatibility.  filePath := path.Join(ctx.GetClusterLoaderConfig().ReportDir, summary.SummaryName()+\u0026#34;_\u0026#34;+conf.Name+\u0026#34;_\u0026#34;+summary.SummaryTime().Format(time.RFC3339)+\u0026#34;.\u0026#34;+summary.SummaryExt()) ioutil.WriteFile(filePath, []byte(summary.SummaryContent()), 0644) } } }   可以看出 每个step中的Measurements和Phases都是并发执行的。\n而且在每个step中，要么执行measurement.exec，要么执行phase.exec\nclusterloader2/pkg/test/simple_test_executor.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  // ExecuteStep executes single test step based on provided step configuration. func (ste *simpleTestExecutor) ExecuteStep(ctx Context, step *api.Step) *errors.ErrorList { var wg wait.Group errList := errors.NewErrorList() if len(step.Measurements) \u0026gt; 0 { for i := range step.Measurements { // index is created to make i value unchangeable during thread execution.  index := i wg.Start(func() { err := ctx.GetMeasurementManager().Execute(step.Measurements[index].Method, step.Measurements[index].Identifier, step.Measurements[index].Params) if err != nil { errList.Append(fmt.Errorf(\u0026#34;measurement call %s - %s error: %v\u0026#34;, step.Measurements[index].Method, step.Measurements[index].Identifier, err)) } }) } } else { for i := range step.Phases { phase := \u0026amp;step.Phases[i] wg.Start(func() { if phaseErrList := ste.ExecutePhase(ctx, phase); !phaseErrList.IsEmpty() { errList.Concat(phaseErrList) } }) } } wg.Wait() if step.Name != \u0026#34;\u0026#34; { klog.Infof(\u0026#34;Step \\\u0026#34;%s\\\u0026#34; ended\u0026#34;, step.Name) } return errList }   measurement Execute 根据 methodName, identifier 创建measurementInstance。目前有17种measurementInstance。比如：apiResponsivenessMeasurement；podStartupLatencyMeasurement等等\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  // Execute executes measurement based on provided identifier, methodName and params. func (mm *MeasurementManager) Execute(methodName string, identifier string, params map[string]interface{}) error { measurementInstance, err := mm.getMeasurementInstance(methodName, identifier) if err != nil { return err } config := \u0026amp;MeasurementConfig{ ClusterFramework: mm.clusterFramework, PrometheusFramework: mm.prometheusFramework, Params: params, TemplateProvider: mm.templateProvider, Identifier: identifier, CloudProvider: mm.clusterLoaderConfig.ClusterConfig.Provider, } summaries, err := measurementInstance.Execute(config) mm.summaries = append(mm.summaries, summaries...) return err }   Measurement处理 以podStartupLatencyMeasurement为例分析，action参数分为start和gather，分别表示测试启动和测试收集\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180  // Execute supports two actions: // - start - Starts to observe pods and pods events. // - gather - Gathers and prints current pod latency data. // Does NOT support concurrency. Multiple calls to this measurement // shouldn\u0026#39;t be done within one step. func (p *podStartupLatencyMeasurement) Execute(config *measurement.MeasurementConfig) ([]measurement.Summary, error) { action, err := util.GetString(config.Params, \u0026#34;action\u0026#34;) if err != nil { return nil, err } switch action { case \u0026#34;start\u0026#34;: p.namespace, err = util.GetStringOrDefault(config.Params, \u0026#34;namespace\u0026#34;, metav1.NamespaceAll) if err != nil { return nil, err } p.labelSelector, err = util.GetStringOrDefault(config.Params, \u0026#34;labelSelector\u0026#34;, \u0026#34;\u0026#34;) if err != nil { return nil, err } p.fieldSelector, err = util.GetStringOrDefault(config.Params, \u0026#34;fieldSelector\u0026#34;, \u0026#34;\u0026#34;) if err != nil { return nil, err } p.threshold, err = util.GetDurationOrDefault(config.Params, \u0026#34;threshold\u0026#34;, defaultPodStartupLatencyThreshold) if err != nil { return nil, err } return nil, p.start(config.ClusterFramework.GetClientSets().GetClient()) case \u0026#34;gather\u0026#34;: return p.gather(config.ClusterFramework.GetClientSets().GetClient(), config.Identifier) default: return nil, fmt.Errorf(\u0026#34;unknown action %v\u0026#34;, action) } } // 测试启动 func (p *podStartupLatencyMeasurement) start(c clientset.Interface) error { if p.isRunning { klog.Infof(\u0026#34;%s: pod startup latancy measurement already running\u0026#34;, p) return nil } p.selectorsString = measurementutil.CreateSelectorsString(p.namespace, p.labelSelector, p.fieldSelector) klog.Infof(\u0026#34;%s: starting pod startup latency measurement...\u0026#34;, p) p.isRunning = true p.stopCh = make(chan struct{}) p.informer = informer.NewInformer( c, \u0026#34;pods\u0026#34;, p.namespace, p.fieldSelector, p.labelSelector, // 使用checkPod回调处理，一旦pod状态为running，则更新测试工具保存的pod的start时间  p.checkPod, ) // 启动了监听该范围内的pod资源  go p.informer.Run(p.stopCh) timeoutCh := make(chan struct{}) timeoutTimer := time.AfterFunc(informerSyncTimeout, func() { close(timeoutCh) }) defer timeoutTimer.Stop() if !cache.WaitForCacheSync(timeoutCh, p.informer.HasSynced) { return fmt.Errorf(\u0026#34;timed out waiting for caches to sync\u0026#34;) } return nil } // 测试收集 func (p *podStartupLatencyMeasurement) gather(c clientset.Interface, identifier string) ([]measurement.Summary, error) { klog.Infof(\u0026#34;%s: gathering pod startup latency measurement...\u0026#34;, p) // 检查podStartupLatencyMeasurement 是否已启动  if !p.isRunning { return nil, fmt.Errorf(\u0026#34;metric %s has not been started\u0026#34;, podStartupLatencyMeasurementName) } scheduleLag := make([]measurementutil.LatencyData, 0) startupLag := make([]measurementutil.LatencyData, 0) watchLag := make([]measurementutil.LatencyData, 0) schedToWatchLag := make([]measurementutil.LatencyData, 0) e2eLag := make([]measurementutil.LatencyData, 0) p.stop() // 通过schedEvents方式获取调度器事件的create时间  if err := p.gatherScheduleTimes(c); err != nil { return nil, err } // 遍历pod-createTime map，按pod生命周期逻辑，进行条件检查  for key, create := range p.createTimes { sched, hasSched := p.scheduleTimes[key] if !hasSched { klog.Infof(\u0026#34;%s: failed to find schedule time for %v\u0026#34;, p, key) } run, ok := p.runTimes[key] if !ok { klog.Infof(\u0026#34;%s: failed to find run time for %v\u0026#34;, p, key) continue } watch, ok := p.watchTimes[key] if !ok { klog.Infof(\u0026#34;%s: failed to find watch time for %v\u0026#34;, p, key) continue } node, ok := p.nodeNames[key] if !ok { klog.Infof(\u0026#34;%s: failed to find node for %v\u0026#34;, p, key) continue } // 计算各种延时，重要。。。  if hasSched { scheduleLag = append(scheduleLag, podLatencyData{Name: key, Node: node, Latency: sched.Time.Sub(create.Time)}) startupLag = append(startupLag, podLatencyData{Name: key, Node: node, Latency: run.Time.Sub(sched.Time)}) schedToWatchLag = append(schedToWatchLag, podLatencyData{Name: key, Node: node, Latency: watch.Time.Sub(sched.Time)}) } watchLag = append(watchLag, podLatencyData{Name: key, Node: node, Latency: watch.Time.Sub(run.Time)}) e2eLag = append(e2eLag, podLatencyData{Name: key, Node: node, Latency: watch.Time.Sub(create.Time)}) } // 把各个pod的各延时指标值进行排序，排序目的是为了方便进行数据统计  sort.Sort(measurementutil.LatencySlice(scheduleLag)) sort.Sort(measurementutil.LatencySlice(startupLag)) sort.Sort(measurementutil.LatencySlice(watchLag)) sort.Sort(measurementutil.LatencySlice(schedToWatchLag)) sort.Sort(measurementutil.LatencySlice(e2eLag)) p.printLatencies(scheduleLag, \u0026#34;worst create-to-schedule latencies\u0026#34;) p.printLatencies(startupLag, \u0026#34;worst schedule-to-run latencies\u0026#34;) p.printLatencies(watchLag, \u0026#34;worst run-to-watch latencies\u0026#34;) p.printLatencies(schedToWatchLag, \u0026#34;worst schedule-to-watch latencies\u0026#34;) p.printLatencies(e2eLag, \u0026#34;worst e2e latencies\u0026#34;) podStartupLatency := \u0026amp;podStartupLatency{ CreateToScheduleLatency: measurementutil.ExtractLatencyMetrics(scheduleLag), ScheduleToRunLatency: measurementutil.ExtractLatencyMetrics(startupLag), RunToWatchLatency: measurementutil.ExtractLatencyMetrics(watchLag), ScheduleToWatchLatency: measurementutil.ExtractLatencyMetrics(schedToWatchLag), E2ELatency: measurementutil.ExtractLatencyMetrics(e2eLag), } // 成功率  var err error if successRatio := float32(len(e2eLag)) / float32(len(p.createTimes)); successRatio \u0026lt; successfulStartupRatioThreshold { err = fmt.Errorf(\u0026#34;only %v%% of all pods were scheduled successfully\u0026#34;, successRatio*100) klog.Errorf(\u0026#34;%s: %v\u0026#34;, p, err) } // 设置阈值，这里各百分位数使用的都是相同阈值  podStartupLatencyThreshold := \u0026amp;measurementutil.LatencyMetric{ Perc50: p.threshold, Perc90: p.threshold, Perc99: p.threshold, } // 进行延时指标验证，判断是否满足slos，不满足则输出错误信息  if slosErr := podStartupLatency.E2ELatency.VerifyThreshold(podStartupLatencyThreshold); slosErr != nil { err = errors.NewMetricViolationError(\u0026#34;pod startup\u0026#34;, slosErr.Error()) klog.Errorf(\u0026#34;%s: %v\u0026#34;, p, err) } content, jsonErr := util.PrettyPrintJSON(podStartupLatencyToPerfData(podStartupLatency)) if err != nil { return nil, jsonErr } summary := measurement.CreateSummary(fmt.Sprintf(\u0026#34;%s_%s\u0026#34;, podStartupLatencyMeasurementName, identifier), \u0026#34;json\u0026#34;, content) return []measurement.Summary{summary}, err } // VerifyThreshold verifies latency metric against given percentile thresholds. func (metric *LatencyMetric) VerifyThreshold(threshold *LatencyMetric) error { if metric.Perc50 \u0026gt; threshold.Perc50 { return fmt.Errorf(\u0026#34;too high latency 50th percentile: %v\u0026#34;, metric.Perc50) } if metric.Perc90 \u0026gt; threshold.Perc90 { return fmt.Errorf(\u0026#34;too high latency 90th percentile: %v\u0026#34;, metric.Perc90) } if metric.Perc99 \u0026gt; threshold.Perc99 { return fmt.Errorf(\u0026#34;too high latency 99th percentile: %v\u0026#34;, metric.Perc99) } return nil }   Phases处理 Phases处理，实际上就是对配置中的ObjectBundle进行处理, ste.ExecuteObject\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  // ExecutePhase executes single test phase based on provided phase configuration. func (ste *simpleTestExecutor) ExecutePhase(ctx Context, phase *api.Phase) *errors.ErrorList { // TODO: add tuning set  errList := errors.NewErrorList() nsList := createNamespacesList(ctx, phase.NamespaceRange) tuningSet, err := ctx.GetTuningSetFactory().CreateTuningSet(phase.TuningSet) instances, exists := ctx.GetState().GetNamespacesState().Get(nsName, id) // // ExecuteObject executes single test object operation based on provided object configuration.  ste.ExecuteObject(ctx, \u0026amp;phase.ObjectBundle[j], nsName, replicaIndex, XXX) tuningSet.Execute(actions) }   4. 部署测试 .1 k8s-2节点环境 在本地虚拟机2节点的测试环境中，需要修改测试配置文件和pod部署脚本。 测试配置文件主要修改参数有\n  Nodes，属于配置文件上下文参数，如果不指定，测试工具会抓取实际环境中的可用的节点数，进行设置\n  NODES_PER_NAMESPACE， 每个ns下的nodes数。这里需注意: NODES \u0026gt; NODES_PER_NAMESPACE\n  PODS_PER_NODE，每个节点下的pod数\n  MIN_LATENCY_PODS这个数值会跟 PODS_PER_NODE比较 选取最大的，作为LATENCY测试的参数。因为LATENCY测试一般使用较多pod 数，即$MIN_LATENCY_PODS\n  测试中会有测试使用的资源参数，这里需要对实际情况进行config.yaml调整。\n LATENCY_POD_CPU LATENCY_POD_MEMORY 其它自定义资源数量，可以在config.yaml或者rc.yaml和deployment文件中添加配置    .1 部署config.yaml 这里主要修改如下：\n  上述的测试配置参数\n  主要修改参数有\n NODES_PER_NAMESPACE PODS_PER_NODE MIN_LATENCY_PODS LATENCY_POD_CPU LATENCY_POD_MEMORY DENSITY_TEST_THROUGHPUT    measurement-TestMetrics 原有测试工具解析收集Metrics操作异常导致测试失败，详见后面问题描述\n  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206  # ASSUMPTIONS:# - Underlying cluster should have 100+ nodes.# - Number of nodes should be divisible by NODES_PER_NAMESPACE (default 100).#Constants{{$DENSITY_RESOURCE_CONSTRAINTS_FILE := DefaultParam .DENSITY_RESOURCE_CONSTRAINTS_FILE \u0026#34;\u0026#34;}}#{{$NODE_MODE := DefaultParam .NODE_MODE \u0026#34;allnodes\u0026#34;}}{{$NODE_MODE := DefaultParam .NODE_MODE \u0026#34;master\u0026#34;}}{{$NODES_PER_NAMESPACE := DefaultParam .NODES_PER_NAMESPACE 1}}{{$PODS_PER_NODE := DefaultParam .PODS_PER_NODE 2}}{{$DENSITY_TEST_THROUGHPUT := DefaultParam .DENSITY_TEST_THROUGHPUT 20}}# LATENCY_POD_MEMORY and LATENCY_POD_CPU are calculated for 1-core 4GB node.# Increasing allocation of both memory and cpu by 10%# decreases the value of priority function in scheduler by one point.# This results in decreased probability of choosing the same node again.{{$LATENCY_POD_CPU := DefaultParam .LATENCY_POD_CPU 5}}{{$LATENCY_POD_MEMORY := DefaultParam .LATENCY_POD_MEMORY 3}}{{$MIN_LATENCY_PODS := 20}}{{$MIN_SATURATION_PODS_TIMEOUT := 180}}{{$ENABLE_CHAOSMONKEY := DefaultParam .ENABLE_CHAOSMONKEY false}}{{$ENABLE_SYSTEM_POD_METRICS:= DefaultParam .ENABLE_SYSTEM_POD_METRICS false}}{{$ENABLE_RESTART_COUNT_CHECK := DefaultParam .ENABLE_RESTART_COUNT_CHECK false}}{{$RESTART_COUNT_THRESHOLD_OVERRIDES:= DefaultParam .RESTART_COUNT_THRESHOLD_OVERRIDES \u0026#34;\u0026#34;}}#Variables{{$namespaces := DivideInt .Nodes $NODES_PER_NAMESPACE}}{{$podsPerNamespace := MultiplyInt $PODS_PER_NODE $NODES_PER_NAMESPACE}}{{$totalPods := MultiplyInt $podsPerNamespace $namespaces}}{{$latencyReplicas := DivideInt (MaxInt $MIN_LATENCY_PODS .Nodes) $namespaces}}{{$totalLatencyPods := MultiplyInt $namespaces $latencyReplicas}}{{$saturationRCTimeout := DivideFloat $totalPods $DENSITY_TEST_THROUGHPUT | AddInt $MIN_SATURATION_PODS_TIMEOUT}}# saturationRCHardTimeout must be at least 20m to make sure that ~10m node# failure won\u0026#39;t fail the test. See https://github.com/kubernetes/kubernetes/issues/73461#issuecomment-467338711{{$saturationRCHardTimeout := MaxInt $saturationRCTimeout 1200}}name:densityautomanagedNamespaces:{{$namespaces}}tuningSets:- name:Uniform5qpsqpsLoad:qps:5{{if $ENABLE_CHAOSMONKEY}}chaosMonkey:nodeFailure:failureRate:0.01interval:1mjitterFactor:10.0simulatedDowntime:10m{{end}}steps:- measurements:- Identifier:APIResponsivenessMethod:APIResponsivenessParams:action:reset- Identifier:TestMetricsMethod:TestMetricsParams:action:startnodeMode:{{$NODE_MODE}}resourceConstraints:{{$DENSITY_RESOURCE_CONSTRAINTS_FILE}}systemPodMetricsEnabled:{{$ENABLE_SYSTEM_POD_METRICS}}restartCountThresholdOverrides:{{YamlQuote $RESTART_COUNT_THRESHOLD_OVERRIDES 4}}enableRestartCountCheck:{{$ENABLE_RESTART_COUNT_CHECK}}# Create saturation pods- measurements:- Identifier:SaturationPodStartupLatencyMethod:PodStartupLatencyParams:action:startlabelSelector:group = saturationthreshold:{{$saturationRCTimeout}}s- measurements:- Identifier:WaitForRunningSaturationRCsMethod:WaitForControlledPodsRunningParams:action:startapiVersion:v1kind:ReplicationControllerlabelSelector:group = saturationoperationTimeout:{{$saturationRCHardTimeout}}s- phases:- namespaceRange:min:1max:{{$namespaces}}replicasPerNamespace:1tuningSet:Uniform5qpsobjectBundle:- basename:saturation-rcobjectTemplatePath:rc.yamltemplateFillMap:Replicas:{{$podsPerNamespace}}Group:saturationCpuRequest:1mMemoryRequest:10M- measurements:- Identifier:SchedulingThroughputMethod:SchedulingThroughputParams:action:startlabelSelector:group = saturation- measurements:- Identifier:WaitForRunningSaturationRCsMethod:WaitForControlledPodsRunningParams:action:gather- measurements:- Identifier:SaturationPodStartupLatencyMethod:PodStartupLatencyParams:action:gather- measurements:- Identifier:SchedulingThroughputMethod:SchedulingThroughputParams:action:gather- name:Creating saturation pods# Create latency pods- measurements:- Identifier:PodStartupLatencyMethod:PodStartupLatencyParams:action:startlabelSelector:group = latency- measurements:- Identifier:WaitForRunningLatencyRCsMethod:WaitForControlledPodsRunningParams:action:startapiVersion:v1kind:ReplicationControllerlabelSelector:group = latencyoperationTimeout:15m- phases:- namespaceRange:min:1max:{{$namespaces}}replicasPerNamespace:{{$latencyReplicas}}tuningSet:Uniform5qpsobjectBundle:- basename:latency-pod-rcobjectTemplatePath:rc.yamltemplateFillMap:Replicas:1Group:latencyCpuRequest:{{$LATENCY_POD_CPU}}mMemoryRequest:{{$LATENCY_POD_MEMORY}}M- measurements:- Identifier:WaitForRunningLatencyRCsMethod:WaitForControlledPodsRunningParams:action:gather- name:Creating latency pods# Remove latency pods- phases:- namespaceRange:min:1max:{{$namespaces}}replicasPerNamespace:0tuningSet:Uniform5qpsobjectBundle:- basename:latency-pod-rcobjectTemplatePath:rc.yaml- measurements:- Identifier:WaitForRunningLatencyRCsMethod:WaitForControlledPodsRunningParams:action:gather- measurements:- Identifier:PodStartupLatencyMethod:PodStartupLatencyParams:action:gather- name:Deleting latancy pods# Delete pods- phases:- namespaceRange:min:1max:{{$namespaces}}replicasPerNamespace:0tuningSet:Uniform5qpsobjectBundle:- basename:saturation-rcobjectTemplatePath:rc.yaml- measurements:- Identifier:WaitForRunningSaturationRCsMethod:WaitForControlledPodsRunningParams:action:gather- name:Deleting saturation pods# Collect measurements- measurements:- Identifier:APIResponsivenessMethod:APIResponsivenessParams:action:gather- Identifier:TestMetricsMethod:TestMetricsParams:action:gathersystemPodMetricsEnabled:{{$ENABLE_SYSTEM_POD_METRICS}}restartCountThresholdOverrides:{{YamlQuote $RESTART_COUNT_THRESHOLD_OVERRIDES 4}}enableRestartCountCheck:{{$ENABLE_RESTART_COUNT_CHECK}}  .2 部署rc.yaml 修改了image\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  apiVersion:v1kind:ReplicationControllermetadata:name:{{.Name}}labels:group:{{.Group}}spec:replicas:{{.Replicas}}selector:name:{{.Name}}template:metadata:labels:name:{{.Name}}group:{{.Group}}spec:containers:- image:192.168.182.101:5000/com.inspur/pause-amd64:3.1imagePullPolicy:IfNotPresentname:{{.Name}}ports:resources:requests:cpu:{{.CpuRequest}}memory:{{.MemoryRequest}}# Add not-ready/unreachable tolerations for 15 minutes so that node# failure doesn\u0026#39;t trigger pod deletion.tolerations:- key:\u0026#34;node.kubernetes.io/not-ready\u0026#34;operator:\u0026#34;Exists\u0026#34;effect:\u0026#34;NoExecute\u0026#34;tolerationSeconds:900- key:\u0026#34;node.kubernetes.io/unreachable\u0026#34;operator:\u0026#34;Exists\u0026#34;effect:\u0026#34;NoExecute\u0026#34;tolerationSeconds:900  .3 部署测试信息 命令运行报告信息，根据命令配置的report参数，进入report目录进行查看\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  [root@node1 clusterloader2]# ls clusterloader reports testing test.log [root@node1 clusterloader2]# cd reports/ [root@node1 reports]# ll total 44 -rw-r--r-- 1 root root 10093 Dec 11 15:38 APIResponsiveness_density_2020-12-11T15:38:47+08:00.json -rw-r--r-- 1 root root 9792 Dec 11 16:29 APIResponsiveness_density_2020-12-11T16:29:41+08:00.json -rw-r--r-- 1 root root 287 Dec 11 16:29 junit.xml -rw-r--r-- 1 root root 1054 Dec 11 15:38 PodStartupLatency_SaturationPodStartupLatency_density_2020-12-11T15:37:54+08:00.json -rw-r--r-- 1 root root 1048 Dec 11 16:29 PodStartupLatency_SaturationPodStartupLatency_density_2020-12-11T16:28:49+08:00.json -rw-r--r-- 1 root root 64 Dec 11 15:38 SchedulingThroughput_density_2020-12-11T15:37:54+08:00.json -rw-r--r-- 1 root root 64 Dec 11 16:29 SchedulingThroughput_density_2020-12-11T16:28:49+08:00.json   按上面的config.yaml，在2节点的本地虚拟机环境执行density测试，完整信息如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151  I1214 15:48:46.685903 129068 clusterloader.go:105] ClusterConfig.Nodes set to 2 E1214 15:48:46.690191 129068 clusterloader.go:122] Getting master external ip error: did not find any ExternalIP master IPs I1214 15:48:46.690809 129068 clusterloader.go:206] Using config: {ClusterConfig:{KubeConfigPath:/root/.kube/config Nodes:2 Provider: MasterIPs:[] MasterInternalIPs:[TEST_MASTER_INTERNAL_IP] MasterName:192.168.182.101 KubemarkRootKubeConfigPath:} ReportDir:./reports EnablePrometheusServer:false TearDownPrometheusServer:false TestConfigPath: TestOverridesPath:[] PrometheusConfig:{EnableServer:false TearDownServer:true ScrapeEtcd:false ScrapeNodeExporter:false ScrapeKubelets:false ScrapeKubeProxy:true SnapshotProject:}} I1214 15:48:46.693242 129068 cluster.go:56] Listing cluster nodes: I1214 15:48:46.693254 129068 cluster.go:68] Name: node1, clusterIP: 192.168.182.101, externalIP: , isSchedulable: true I1214 15:48:46.693260 129068 cluster.go:68] Name: node2, clusterIP: 192.168.182.102, externalIP: , isSchedulable: true I1214 15:48:46.696447 129068 clusterloader.go:167] -------------------------------------------------------------------------------- I1214 15:48:46.696469 129068 clusterloader.go:168] Running /home/wangb/perf-test/clusterloader2/testing/density/config2.yaml I1214 15:48:46.696472 129068 clusterloader.go:169] -------------------------------------------------------------------------------- I1214 15:48:46.697804 129068 simple_test_executor.go:50] AutomanagedNamespacePrefix: test-tteu8b I1214 15:48:46.729142 129068 etcd_metrics.go:76] EtcdMetrics: starting etcd metrics collecting... I1214 15:48:46.729168 129068 scheduler_latency.go:77] SchedulingMetrics: resetting latency metrics in scheduler... I1214 15:48:46.729274 129068 api_responsiveness.go:70] APIResponsiveness: resetting latency metrics in apiserver... I1214 15:48:46.936885 129068 resource_usage.go:106] ResourceUsageSummary: starting resource usage collecting... I1214 15:48:46.948058 129068 system_pod_metrics.go:82] skipping collection of system pod metrics I1214 15:48:46.948107 129068 pod_startup_latency.go:131] PodStartupLatency: labelSelector(group = saturation): starting pod startup latency measurement... I1214 15:48:47.048405 129068 wait_for_controlled_pods.go:163] WaitForControlledPodsRunning: starting wait for controlled pods measurement... I1214 15:48:47.607326 129068 scheduling_throughput.go:107] SchedulingThroughput: starting collecting throughput data I1214 15:48:47.607393 129068 wait_for_controlled_pods.go:196] WaitForControlledPodsRunning: waiting for controlled pods measurement... I1214 15:48:52.226268 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=saturation-rc-0): Pods: 2 out of 2 created, 2 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:52.408575 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=saturation-rc-0): Pods: 2 out of 2 created, 2 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:52.607705 129068 scheduling_throughput.go:123] SchedulingThroughput: labelSelector(group = saturation): 4 pods scheduled I1214 15:48:52.611510 129068 wait_for_controlled_pods.go:235] WaitForControlledPodsRunning: running 2, deleted 0, timeout: 0, unknown: 0 I1214 15:48:52.611535 129068 wait_for_controlled_pods.go:249] WaitForControlledPodsRunning: 2/2 ReplicationControllers are running with all pods I1214 15:48:52.611582 129068 pod_startup_latency.go:163] PodStartupLatency: labelSelector(group = saturation): gathering pod startup latency measurement... I1214 15:48:52.630805 129068 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = saturation): 4 worst create-to-schedule latencies: [{test-tteu8b-2/saturation-rc-0-t2t27 node2 0s} {test-tteu8b-1/saturation-rc-0-vxxc6 node2 0s} {test-tteu8b-1/saturation-rc-0-pqmh6 node1 0s} {test-tteu8b-2/saturation-rc-0-phkng node1 0s}] I1214 15:48:52.630877 129068 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = saturation): perc50: 0s, perc90: 0s, perc99: 0s; threshold: 3m0s I1214 15:48:52.630887 129068 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = saturation): 4 worst schedule-to-run latencies: [{test-tteu8b-2/saturation-rc-0-t2t27 node2 1s} {test-tteu8b-1/saturation-rc-0-vxxc6 node2 1s} {test-tteu8b-1/saturation-rc-0-pqmh6 node1 1s} {test-tteu8b-2/saturation-rc-0-phkng node1 1s}] I1214 15:48:52.630894 129068 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = saturation): perc50: 1s, perc90: 1s, perc99: 1s; threshold: 3m0s I1214 15:48:52.630903 129068 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = saturation): 4 worst run-to-watch latencies: [{test-tteu8b-2/saturation-rc-0-t2t27 node2 1.202667785s} {test-tteu8b-1/saturation-rc-0-vxxc6 node2 1.22260201s} {test-tteu8b-1/saturation-rc-0-pqmh6 node1 1.292204887s} {test-tteu8b-2/saturation-rc-0-phkng node1 1.30166796s}] I1214 15:48:52.630909 129068 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = saturation): perc50: 1.22260201s, perc90: 1.30166796s, perc99: 1.30166796s; threshold: 3m0s I1214 15:48:52.630912 129068 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = saturation): 4 worst schedule-to-watch latencies: [{test-tteu8b-2/saturation-rc-0-t2t27 node2 2.202667785s} {test-tteu8b-1/saturation-rc-0-vxxc6 node2 2.22260201s} {test-tteu8b-1/saturation-rc-0-pqmh6 node1 2.292204887s} {test-tteu8b-2/saturation-rc-0-phkng node1 2.30166796s}] I1214 15:48:52.630920 129068 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = saturation): perc50: 2.22260201s, perc90: 2.30166796s, perc99: 2.30166796s; threshold: 3m0s I1214 15:48:52.630922 129068 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = saturation): 4 worst e2e latencies: [{test-tteu8b-2/saturation-rc-0-t2t27 node2 2.202667785s} {test-tteu8b-1/saturation-rc-0-vxxc6 node2 2.22260201s} {test-tteu8b-1/saturation-rc-0-pqmh6 node1 2.292204887s} {test-tteu8b-2/saturation-rc-0-phkng node1 2.30166796s}] I1214 15:48:52.630926 129068 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = saturation): perc50: 2.22260201s, perc90: 2.30166796s, perc99: 2.30166796s; threshold: 3m0s I1214 15:48:52.631183 129068 scheduling_throughput.go:136] SchedulingThroughput: gathering data I1214 15:48:52.631231 129068 simple_test_executor.go:128] Step \u0026#34;Creating saturation pods\u0026#34; ended I1214 15:48:52.631261 129068 pod_startup_latency.go:131] PodStartupLatency: labelSelector(group = latency): starting pod startup latency measurement... I1214 15:48:52.731639 129068 wait_for_controlled_pods.go:163] WaitForControlledPodsRunning: starting wait for controlled pods measurement... I1214 15:48:56.854842 129068 wait_for_controlled_pods.go:196] WaitForControlledPodsRunning: waiting for controlled pods measurement... I1214 15:48:57.893711 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-0): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:58.090743 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-1): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:58.290905 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-2): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:58.489711 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-3): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:58.690296 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-4): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:58.889999 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-5): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:59.089820 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-6): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:59.289666 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-7): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:59.490967 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-8): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:59.690953 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-9): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:48:59.892106 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-0): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:00.093290 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-1): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:00.296933 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-2): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:00.498491 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-3): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:00.700027 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-4): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:00.963786 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-5): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:01.107629 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-6): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:01.311728 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-7): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:01.509745 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-8): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:01.710317 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-9): Pods: 1 out of 1 created, 0 running, 1 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:02.893967 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-0): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:03.090943 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-1): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:03.290972 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-2): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:03.490268 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-3): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:03.690609 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-4): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:03.890985 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-5): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:04.090049 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-6): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:04.290203 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-7): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:04.691160 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-9): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:05.093608 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-1): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:05.499007 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-3): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:05.964020 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-5): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:06.312641 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-7): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:06.710758 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-9): Pods: 1 out of 1 created, 1 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:06.710803 129068 wait_for_controlled_pods.go:235] WaitForControlledPodsRunning: running 20, deleted 0, timeout: 0, unknown: 0 I1214 15:49:06.715769 129068 wait_for_controlled_pods.go:249] WaitForControlledPodsRunning: 20/20 ReplicationControllers are running with all pods I1214 15:49:06.720533 129068 simple_test_executor.go:128] Step \u0026#34;Creating latency pods\u0026#34; ended I1214 15:49:10.750656 129068 wait_for_controlled_pods.go:196] WaitForControlledPodsRunning: waiting for controlled pods measurement... I1214 15:49:11.801519 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-0): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:11.986805 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-1): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:12.184772 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-2): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:12.382919 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-3): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:12.589442 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-4): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:12.785810 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-5): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:12.983926 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-6): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:13.184330 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-7): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:13.384069 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-8): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:13.586112 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-9): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:13.790252 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-0): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:13.987269 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-1): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:14.192313 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-2): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:14.397369 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-3): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:14.605276 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-4): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:14.798794 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-5): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:14.997796 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-6): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:15.209917 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-7): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:15.394405 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-8): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:15.594518 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-9): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:17.184991 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-2): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:17.383303 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-3): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:17.786423 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-5): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:17.984309 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-6): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:18.184626 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-7): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:18.586402 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-9): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:18.987494 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-1): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:19.397720 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-3): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:19.799365 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-5): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:20.210268 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-7): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:20.594992 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=latency-pod-rc-9): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:22.984472 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-6): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:23.587181 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=latency-pod-rc-9): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:23.587247 129068 wait_for_controlled_pods.go:235] WaitForControlledPodsRunning: running 0, deleted 20, timeout: 0, unknown: 0 I1214 15:49:23.587289 129068 wait_for_controlled_pods.go:249] WaitForControlledPodsRunning: 0/0 ReplicationControllers are running with all pods I1214 15:49:23.612305 129068 pod_startup_latency.go:163] PodStartupLatency: labelSelector(group = latency): gathering pod startup latency measurement... I1214 15:49:23.650456 129068 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = latency): 20 worst create-to-schedule latencies: [{test-tteu8b-1/latency-pod-rc-0-lnrtg node2 0s} {test-tteu8b-1/latency-pod-rc-7-646cq node2 0s} {test-tteu8b-2/latency-pod-rc-4-tbszn node1 0s} {test-tteu8b-1/latency-pod-rc-5-mjbsr node2 0s} {test-tteu8b-1/latency-pod-rc-3-42gdw node2 0s} {test-tteu8b-2/latency-pod-rc-7-c7rst node2 0s} {test-tteu8b-1/latency-pod-rc-4-ngh2t node2 0s} {test-tteu8b-2/latency-pod-rc-1-4j655 node2 0s} {test-tteu8b-2/latency-pod-rc-9-xmct4 node2 0s} {test-tteu8b-1/latency-pod-rc-1-nk24t node2 0s} {test-tteu8b-1/latency-pod-rc-2-rj7h5 node2 0s} {test-tteu8b-1/latency-pod-rc-9-ww659 node2 0s} {test-tteu8b-2/latency-pod-rc-3-k8g85 node2 0s} {test-tteu8b-2/latency-pod-rc-0-wdhxz node1 0s} {test-tteu8b-2/latency-pod-rc-2-pwgsb node1 0s} {test-tteu8b-2/latency-pod-rc-8-c5m4q node1 0s} {test-tteu8b-2/latency-pod-rc-6-x7d4t node1 0s} {test-tteu8b-1/latency-pod-rc-8-4kx24 node1 0s} {test-tteu8b-1/latency-pod-rc-6-wskwq node2 0s} {test-tteu8b-2/latency-pod-rc-5-xx7qn node2 1s}] I1214 15:49:23.650562 129068 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = latency): perc50: 0s, perc90: 0s, perc99: 1s; threshold: 5s I1214 15:49:23.650571 129068 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = latency): 20 worst schedule-to-run latencies: [{test-tteu8b-1/latency-pod-rc-8-4kx24 node1 1s} {test-tteu8b-2/latency-pod-rc-2-pwgsb node1 1s} {test-tteu8b-2/latency-pod-rc-0-wdhxz node1 2s} {test-tteu8b-2/latency-pod-rc-6-x7d4t node1 2s} {test-tteu8b-2/latency-pod-rc-4-tbszn node1 2s} {test-tteu8b-2/latency-pod-rc-8-c5m4q node1 2s} {test-tteu8b-1/latency-pod-rc-0-lnrtg node2 3s} {test-tteu8b-1/latency-pod-rc-1-nk24t node2 3s} {test-tteu8b-2/latency-pod-rc-5-xx7qn node2 4s} {test-tteu8b-2/latency-pod-rc-9-xmct4 node2 4s} {test-tteu8b-1/latency-pod-rc-3-42gdw node2 4s} {test-tteu8b-2/latency-pod-rc-7-c7rst node2 4s} {test-tteu8b-1/latency-pod-rc-2-rj7h5 node2 4s} {test-tteu8b-1/latency-pod-rc-6-wskwq node2 4s} {test-tteu8b-1/latency-pod-rc-9-ww659 node2 5s} {test-tteu8b-2/latency-pod-rc-1-4j655 node2 5s} {test-tteu8b-1/latency-pod-rc-4-ngh2t node2 5s} {test-tteu8b-1/latency-pod-rc-5-mjbsr node2 5s} {test-tteu8b-1/latency-pod-rc-7-646cq node2 5s} {test-tteu8b-2/latency-pod-rc-3-k8g85 node2 5s}] I1214 15:49:23.650585 129068 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = latency): perc50: 4s, perc90: 5s, perc99: 5s; threshold: 5s I1214 15:49:23.650588 129068 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = latency): 20 worst run-to-watch latencies: [{test-tteu8b-2/latency-pod-rc-1-4j655 node2 560.606582ms} {test-tteu8b-2/latency-pod-rc-0-wdhxz node1 721.939052ms} {test-tteu8b-2/latency-pod-rc-8-c5m4q node1 833.924156ms} {test-tteu8b-2/latency-pod-rc-6-x7d4t node1 854.39232ms} {test-tteu8b-1/latency-pod-rc-5-mjbsr node2 1.012828114s} {test-tteu8b-2/latency-pod-rc-5-xx7qn node2 1.411960877s} {test-tteu8b-1/latency-pod-rc-7-646cq node2 1.647809261s} {test-tteu8b-2/latency-pod-rc-3-k8g85 node2 1.812513167s} {test-tteu8b-2/latency-pod-rc-2-pwgsb node1 1.832899011s} {test-tteu8b-2/latency-pod-rc-4-tbszn node1 1.865941757s} {test-tteu8b-1/latency-pod-rc-9-ww659 node2 2.009388509s} {test-tteu8b-1/latency-pod-rc-2-rj7h5 node2 2.082626218s} {test-tteu8b-1/latency-pod-rc-4-ngh2t node2 2.140752308s} {test-tteu8b-2/latency-pod-rc-9-xmct4 node2 2.210054751s} {test-tteu8b-1/latency-pod-rc-8-4kx24 node1 2.508582695s} {test-tteu8b-2/latency-pod-rc-7-c7rst node2 2.611408502s} {test-tteu8b-1/latency-pod-rc-6-wskwq node2 2.625719954s} {test-tteu8b-1/latency-pod-rc-1-nk24t node2 3.066876643s} {test-tteu8b-1/latency-pod-rc-3-42gdw node2 3.538575976s} {test-tteu8b-1/latency-pod-rc-0-lnrtg node2 5.586231683s}] I1214 15:49:23.650601 129068 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = latency): perc50: 1.865941757s, perc90: 3.066876643s, perc99: 5.586231683s; threshold: 5s I1214 15:49:23.650604 129068 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = latency): 20 worst schedule-to-watch latencies: [{test-tteu8b-2/latency-pod-rc-0-wdhxz node1 2.721939052s} {test-tteu8b-2/latency-pod-rc-2-pwgsb node1 2.832899011s} {test-tteu8b-2/latency-pod-rc-8-c5m4q node1 2.833924156s} {test-tteu8b-2/latency-pod-rc-6-x7d4t node1 2.85439232s} {test-tteu8b-1/latency-pod-rc-8-4kx24 node1 3.508582695s} {test-tteu8b-2/latency-pod-rc-4-tbszn node1 3.865941757s} {test-tteu8b-2/latency-pod-rc-5-xx7qn node2 5.411960877s} {test-tteu8b-2/latency-pod-rc-1-4j655 node2 5.560606582s} {test-tteu8b-1/latency-pod-rc-5-mjbsr node2 6.012828114s} {test-tteu8b-1/latency-pod-rc-1-nk24t node2 6.066876643s} {test-tteu8b-1/latency-pod-rc-2-rj7h5 node2 6.082626218s} {test-tteu8b-2/latency-pod-rc-9-xmct4 node2 6.210054751s} {test-tteu8b-2/latency-pod-rc-7-c7rst node2 6.611408502s} {test-tteu8b-1/latency-pod-rc-6-wskwq node2 6.625719954s} {test-tteu8b-1/latency-pod-rc-7-646cq node2 6.647809261s} {test-tteu8b-2/latency-pod-rc-3-k8g85 node2 6.812513167s} {test-tteu8b-1/latency-pod-rc-9-ww659 node2 7.009388509s} {test-tteu8b-1/latency-pod-rc-4-ngh2t node2 7.140752308s} {test-tteu8b-1/latency-pod-rc-3-42gdw node2 7.538575976s} {test-tteu8b-1/latency-pod-rc-0-lnrtg node2 8.586231683s}] I1214 15:49:23.650616 129068 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = latency): perc50: 6.066876643s, perc90: 7.140752308s, perc99: 8.586231683s; threshold: 5s I1214 15:49:23.650620 129068 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = latency): 20 worst e2e latencies: [{test-tteu8b-2/latency-pod-rc-0-wdhxz node1 2.721939052s} {test-tteu8b-2/latency-pod-rc-2-pwgsb node1 2.832899011s} {test-tteu8b-2/latency-pod-rc-8-c5m4q node1 2.833924156s} {test-tteu8b-2/latency-pod-rc-6-x7d4t node1 2.85439232s} {test-tteu8b-1/latency-pod-rc-8-4kx24 node1 3.508582695s} {test-tteu8b-2/latency-pod-rc-4-tbszn node1 3.865941757s} {test-tteu8b-2/latency-pod-rc-1-4j655 node2 5.560606582s} {test-tteu8b-1/latency-pod-rc-5-mjbsr node2 6.012828114s} {test-tteu8b-1/latency-pod-rc-1-nk24t node2 6.066876643s} {test-tteu8b-1/latency-pod-rc-2-rj7h5 node2 6.082626218s} {test-tteu8b-2/latency-pod-rc-9-xmct4 node2 6.210054751s} {test-tteu8b-2/latency-pod-rc-5-xx7qn node2 6.411960877s} {test-tteu8b-2/latency-pod-rc-7-c7rst node2 6.611408502s} {test-tteu8b-1/latency-pod-rc-6-wskwq node2 6.625719954s} {test-tteu8b-1/latency-pod-rc-7-646cq node2 6.647809261s} {test-tteu8b-2/latency-pod-rc-3-k8g85 node2 6.812513167s} {test-tteu8b-1/latency-pod-rc-9-ww659 node2 7.009388509s} {test-tteu8b-1/latency-pod-rc-4-ngh2t node2 7.140752308s} {test-tteu8b-1/latency-pod-rc-3-42gdw node2 7.538575976s} {test-tteu8b-1/latency-pod-rc-0-lnrtg node2 8.586231683s}] I1214 15:49:23.650631 129068 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = latency): perc50: 6.082626218s, perc90: 7.140752308s, perc99: 8.586231683s; threshold: 5s E1214 15:49:23.651429 129068 pod_startup_latency.go:243] PodStartupLatency: labelSelector(group = latency): pod startup: too high latency 50th percentile: 6.082626218s I1214 15:49:23.651671 129068 simple_test_executor.go:128] Step \u0026#34;Deleting latancy pods\u0026#34; ended I1214 15:49:24.054984 129068 wait_for_controlled_pods.go:196] WaitForControlledPodsRunning: waiting for controlled pods measurement... I1214 15:49:28.720087 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=saturation-rc-0): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 1 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:28.910121 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-2), labelSelector(name=saturation-rc-0): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:33.720408 129068 wait_for_pods.go:141] WaitForControlledPodsRunning: namespace(test-tteu8b-1), labelSelector(name=saturation-rc-0): Pods: 0 out of 0 created, 0 running, 0 pending scheduled, 0 not scheduled, 0 inactive, 0 terminating, 0 unknown, 0 runningButNotReady I1214 15:49:33.723457 129068 wait_for_controlled_pods.go:235] WaitForControlledPodsRunning: running 0, deleted 2, timeout: 0, unknown: 0 I1214 15:49:33.723518 129068 wait_for_controlled_pods.go:249] WaitForControlledPodsRunning: 0/0 ReplicationControllers are running with all pods I1214 15:49:33.723540 129068 simple_test_executor.go:128] Step \u0026#34;Deleting saturation pods\u0026#34; ended I1214 15:49:33.833335 129068 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:DELETE Scope:namespace Latency:{Perc50:8.831ms Perc90:13.349ms Perc99:36.302ms} Count:48}; threshold: 1s I1214 15:49:33.833401 129068 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:GET Scope:namespace Latency:{Perc50:1.705ms Perc90:5.171ms Perc99:32.127ms} Count:184}; threshold: 1s I1214 15:49:33.833407 129068 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource:status Verb:PATCH Scope:namespace Latency:{Perc50:2.893ms Perc90:8.968ms Perc99:20.499ms} Count:105}; threshold: 1s I1214 15:49:33.833412 129068 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:replicationcontrollers Subresource: Verb:DELETE Scope:namespace Latency:{Perc50:4.333ms Perc90:10.995ms Perc99:19.334ms} Count:22}; threshold: 1s I1214 15:49:33.833421 129068 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource:binding Verb:POST Scope:namespace Latency:{Perc50:2.979ms Perc90:9.545ms Perc99:18.153ms} Count:24}; threshold: 1s I1214 15:49:34.572385 129068 resource_usage.go:124] ResourceUsageSummary: gathering resource usage... I1214 15:49:34.574852 129068 container_resource_gatherer.go:172] Closed stop channel. Waiting for 1 workers I1214 15:49:34.574936 129068 resource_gather_worker.go:90] Closing worker for node1 I1214 15:49:34.574949 129068 container_resource_gatherer.go:180] Waitgroup finished. I1214 15:49:34.576009 129068 system_pod_metrics.go:82] skipping collection of system pod metrics I1214 15:49:44.638344 129068 simple_test_executor.go:345] Resources cleanup time: 10.059218091s I1214 15:49:44.641394 129068 clusterloader.go:177] -------------------------------------------------------------------------------- I1214 15:49:44.641440 129068 clusterloader.go:178] Test Finished I1214 15:49:44.641461 129068 clusterloader.go:179] Test: /home/wangb/perf-test/clusterloader2/testing/density/config2.yaml I1214 15:49:44.641465 129068 clusterloader.go:180] Status: Success I1214 15:49:44.641467 129068 clusterloader.go:184] --------------------------------------------------------------------------------   .4 测试报告 1 2 3 4 5 6 7 8 9 10 11  [root@node1 clusterloader2]# ll reports/ -h total 260K -rw-r--r-- 1 root root 9.9K Dec 14 16:26 APIResponsiveness_density_2020-12-14T16:26:20+08:00.json -rw-r--r-- 1 root root 1.6K Dec 14 16:26 EtcdMetrics_density_2020-12-14T16:26:21+08:00.json -rw-r--r-- 1 root root 287 Dec 14 16:26 junit.xml -rw-r--r-- 1 root root 224K Dec 14 16:26 MetricsForE2E_density_2020-12-14T16:26:21+08:00.json -rw-r--r-- 1 root root 1.1K Dec 14 16:26 PodStartupLatency_SaturationPodStartupLatency_density_2020-12-14T16:25:43+08:00.json -rw-r--r-- 1 root root 3 Dec 14 16:26 ResourceUsageSummary_density_2020-12-14T16:26:21+08:00.json -rw-r--r-- 1 root root 400 Dec 14 16:26 SchedulingMetrics_density_2020-12-14T16:26:21+08:00.json -rw-r--r-- 1 root root 72 Dec 14 16:26 SchedulingThroughput_density_2020-12-14T16:25:43+08:00.json    测试的指标大多根据 metrics 获取 也有数据从 event 获取，比如 podStartupLatency  .2 kubemark节点环境 kubemark + clusterloader2方式测试\n测试环境：总节点数8个：本地虚拟机2节点 + 6个kubemark节点 虚拟机内存大小为2G\n 启动kubemark节点  1 2 3 4 5 6 7 8 9 10 11  [root@node1 wangb]# kubectl get no NAME STATUS ROLES AGE VERSION hollow-node-0 Ready \u0026lt;none\u0026gt; 9s v0.0.0-master+4d3c9e0c hollow-node-1 Ready \u0026lt;none\u0026gt; 9s v0.0.0-master+4d3c9e0c hollow-node-2 Ready \u0026lt;none\u0026gt; 9s v0.0.0-master+4d3c9e0c hollow-node-3 Ready \u0026lt;none\u0026gt; 9s v0.0.0-master+4d3c9e0c hollow-node-4 Ready \u0026lt;none\u0026gt; 9s v0.0.0-master+4d3c9e0c hollow-node-5 Ready \u0026lt;none\u0026gt; 9s v0.0.0-master+4d3c9e0c node1 Ready master,node 7d22h v1.14.8 node2 Ready node 7d22h v1.14.8   clusterloader test config.yaml  node-pod状态  首先能够看到hollow-node和真实node上(共8个节点)都运行了pod  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  test-l3zhzg-2 saturation-rc-0-gmx45 1/1 Running 0 2m19s 10.152.121.76 hollow-node-1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-grbkl 1/1 Running 0 2m19s 10.233.90.157 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-jtw77 1/1 Running 0 2m17s 10.233.96.78 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-krzkt 1/1 Running 0 2m19s 10.88.194.43 hollow-node-0 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-kskvv 1/1 Running 0 2m16s 10.177.65.132 hollow-node-4 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-l4zbp 1/1 Running 0 2m19s 10.16.150.60 hollow-node-0 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-l89cz 1/1 Running 0 2m13s 10.118.8.133 hollow-node-1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-lp8tp 1/1 Running 0 2m19s 10.220.39.235 hollow-node-3 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-ls9zw 1/1 Running 0 2m19s 10.15.197.103 hollow-node-2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-m64hg 1/1 Running 0 2m14s 10.172.167.195 hollow-node-2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-m7qct 1/1 Running 0 2m17s 10.41.26.226 hollow-node-4 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-mct9d 1/1 Running 0 2m18s 10.126.207.219 hollow-node-4 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-ml2fw 1/1 Running 0 2m13s 10.245.91.90 hollow-node-2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-mndt2 1/1 Running 0 2m19s 10.177.227.228 hollow-node-3 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-n6tzb 1/1 Running 0 2m13s 10.76.229.141 hollow-node-3 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-nfq2d 1/1 Running 0 2m19s 10.172.121.37 hollow-node-4 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-nn4wn 1/1 Running 0 2m18s 10.22.201.220 hollow-node-0 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-nvpz7 1/1 Running 0 2m16s 10.3.93.180 hollow-node-5 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-pfw58 1/1 Running 0 2m16s 10.144.139.248 hollow-node-1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-pqbd6 1/1 Running 0 2m17s 10.207.147.215 hollow-node-0 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-q9x97 1/1 Running 0 2m14s 10.233.90.149 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; test-l3zhzg-2 saturation-rc-0-qslqs 1/1 Running 0    pod的调度延时  1 2 3 4 5  I1215 13:59:14.776944 27607 wait_for_controlled_pods.go:249] WaitForControlledPodsRunning: 2/2 ReplicationControllers are running with all pods I1215 13:59:14.777038 27607 pod_startup_latency.go:163] PodStartupLatency: labelSelector(group = saturation): gathering pod startup latency measurement... I1215 13:59:14.795377 27607 pod_startup_latency.go:312] PodStartupLatency: labelSelector(group = saturation): 40 worst create-to-schedule latencies: [{test-bijvxv-1/saturation-rc-0-gktmn hollow-node-1 0s} {test-bijvxv-1/saturation-rc-0-gv9qb hollow-node-2 0s} {test-bijvxv-1/saturation-rc-0-n4cm5 hollow-node-4 0s} {test-bijvxv-2/saturation-rc-0-bn9z4 hollow-node-4 0s} {test-bijvxv-2/saturation-rc-0-srlf6 hollow-node-0 0s} {test-bijvxv-2/saturation-rc-0-btbng hollow-node-1 0s} {test-bijvxv-1/saturation-rc-0-kkcr7 hollow-node-5 0s} {test-bijvxv-2/saturation-rc-0-dctpp hollow-node-0 0s} {test-bijvxv-1/saturation-rc-0-5m8b2 hollow-node-1 0s} {test-bijvxv-1/saturation-rc-0-fpg6d hollow-node-2 0s} {test-bijvxv-1/saturation-rc-0-tjkvs hollow-node-4 0s} {test-bijvxv-2/saturation-rc-0-z6vtd hollow-node-2 0s} {test-bijvxv-2/saturation-rc-0-hrpwd hollow-node-3 0s} {test-bijvxv-2/saturation-rc-0-hzvk9 hollow-node-1 0s} {test-bijvxv-1/saturation-rc-0-x9b4c hollow-node-0 0s} {test-bijvxv-2/saturation-rc-0-4cqkz hollow-node-0 0s} {test-bijvxv-2/saturation-rc-0-4nppr node2 0s} {test-bijvxv-1/saturation-rc-0-rz69k hollow-node-2 0s} {test-bijvxv-2/saturation-rc-0-btsq4 hollow-node-3 0s} {test-bijvxv-1/saturation-rc-0-ll8sk hollow-node-3 0s} {test-bijvxv-1/saturation-rc-0-zjs57 hollow-node-1 0s} {test-bijvxv-1/saturation-rc-0-dq7x4 hollow-node-5 0s} {test-bijvxv-2/saturation-rc-0-fgxjz hollow-node-4 0s} {test-bijvxv-1/saturation-rc-0-g2bcp node1 0s} {test-bijvxv-2/saturation-rc-0-qp9pg hollow-node-3 0s} {test-bijvxv-1/saturation-rc-0-bdqzd hollow-node-5 0s} {test-bijvxv-1/saturation-rc-0-j5s2q hollow-node-4 0s} {test-bijvxv-2/saturation-rc-0-cp2wn node1 0s} {test-bijvxv-2/saturation-rc-0-2z8ct node1 0s} {test-bijvxv-2/saturation-rc-0-q6hd5 hollow-node-1 0s} {test-bijvxv-2/saturation-rc-0-68wwc hollow-node-5 0s} {test-bijvxv-2/saturation-rc-0-5t2wb hollow-node-4 0s} {test-bijvxv-1/saturation-rc-0-lt8ws hollow-node-0 0s} {test-bijvxv-1/saturation-rc-0-dwqz4 hollow-node-3 0s} {test-bijvxv-1/saturation-rc-0-vj68z node2 0s} {test-bijvxv-2/saturation-rc-0-96l5s hollow-node-5 0s} {test-bijvxv-1/saturation-rc-0-v7jq6 hollow-node-3 0s} {test-bijvxv-2/saturation-rc-0-8g4hx hollow-node-5 0s} {test-bijvxv-2/saturation-rc-0-hj7c7 hollow-node-2 0s} {test-bijvxv-1/saturation-rc-0-gx72w hollow-node-0 0s}] I1215 13:59:14.795463 27607 pod_startup_latency.go:313] PodStartupLatency: labelSelector(group = saturation): perc50: 0s, perc90: 0s, perc99: 0s; threshold: 3m2s   测试1  NODES_PER_NAMESPACE 4 PODS_PER_NODE 5 MIN_LATENCY_PODS 20  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  I1215 14:05:35.050407 35029 wait_for_controlled_pods.go:249] WaitForControlledPodsRunning: 0/0 ReplicationControllers are running with all pods I1215 14:05:35.050777 35029 simple_test_executor.go:128] Step \u0026#34;Deleting saturation pods\u0026#34; ended I1215 14:05:35.159705 35029 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:POST Scope:namespace Latency:{Perc50:2.613ms Perc90:11.315ms Perc99:52.045ms} Count:180}; threshold: 1s I1215 14:05:35.159757 35029 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:DELETE Scope:namespace Latency:{Perc50:5.669ms Perc90:15.912ms Perc99:36.005ms} Count:360}; threshold: 1s I1215 14:05:35.159762 35029 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource:binding Verb:POST Scope:namespace Latency:{Perc50:2.547ms Perc90:14.111ms Perc99:26.474ms} Count:180}; threshold: 1s I1215 14:05:35.159767 35029 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:nodes Subresource:status Verb:PATCH Scope:cluster Latency:{Perc50:8.703ms Perc90:20.129ms Perc99:23.056ms} Count:14}; threshold: 1s I1215 14:05:35.159772 35029 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource:status Verb:PATCH Scope:namespace Latency:{Perc50:2.698ms Perc90:7.41ms Perc99:19.599ms} Count:905}; threshold: 1s I1215 14:05:35.470022 35029 resource_usage.go:124] ResourceUsageSummary: gathering resource usage... I1215 14:05:35.470058 35029 container_resource_gatherer.go:172] Closed stop channel. Waiting for 1 workers I1215 14:05:35.470072 35029 resource_gather_worker.go:90] Closing worker for node1 I1215 14:05:35.470079 35029 container_resource_gatherer.go:180] Waitgroup finished. I1215 14:05:35.470202 35029 system_pod_metrics.go:82] skipping collection of system pod metrics I1215 14:05:45.494628 35029 simple_test_executor.go:345] Resources cleanup time: 10.023988649s I1215 14:05:45.494661 35029 clusterloader.go:177] -------------------------------------------------------------------------------- I1215 14:05:45.494665 35029 clusterloader.go:178] Test Finished I1215 14:05:45.494669 35029 clusterloader.go:179] Test: /home/wangb/perf-test/clusterloader2/testing/density/config3.yaml I1215 14:05:45.494673 35029 clusterloader.go:180] Status: Success I1215 14:05:45.494677 35029 clusterloader.go:184] --------------------------------------------------------------------------------   测试2  NODES_PER_NAMESPACE 4 PODS_PER_NODE 20 MIN_LATENCY_PODS 200  能够看到 apiserver的响应延时比上面的用例要大\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  I1215 14:16:30.674465 49564 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:DELETE Scope:namespace Latency:{Perc50:6.124ms Perc90:17.215ms Perc99:36.206ms} Count:720}; threshold: 1s I1215 14:16:30.674524 49564 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:POST Scope:namespace Latency:{Perc50:2.713ms Perc90:12.849ms Perc99:35.964ms} Count:360}; threshold: 1s I1215 14:16:30.674530 49564 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource:binding Verb:POST Scope:namespace Latency:{Perc50:2.481ms Perc90:11.292ms Perc99:29.995ms} Count:360}; threshold: 1s I1215 14:16:30.674535 49564 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:replicationcontrollers Subresource: Verb:DELETE Scope:namespace Latency:{Perc50:3.972ms Perc90:8.978ms Perc99:28.475ms} Count:202}; threshold: 1s I1215 14:16:30.674543 49564 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource:status Verb:PATCH Scope:namespace Latency:{Perc50:2.61ms Perc90:7.179ms Perc99:27.04ms} Count:1891}; threshold: 1s I1215 14:16:31.136547 49564 resource_usage.go:124] ResourceUsageSummary: gathering resource usage... I1215 14:16:31.136595 49564 container_resource_gatherer.go:172] Closed stop channel. Waiting for 1 workers I1215 14:16:31.136612 49564 resource_gather_worker.go:90] Closing worker for node1 I1215 14:16:31.136619 49564 container_resource_gatherer.go:180] Waitgroup finished. I1215 14:16:31.136708 49564 system_pod_metrics.go:82] skipping collection of system pod metrics I1215 14:16:41.156280 49564 simple_test_executor.go:345] Resources cleanup time: 10.019116668s I1215 14:16:41.156316 49564 clusterloader.go:177] -------------------------------------------------------------------------------- I1215 14:16:41.156321 49564 clusterloader.go:178] Test Finished I1215 14:16:41.156326 49564 clusterloader.go:179] Test: /home/wangb/perf-test/clusterloader2/testing/density/config3.yaml I1215 14:16:41.156330 49564 clusterloader.go:180] Status: Success I1215 14:16:41.156334 49564 clusterloader.go:184] --------------------------------------------------------------------------------   测试3  NODES_PER_NAMESPACE 4 PODS_PER_NODE 25 MIN_LATENCY_PODS 200  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  I1215 16:19:38.812083 32636 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:subjectaccessreviews Subresource: Verb:POST Scope:cluster Latency:{Perc50:396µs Perc90:14.48ms Perc99:66.33ms} Count:37}; threshold: 1s I1215 16:19:38.812151 32636 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:nodes Subresource:status Verb:PATCH Scope:cluster Latency:{Perc50:6.048ms Perc90:32.049ms Perc99:54.374ms} Count:24}; threshold: 1s I1215 16:19:38.812159 32636 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:POST Scope:namespace Latency:{Perc50:3.118ms Perc90:12.026ms Perc99:34.693ms} Count:400}; threshold: 1s I1215 16:19:38.812169 32636 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:endpoints Subresource: Verb:PUT Scope:namespace Latency:{Perc50:2.467ms Perc90:7.957ms Perc99:34.158ms} Count:166}; threshold: 1s I1215 16:19:38.812174 32636 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:DELETE Scope:namespace Latency:{Perc50:6.106ms Perc90:13.581ms Perc99:33.557ms} Count:800}; threshold: 1s I1215 16:19:39.258943 32636 resource_usage.go:124] ResourceUsageSummary: gathering resource usage... I1215 16:19:39.258993 32636 container_resource_gatherer.go:172] Closed stop channel. Waiting for 1 workers I1215 16:19:39.259012 32636 resource_gather_worker.go:90] Closing worker for node1 I1215 16:19:39.259027 32636 container_resource_gatherer.go:180] Waitgroup finished. I1215 16:19:39.259125 32636 system_pod_metrics.go:82] skipping collection of system pod metrics I1215 16:19:49.287916 32636 simple_test_executor.go:345] Resources cleanup time: 10.028043195s I1215 16:19:49.287943 32636 clusterloader.go:177] -------------------------------------------------------------------------------- I1215 16:19:49.287946 32636 clusterloader.go:178] Test Finished I1215 16:19:49.287948 32636 clusterloader.go:179] Test: /home/wangb/perf-test/clusterloader2/testing/density/config3.yaml I1215 16:19:49.287951 32636 clusterloader.go:180] Status: Success I1215 16:19:49.287954 32636 clusterloader.go:184] --------------------------------------------------------------------------------   测试4  NODES_PER_NAMESPACE 4 PODS_PER_NODE 30 MIN_LATENCY_PODS 500  API访问超时，虚拟机OOM报错，无法再运行测试用例\n4 对自定义调度器测试 源码修改 对自定义调度器kube-batch测试，pod延时的计算，原有代码使用的是k8s调度器的event，这里需要修改成kube-batch，如下 在pod_startup_latency.go中\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  func (p *podStartupLatencyMeasurement) gatherScheduleTimes(c clientset.Interface) error { // custom cheduler add by wangb  const CustomSchedulerName = \u0026#34;kube-batch\u0026#34; selector := fields.Set{ \u0026#34;involvedObject.kind\u0026#34;: \u0026#34;Pod\u0026#34;, //\u0026#34;source\u0026#34;: corev1.DefaultSchedulerName,  \u0026#34;source\u0026#34;: CustomSchedulerName, }.AsSelector().String() options := metav1.ListOptions{FieldSelector: selector} schedEvents, err := c.CoreV1().Events(p.namespace).List(options) if err != nil { return err } for _, event := range schedEvents.Items { key := createMetaNamespaceKey(event.InvolvedObject.Namespace, event.InvolvedObject.Name) if _, ok := p.createTimes[key]; ok { p.scheduleTimes[key] = event.FirstTimestamp } } return nil }   重新编译成 custom_clusterloader\n配置文件 修改下test.config 和 rc.yaml\n test.config 中注意pod资源使用，适当调整大些 rc.yaml中，要对container同时设置limts和requests  custom_clusterloader运行命令 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  # 自定义clusterloader程序：custom_clusterloader cd /home/wangb/perf-test/clusterloader2 # ssh访问参数 export KUBE_SSH_KEY_PATH=/root/.ssh/id_rsa # master节点信息 MASTER_NAME=node1 TEST_MASTER_IP=192.168.182.101 TEST_MASTER_INTERNAL_IP=192.168.182.101 KUBE_CONFIG=${HOME}/.kube/config # 测试配置文件 TEST_CONFIG=\u0026#39;/home/wangb/perf-test/clusterloader2/testing/density/config-batch.yaml\u0026#39; # 测试报告目录位置 REPORT_DIR=\u0026#39;./reports\u0026#39; # 测试日志打印文件 LOG_FILE=\u0026#39;test.log\u0026#39; ./custom_clusterloader --kubeconfig=$KUBE_CONFIG \\  --mastername=$TEST_MASTER_IP \\  --masterip=$MASTER_IP \\  --master-internal-ip=TEST_MASTER_INTERNAL_IP \\  --testconfig=$TEST_CONFIG \\  --report-dir=$REPORT_DIR \\  --alsologtostderr 2\u0026gt;\u0026amp;1 | tee $LOG_FILE   5 问题 1. 提示 Getting master name error: master node not found和 Getting master internal ip error: didn\u0026rsquo;t find any InternalIP master IPs mastername和 internalip 参数需要配置\n1 2 3 4 5 6 7 8 9 10 11  I1211 11:10:31.302599 118141 clusterloader.go:105] ClusterConfig.Nodes set to 2 E1211 11:10:31.304485 118141 clusterloader.go:113] Getting master name error: master node not found E1211 11:10:31.307705 118141 clusterloader.go:122] Getting master external ip error: didn\u0026#39;t find any ExternalIP master IPs E1211 11:10:31.309369 118141 clusterloader.go:131] Getting master internal ip error: didn\u0026#39;t find any InternalIP master IPs I1211 11:10:31.309388 118141 clusterloader.go:206] Using config: {ClusterConfig:{KubeConfigPath:/root/.kube/config Nodes:2 Provider: MasterIPs:[] MasterInternalIPs:[] MasterName: KubemarkRootKubeConfigPath:} ReportDir:./reports EnablePrometheusServer:false TearDownPrometheusServer:false TestConfigPath: TestOverridesPath:[] PrometheusConfig:{EnableServer:false TearDownServer:true ScrapeEtcd:false ScrapeNodeExporter:false ScrapeKubelets:false ScrapeKubeProxy:true SnapshotProject:}} I1211 11:10:31.311334 118141 cluster.go:56] Listing cluster nodes: I1211 11:10:31.311348 118141 cluster.go:68] Name: node1, clusterIP: 192.168.182.101, externalIP: , isSchedulable: true I1211 11:10:31.311354 118141 cluster.go:68] Name: node2, clusterIP: 192.168.182.102, externalIP: , isSchedulable: true I1211 11:10:31.314575 118141 clusterloader.go:167] -------------------------------------------------------------------------------- I1211 11:10:31.314588 118141 clusterloader.go:168] Running /home/wangb/perf-test/clusterloader2/testing/density/config.yaml I1211 11:10:31.314591 118141 clusterloader.go:169] --------------------------------------------------------------------------------   2. Errors: [measurement call TestMetrics - TestMetrics error: [unexpected error (code: 0) in ssh connection to master: \u0026amp;errors.errorString{s:\u0026ldquo;error getting signer for provider : \u0026lsquo;GetSigner(\u0026hellip;) not implemented for \u0026lsquo;\u0026quot;}] 测试配置了TestMetrics measurement，但是没有通过。\nssh问题，参数不正确，还需要自定义环境变量配置KUBE_SSH_KEY_PATH=/root/.ssh/id_rsa\n1 2 3 4 5 6 7 8 9 10 11 12 13  E1211 11:34:39.085551 19551 test_metrics.go:185] TestMetrics: [unexpected error (code: 0) in ssh connection to master: \u0026amp;errors.errorString{s:\u0026#34;error getting signer for provider : \u0026#39;GetSigner(...) not implemented for \u0026#39;\u0026#34;} unexpected error (code: 0) in ssh connection to master: \u0026amp;errors.errorString{s:\u0026#34;error getting signer for provider : \u0026#39;GetSigner(...) not implemented for \u0026#39;\u0026#34;}] I1211 11:34:49.103215 19551 simple_test_executor.go:345] Resources cleanup time: 10.017395168s E1211 11:34:49.103273 19551 clusterloader.go:177] -------------------------------------------------------------------------------- E1211 11:34:49.103291 19551 clusterloader.go:178] Test Finished E1211 11:34:49.103295 19551 clusterloader.go:179] Test: /home/wangb/perf-test/clusterloader2/testing/density/config.yaml E1211 11:34:49.103298 19551 clusterloader.go:180] Status: Fail E1211 11:34:49.103301 19551 clusterloader.go:182] Errors: [measurement call TestMetrics - TestMetrics error: [unexpected error (code: 0) in ssh connection to master: \u0026amp;errors.errorString{s:\u0026#34;error getting signer for provider : \u0026#39;GetSigner(...) not implemented for \u0026#39;\u0026#34;}] measurement call APIResponsiveness - APIResponsiveness error: top latency metric: there should be no high-latency requests, but: [got: {Resource:endpoints Subresource: Verb:GET Scope:namespace Latency:{Perc50:1.046ms Perc90:4.871ms Perc99:1.588679s} Count:33}; expected perc99 \u0026lt;= 1s] measurement call TestMetrics - TestMetrics error: [unexpected error (code: 0) in ssh connection to master: \u0026amp;errors.errorString{s:\u0026#34;error getting signer for provider : \u0026#39;GetSigner(...) not implemented for \u0026#39;\u0026#34;} unexpected error (code: 0) in ssh connection to master: \u0026amp;errors.errorString{s:\u0026#34;error getting signer for provider : \u0026#39;GetSigner(...) not implemented for \u0026#39;\u0026#34;}]] E1211 11:34:49.103310 19551 clusterloader.go:184] -------------------------------------------------------------------------------- F1211 11:34:49.106925 19551 clusterloader.go:276] 1 tests have failed!   3. 告警提示：Master node is not registered. Grabbing metrics from Scheduler, ControllerManager and ClusterAutoscaler is disabled. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  W1214 10:00:44.212402 40729 metrics_grabber.go:81] Master node is not registered. Grabbing metrics from Scheduler, ControllerManager and ClusterAutoscaler is disabled. I1214 10:00:44.268795 40729 resource_usage.go:124] ResourceUsageSummary: gathering resource usage... I1214 10:00:44.268822 40729 container_resource_gatherer.go:172] Closed stop channel. Waiting for 0 workers I1214 10:00:44.268851 40729 container_resource_gatherer.go:180] Waitgroup finished. I1214 10:00:44.268935 40729 system_pod_metrics.go:82] skipping collection of system pod metrics E1214 10:00:44.268946 40729 test_metrics.go:185] TestMetrics: [text format parsing error in line 1: invalid metric name] I1214 10:00:54.301192 40729 simple_test_executor.go:345] Resources cleanup time: 10.031663914s E1214 10:00:54.301219 40729 clusterloader.go:177] -------------------------------------------------------------------------------- E1214 10:00:54.301222 40729 clusterloader.go:178] Test Finished E1214 10:00:54.301225 40729 clusterloader.go:179] Test: /home/wangb/perf-test/clusterloader2/testing/density/config2.yaml E1214 10:00:54.301227 40729 clusterloader.go:180] Status: Fail E1214 10:00:54.301229 40729 clusterloader.go:182] Errors: [measurement call TestMetrics - TestMetrics error: [text format parsing error in line 1: invalid metric name]] E1214 10:00:54.301233 40729 clusterloader.go:184] -------------------------------------------------------------------------------- F1214 10:00:54.305222 40729 clusterloader.go:276] 1 tests have failed!   排查过程，结合分析源码：\n如果没有注册master节点，则测试不会统计调度器和controllers等组件信息 分处理逻辑，发现clusterloader2对master节点的判断条件不符合测试集群环境，如下。需要修改下clusterloader2的代码\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  // TODO: find a better way of figuring out if given node is a registered master. func IsMasterNode(nodeName string) bool { // We are trying to capture \u0026#34;master(-...)?$\u0026#34; regexp.  // However, using regexp.MatchString() results even in more than 35%  // of all space allocations in ControllerManager spent in this function.  // That\u0026#39;s why we are trying to be a bit smarter.  if strings.HasSuffix(nodeName, \u0026#34;master\u0026#34;) { return true } if len(nodeName) \u0026gt;= 10 { return strings.HasSuffix(nodeName[:len(nodeName)-3], \u0026#34;master-\u0026#34;) } return false }   原有代码程序对master节点判断逻辑为：nodename为master或者master-开头 修改代码：在system.IsMasterNode(node.Name) 引用处，新增条件： node.Labels[\u0026ldquo;node-role.kubernetes.io/master\u0026rdquo;] == \u0026ldquo;true\u0026rdquo; ，作为master节点判断\n4. EtcdMetrics信息获取不到：EtcdMetrics: failed to collect etcd database size 1 2 3  E1214 11:06:03.936128 2312 etcd_metrics.go:121] EtcdMetrics: failed to collect etcd database size   或者上报错误：TestMetrics: [text format parsing error in line 1: invalid metric name]\n1  E1211 11:42:36.545827 30129 test_metrics.go:185] TestMetrics: [text format parsing error in line 1: invalid metric name]   https://github.com/kubernetes/perf-tests/issues/875 提的问题没有人解答\n最初先把testMetic测试项关闭，暂时规避该问题。可能跟metric服务数据采集有关。后来排查了下日志打印信息，发现有多处报错，要逐个排查。\n分析源码应该是获取不到etcd的metrics导致，修改代码如下： measurement/common/simple/etcd_metrics\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  func (e *etcdMetricsMeasurement) getEtcdMetrics(host, provider string) ([]*model.Sample, error) { // Etcd is only exposed on localhost level. We are using ssh method  if provider == \u0026#34;gke\u0026#34; { klog.Infof(\u0026#34;%s: not grabbing etcd metrics through master SSH: unsupported for gke\u0026#34;, e) return nil, nil } // In https://github.com/kubernetes/kubernetes/pull/74690, mTLS is enabled for etcd server  // http://localhost:2382 is specified to bypass TLS credential requirement when checking  // etcd /metrics and /health.  //if samples, err := e.sshEtcdMetrics(\u0026#34;curl http://localhost:2382/metrics\u0026#34;, host, provider); err == nil {  // return samples, nil  //}  // fix: 问题错误信息：EtcdMetrics: failed to collect etcd database size  // 这里需要根据实际测试环境情况，进行硬编码配置。 add by wangb  // 先ssh，再执行metrics的cmd  if samples, err := e.sshEtcdMetrics(\u0026#34;curl https://localhost:2379/metrics -k --cert /etc/ssl/etcd/ssl/ca.pem --key /etc/ssl/etcd/ssl/ca-key.pem\u0026#34;, host, provider); err == nil { return samples, nil } // Use old endpoint if new one fails.  return e.sshEtcdMetrics(\u0026#34;curl http://localhost:2379/metrics\u0026#34;, host, provider) }   按上述修改后，再重新编译，问题解决\n5.报错找不到资源 TestMetrics: [the server could not find the requested resource (get pods kube-scheduler-192.168.182.101:10251)] 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  I1214 14:14:20.039016 126597 resource_usage.go:124] ResourceUsageSummary: gathering resource usage... I1214 14:14:20.039058 126597 container_resource_gatherer.go:172] Closed stop channel. Waiting for 1 workers I1214 14:14:20.039075 126597 resource_gather_worker.go:90] Closing worker for node1 I1214 14:14:20.039082 126597 container_resource_gatherer.go:180] Waitgroup finished. I1214 14:14:20.039181 126597 system_pod_metrics.go:82] skipping collection of system pod metrics E1214 14:14:20.039193 126597 test_metrics.go:185] TestMetrics: [the server could not find the requested resource (get pods kube-scheduler-192.168.182.101:10251)] I1214 14:14:30.103890 126597 simple_test_executor.go:345] Resources cleanup time: 10.064213743s E1214 14:14:30.104163 126597 clusterloader.go:177] -------------------------------------------------------------------------------- E1214 14:14:30.104170 126597 clusterloader.go:178] Test Finished E1214 14:14:30.104173 126597 clusterloader.go:179] Test: /home/wangb/perf-test/clusterloader2/testing/density/config2.yaml E1214 14:14:30.104176 126597 clusterloader.go:180] Status: Fail E1214 14:14:30.104178 126597 clusterloader.go:182] Errors: [measurement call TestMetrics - TestMetrics error: [the server could not find the requested resource (delete pods kube-scheduler-192.168.182.101:10251)] measurement call TestMetrics - TestMetrics error: [the server could not find the requested resource (get pods kube-scheduler-192.168.182.101:10251)]] E1214 14:14:30.104180 126597 clusterloader.go:184] -------------------------------------------------------------------------------- F1214 14:14:30.104658 126597 clusterloader.go:276] 1 tests have failed!   分析可能是 view resource no match 查询资源url不正确导致？ 分析代码如下，可能是在msternode下构造request时有问题，定位原因为restclient构造url有问题。改用curl方式（可本地测试通过）直接获取调度器metrics common/simple/scheduler_latency.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64  // Sends request to kube scheduler metrics func (s *schedulerLatencyMeasurement) sendRequestToScheduler(c clientset.Interface, op, host, provider, masterName string) (string, error) { opUpper := strings.ToUpper(op) if opUpper != \u0026#34;GET\u0026#34; \u0026amp;\u0026amp; opUpper != \u0026#34;DELETE\u0026#34; { return \u0026#34;\u0026#34;, fmt.Errorf(\u0026#34;unknown REST request\u0026#34;) } nodes, err := c.CoreV1().Nodes().List(metav1.ListOptions{}) if err != nil { return \u0026#34;\u0026#34;, err } var masterRegistered = false for _, node := range nodes.Items { if node.Labels[\u0026#34;node-role.kubernetes.io/master\u0026#34;] == \u0026#34;true\u0026#34; || system.IsMasterNode(node.Name) { masterRegistered = true } } var responseText string // masterRegistered时，client接口处理有问题，统一改使用curl -X 方式处理GET和DELETE add by wangb start  _ = masterRegistered //if masterRegistered {  // ctx, cancel := context.WithTimeout(context.Background(), singleRestCallTimeout)  // defer cancel()  //  // body, err := c.CoreV1().RESTClient().Verb(opUpper).  // Context(ctx).  // Namespace(metav1.NamespaceSystem).  // Resource(\u0026#34;pods\u0026#34;).  // Name(fmt.Sprintf(\u0026#34;kube-scheduler-%v:%v\u0026#34;, masterName, ports.InsecureSchedulerPort)).  // SubResource(\u0026#34;proxy\u0026#34;).  // Suffix(\u0026#34;metrics\u0026#34;).  // Do().Raw()  //  // if err != nil {  // return \u0026#34;\u0026#34;, err  // }  // responseText = string(body)  //} else {  // // If master is not registered fall back to old method of using SSH.  // if provider == \u0026#34;gke\u0026#34; {  // klog.Infof(\u0026#34;%s: not grabbing scheduler metrics through master SSH: unsupported for gke\u0026#34;, s)  // return \u0026#34;\u0026#34;, nil  // }  //  // cmd := \u0026#34;curl -X \u0026#34; + opUpper + \u0026#34; http://localhost:10251/metrics\u0026#34;  // sshResult, err := measurementutil.SSH(cmd, host+\u0026#34;:22\u0026#34;, provider)  // if err != nil || sshResult.Code != 0 {  // return \u0026#34;\u0026#34;, fmt.Errorf(\u0026#34;unexpected error (code: %d) in ssh connection to master: %#v\u0026#34;, sshResult.Code, err)  // }  // responseText = sshResult.Stdout  //}  // curl http://localhost:10251/metrics 这个命令测试可用  cmd := \u0026#34;curl -X \u0026#34; + opUpper + \u0026#34; http://localhost:10251/metrics\u0026#34; sshResult, err := measurementutil.SSH(cmd, host+\u0026#34;:22\u0026#34;, provider) if err != nil || sshResult.Code != 0 { return \u0026#34;\u0026#34;, fmt.Errorf(\u0026#34;unexpected error (code: %d) in ssh connection to master: %#v\u0026#34;, sshResult.Code, err) } responseText = sshResult.Stdout // masterRegistered时，client接口处理有问题，统一改使用curl -X 方式处理GET和DELETE add by wangb end  return responseText, nil }   6. 测试结果指标异常输出 不是问题，这是测试工具成功生效，并返回提示断言信息\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  I1214 15:25:56.117594 96634 wait_for_controlled_pods.go:235] WaitForControlledPodsRunning: running 0, deleted 2, timeout: 0, unknown: 0 I1214 15:25:56.117625 96634 wait_for_controlled_pods.go:249] WaitForControlledPodsRunning: 0/0 ReplicationControllers are running with all pods I1214 15:25:56.124212 96634 simple_test_executor.go:128] Step \u0026#34;Deleting saturation pods\u0026#34; ended I1214 15:25:56.245924 96634 api_responsiveness.go:119] APIResponsiveness: WARNING Top latency metric: {Resource:endpoints Subresource: Verb:PUT Scope:namespace Latency:{Perc50:2.65ms Perc90:22.594ms Perc99:1.122221s} Count:22}; threshold: 1s I1214 15:25:56.245949 96634 api_responsiveness.go:119] APIResponsiveness: WARNING Top latency metric: {Resource:namespaces Subresource: Verb:GET Scope:cluster Latency:{Perc50:11.99ms Perc90:1.005472s Perc99:1.084129s} Count:13}; threshold: 1s I1214 15:25:56.245957 96634 api_responsiveness.go:119] APIResponsiveness: WARNING Top latency metric: {Resource:nodes Subresource:status Verb:PATCH Scope:cluster Latency:{Perc50:1.00345s Perc90:1.00345s Perc99:1.00345s} Count:1}; threshold: 1s I1214 15:25:56.245962 96634 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource:status Verb:PATCH Scope:namespace Latency:{Perc50:3.777ms Perc90:13.656ms Perc99:173.072ms} Count:88}; threshold: 1s I1214 15:25:56.245966 96634 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:GET Scope:namespace Latency:{Perc50:1.88ms Perc90:11.522ms Perc99:87.668ms} Count:156}; threshold: 1s I1214 15:25:56.821263 96634 resource_usage.go:124] ResourceUsageSummary: gathering resource usage... I1214 15:25:56.823909 96634 container_resource_gatherer.go:172] Closed stop channel. Waiting for 1 workers I1214 15:25:56.824075 96634 resource_gather_worker.go:90] Closing worker for node1 I1214 15:25:56.824118 96634 container_resource_gatherer.go:180] Waitgroup finished. I1214 15:25:56.824313 96634 system_pod_metrics.go:82] skipping collection of system pod metrics I1214 15:26:06.865304 96634 simple_test_executor.go:345] Resources cleanup time: 10.040658542s E1214 15:26:06.865325 96634 clusterloader.go:177] -------------------------------------------------------------------------------- E1214 15:26:06.865328 96634 clusterloader.go:178] Test Finished E1214 15:26:06.865330 96634 clusterloader.go:179] Test: /home/wangb/perf-test/clusterloader2/testing/density/config2.yaml E1214 15:26:06.865335 96634 clusterloader.go:180] Status: Fail E1214 15:26:06.865338 96634 clusterloader.go:182] Errors: [measurement call APIResponsiveness - APIResponsiveness error: top latency metric: there should be no high-latency requests, but: [got: {Resource:endpoints Subresource: Verb:PUT Scope:namespace Latency:{Perc50:2.65ms Perc90:22.594ms Perc99:1.122221s} Count:22}; expected perc99 \u0026lt;= 1s got: {Resource:namespaces Subresource: Verb:GET Scope:cluster Latency:{Perc50:11.99ms Perc90:1.005472s Perc99:1.084129s} Count:13}; expected perc99 \u0026lt;= 1s got: {Resource:nodes Subresource:status Verb:PATCH Scope:cluster Latency:{Perc50:1.00345s Perc90:1.00345s Perc99:1.00345s} Count:1}; expected perc99 \u0026lt;= 1s]] E1214 15:26:06.865341 96634 clusterloader.go:184] -------------------------------------------------------------------------------- F1214 15:26:06.866736 96634 clusterloader.go:276] 1 tests have failed!   由上看出，由于时延性能指标超过门限值1s，测试工具认为测试不通过。\n修改下 测试配置文件中的PODS_PER_NODE参数，由10改为2，负载变小，则测试通过\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  I1214 15:35:53.874477 111782 wait_for_controlled_pods.go:235] WaitForControlledPodsRunning: running 0, deleted 2, timeout: 0, unknown: 0 I1214 15:35:53.874751 111782 wait_for_controlled_pods.go:249] WaitForControlledPodsRunning: 0/0 ReplicationControllers are running with all pods I1214 15:35:53.874765 111782 simple_test_executor.go:128] Step \u0026#34;Deleting saturation pods\u0026#34; ended I1214 15:35:53.956315 111782 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:replicationcontrollers Subresource:status Verb:PUT Scope:namespace Latency:{Perc50:3.108ms Perc90:9.428ms Perc99:11.831ms} Count:11}; threshold: 1s I1214 15:35:53.956378 111782 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource:status Verb:PATCH Scope:namespace Latency:{Perc50:2.767ms Perc90:7.49ms Perc99:9.821ms} Count:21}; threshold: 1s I1214 15:35:53.956384 111782 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:GET Scope:namespace Latency:{Perc50:1.797ms Perc90:5.05ms Perc99:9.388ms} Count:36}; threshold: 1s I1214 15:35:53.956388 111782 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:pods Subresource: Verb:POST Scope:namespace Latency:{Perc50:7.554ms Perc90:8.879ms Perc99:8.879ms} Count:4}; threshold: 1s I1214 15:35:53.956392 111782 api_responsiveness.go:119] APIResponsiveness: Top latency metric: {Resource:services Subresource: Verb:GET Scope:namespace Latency:{Perc50:8.757ms Perc90:8.757ms Perc99:8.757ms} Count:1}; threshold: 1s I1214 15:35:54.364397 111782 resource_usage.go:124] ResourceUsageSummary: gathering resource usage... I1214 15:35:54.364444 111782 container_resource_gatherer.go:172] Closed stop channel. Waiting for 1 workers I1214 15:35:54.364648 111782 resource_gather_worker.go:90] Closing worker for node1 I1214 15:35:54.364655 111782 container_resource_gatherer.go:180] Waitgroup finished. I1214 15:35:54.366369 111782 system_pod_metrics.go:82] skipping collection of system pod metrics I1214 15:36:04.390697 111782 simple_test_executor.go:345] Resources cleanup time: 10.023892674s I1214 15:36:04.390750 111782 clusterloader.go:177] -------------------------------------------------------------------------------- I1214 15:36:04.390753 111782 clusterloader.go:178] Test Finished I1214 15:36:04.390756 111782 clusterloader.go:179] Test: /home/wangb/perf-test/clusterloader2/testing/density/config2.yaml I1214 15:36:04.390758 111782 clusterloader.go:180] Status: Success I1214 15:36:04.390760 111782 clusterloader.go:184] --------------------------------------------------------------------------------   6 总结  perf-test clusterloader2工具主要提供了性能压测，可配置性好，方便编写测试用例，并且统计了相应的性能指标 clusterloader2内置实现了k8s指标采集处理和指标阈值定义，参考文档：Kubernetes scalability and performance SLIs/SLOs clusterloader2没有详细的使用说明文档，目前来看不是可以拿来直接运行使用。所遇到问题一般只能依靠自己解决。 由于上面第3点，所遇问题较多，一般多涉及测试工具环境配置参数，另外clusterloader2对一些参数使用的是硬编码方式，导致无法直接使用原有工具，只能修改源码进行测试适配。 测试使用clusterloader2，需要详细了解其设计方案，才能运行测试用例 进行集群测试，需要了解集群测试指标定义，再编写测试配置 测试时需要预估下测试pod数量和内存占用情况，否则会引起OOM。 clusterloader2并不是一个拿来即用的测试工具，还需结合测试环境进行改造适配，更像是K8S内部使用的类似脚手架的东西  7 附录 参考命令\n批量删除k8s测试命名空间及其资源，这里测试数据默认使用了test-开头的命令规则\n1  kubectl get ns |grep test- |awk \u0026#39;{print $1}\u0026#39; |xargs kubectl delete ns --force --grace-period=0   测试中如果出现异常，系统会残留有测试使用的资源参数，这里需要对实际情况进行调整\n测试完成后的测试资源清理（如果测试后有测试数据资源残留的话）：\n 测试ns、rc、pod清理 hollow-node 桩节点清理  K8S的SLI (服务等级指标) 和 SLO (服务等级目标) Kubernetes 社区提供了 SLI (服务等级指标) 和 SLO (服务等级目标) 系统性能测试、分析文档 Kubernetes scalability and performance SLIs/SLOs。模拟出一个 K8s cluster（Kubemark cluster），不受资源限制。cluster 中 master 是真实的机器，所有的 nodes 是 Hollow nodes。Hollow nodes 不会调用Docker，测试一套 K8s API 调用的完整流程，不会真正创建 pod。\n社区开发了 perf-test/clusterloader2，可配置性好，并且统计了相应的性能指标\nkubemark 不调用 CRI 接口之外，其它行为和 kubelet 基本一致\nEtcd监控指标 参考: https://github.com/coreos/etcd/blob/master/Documentation/metrics.md\n领导者相关 etcd_server_has_leader etcd是否有leader etcd_server_leader_changes_seen_total etcd的leader变换次数 etcd_debugging_mvcc_db_total_size_in_bytes 数据库的大小 process_resident_memory_bytes 进程驻留内存\n网络相关 grpc_server_started_total grpc(高性能、开源的通用RPC(远程过程调用)框架)服务器启动总数 etcd_network_client_grpc_received_bytes_total 接收到grpc客户端的字节总数 etcd_network_client_grpc_sent_bytes_total 发送给grpc客户端的字节总数 etcd_network_peer_received_bytes_total etcd网络对等方接收的字节总数(对等网络，即对等计算机网络，是一种在对等者（Peer）之间分配任务和工作负载的分布式应用架构，是对等计算模型在应用层形成的一种组网或网络形式) etcd_network_peer_sent_bytes_total etcd网络对等方发送的字节总数\n提案相关 etcd_server_proposals_failed_total 目前正在处理的提案(提交会议讨论决定的建议。)数量 etcd_server_proposals_pending 失败提案总数 etcd_server_proposals_committed_total 已落实共识提案的总数。 etcd_server_proposals_applied_total 已应用的共识提案总数。\n这些指标描述了磁盘操作的状态。 etcd_disk_backend_commit_duration_seconds_sum etcd磁盘后端提交持续时间秒数总和 etcd_disk_backend_commit_duration_seconds_bucket etcd磁盘后端提交持续时间\n快照 etcd_debugging_snap_save_total_duration_seconds_sum etcd快照保存用时\n文件 process_open_fds{service=\u0026ldquo;etcd-k8s\u0026rdquo;} 打开文件描述符的数量 process_max_fds{service=\u0026ldquo;etcd-k8s\u0026rdquo;} 打开文件描述符的最大数量 etcd_disk_wal_fsync_duration_seconds_sum Wal(预写日志系统)调用的fsync(将文件数据同步到硬盘)的延迟分布 etcd_disk_wal_fsync_duration_seconds_bucket 后端调用的提交的延迟分布\n参考文章\n  Kubernetes测试系列 - 性能测试\n  kubernetes性能指标体系：clusterloader2\n  clusterloader2的漫漫踩坑路：最详细解析与使用指南\n  clusterloader2设计说明：Cluster loader vision\n  etcd指标监控，参考文章\n ","permalink":"http://bingerambo.com/2020-12-15-perf-test-clusterloader/","tags":["K8S"],"title":"K8S集群性能测试-clusterloader"},{"categories":["K8S"],"contents":"了解如何使用kubemark对k8s组件进行性能测试\n1 背景 项目想对k8s组件进行集群性能测试。原有组件如调度器，已有的测试工具多是单元测试。需要寻找一种可以对k8s集群进行性能测试。比如多多节点大集群规模下的调度器性能指标如何？\n考虑使用k8s项目自带的性能测试组件kubemark。\n2 kubemark 介绍 kubemark 是 K8s 官方给出的性能测试工具，能够不受任何资源限制，模拟出一个大规模 K8s 集群。其主要架构如图所示:需要一个外部 K8s 集群（external cluster） 以及一个机器节点运行 kubemark master，即另外一个 K8s 集群，但是只有一个 master 节点。我们需要在 external cluster 中部署运行 hollow pod，这些 pod 会主动向 kubemark 集群注册，并成为 kubemark 集群中的 hollow node(虚拟节点)。然后我们就可以在 kubemark 集群中进行 e2e 测试。虽然与真实集群的稍微有点误差，不过可以代表真实集群的数据。\n  本文则只构造了kubemark组件，且只使用了测试集群，即外部 K8s 集群（external cluster），未使用第2个kubemark集群。目的为测试集群中的master组件，如调度器和控制器等。另外，此方式还可以自己使用第三方测试工具和框架\n  kubemark构造 1. 编译kubemark 在 K8s 源码路径下构建 kubemark，生成的二进制文件在 _output/bin 目录下。\n1 2 3  # KUBE_BUILD_PLATFORMS=linux/amd64 make kubemark GOFLAGS=-v GOGCFLAGS=\u0026#34;-N -l\u0026#34; make kubemark GOGCFLAGS=\u0026#34;-N -l\u0026#34;   2. 构建kubemark镜像 将生成的 kubemark 二进制文件从 _output/bin 复制到 cluster/images/kubemark 目录下。\n1  cp _output/bin/kubemark cluster/images/kubemark/   并在该目录下执行构建镜像命令，生成镜像：staging-registry.cn-hangzhou.aliyuncs.com/google_containers/kubemark:v1.14.8。\n1 2 3 4  # IMAGE_TAG=v1.14.3 make build cd cluster/images/kubemark/ IMAGE_TAG=v1.14.8 make build   3. 保存镜像至kubemark.tar 4. kubemark部署到测试集群 在测试集群中的所有node节点中，导入该kubemark镜像。用于启动桩节点。 接下来进行桩节点hollow-node启动配置操作\n1 2 3 4 5 6 7 8 9 10 11 12  # 以下命令在测试集群的master节点上执行 # 从kubemark-master节点（191节点）拷贝过来kubeconfig文件，到测试集群的master节点中 scp -r 192.168.182.191:/root/.kube/config /home/wangb/ kubectl create ns kubemark kubectl create configmap node-configmap -n kubemark --from-literal=content.type=\u0026#34;test-cluster\u0026#34; # kubectl create secret generic kubeconfig --type=Opaque --namespace=kubemark --from-file=kubelet.kubeconfig=config --from-file=kubeproxy.kubeconfig=config kubectl create secret generic kubeconfig --type=Opaque --namespace=kubemark --from-file=kubelet.kubeconfig=/root/.kube/config --from-file=kubeproxy.kubeconfig=/root/.kube/config   5. 在测试集群中启动hollow nodes 1  kubectl create -f hollow-node-sts.yaml -n kubemark   测试pod 启动桩节点，hollow-node-sts.yaml的默认配置如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127  apiVersion:v1kind:Servicemetadata:name:hollow-nodenamespace:kubemarkspec:clusterIP:Noneports:- port:80protocol:TCPtargetPort:80selector:name:hollow-node---apiVersion:apps/v1kind:StatefulSetmetadata:name:hollow-nodenamespace:kubemarkspec:podManagementPolicy:Parallelreplicas:6selector:matchLabels:name:hollow-nodeserviceName:hollow-nodetemplate:metadata:labels:name:hollow-nodespec:initContainers:- name:init-inotify-limitimage:docker.io/busybox:latestimagePullPolicy:IfNotPresentcommand:[\u0026#39;sysctl\u0026#39;,\u0026#39;-w\u0026#39;,\u0026#39;fs.inotify.max_user_instances=200\u0026#39;]securityContext:privileged:truevolumes:- name:kubeconfig-volumesecret:secretName:kubeconfig- name:logs-volumehostPath:path:/var/logcontainers:- name:hollow-kubeletimage:staging-registry.cn-hangzhou.aliyuncs.com/google_containers/kubemark:v1.14.8imagePullPolicy:IfNotPresentports:- containerPort:4194- containerPort:10250- containerPort:10255env:- name:CONTENT_TYPEvalueFrom:configMapKeyRef:name:node-configmapkey:content.type- name:NODE_NAMEvalueFrom:fieldRef:fieldPath:metadata.namecommand:- /bin/sh- -c- /kubemark --morph=kubelet --name=$(NODE_NAME) --kubeconfig=/kubeconfig/kubelet.kubeconfig $(CONTENT_TYPE) --alsologtostderr --v=2volumeMounts:- name:kubeconfig-volumemountPath:/kubeconfigreadOnly:true- name:logs-volumemountPath:/var/logresources:requests:cpu:20mmemory:50MsecurityContext:privileged:true- name:hollow-proxyimage:staging-registry.cn-hangzhou.aliyuncs.com/google_containers/kubemark:v1.14.8imagePullPolicy:IfNotPresentenv:- name:CONTENT_TYPEvalueFrom:configMapKeyRef:name:node-configmapkey:content.type- name:NODE_NAMEvalueFrom:fieldRef:fieldPath:metadata.namecommand:- /bin/sh- -c- /kubemark --morph=proxy --name=$(NODE_NAME) --use-real-proxier=false --kubeconfig=/kubeconfig/kubeproxy.kubeconfig $(CONTENT_TYPE) --alsologtostderr --v=2volumeMounts:- name:kubeconfig-volumemountPath:/kubeconfigreadOnly:true- name:logs-volumemountPath:/var/logresources:requests:cpu:20mmemory:50Mtolerations:- effect:NoExecutekey:node.kubernetes.io/unreachableoperator:Exists- effect:NoExecutekey:node.kubernetes.io/not-readyoperator:Existsaffinity:nodeAffinity:requiredDuringSchedulingIgnoredDuringExecution:# 硬策略nodeSelectorTerms:- matchExpressions:- key:nameoperator:NotInvalues:- hollow-node- key:node-role.kubernetes.io/masteroperator:NotInvalues:- \u0026#34;true\u0026#34;  由上可知，hollow-node实际上是启动过了kubelet和proxy的2个进程，后来分析源码确实如此。\n写个测试pod，验证桩node是否可用，test-pod.yaml如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  apiVersion:v1kind:Podmetadata:name:myapp-podlabels:app:myappversion:v1spec:containers:- name:appimage:docker.io/busybox:latestimagePullPolicy:IfNotPresentcommand:[\u0026#39;sleep\u0026#39;,\u0026#39;3600\u0026#39;]securityContext:privileged:trueaffinity:nodeAffinity:requiredDuringSchedulingIgnoredDuringExecution:# 硬策略nodeSelectorTerms:- matchExpressions:- key:node-role.kubernetes.io/nodeoperator:NotInvalues:- \u0026#34;true\u0026#34;  节点信息 hollow-node-0, 此信息为默认信息\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50  Name: hollow-node-0 Roles: \u0026lt;none\u0026gt; Labels: beta.kubernetes.io/arch=amd64 beta.kubernetes.io/os=linux kubernetes.io/arch=amd64 kubernetes.io/hostname=hollow-node-0 kubernetes.io/os=linux Annotations: node.alpha.kubernetes.io/ttl: 0 CreationTimestamp: Mon, 07 Dec 2020 17:25:15 +0800 Taints: \u0026lt;none\u0026gt; Unschedulable: false Conditions: Type Status LastHeartbeatTime LastTransitionTime Reason Message ---- ------ ----------------- ------------------ ------ ------- MemoryPressure False Tue, 08 Dec 2020 09:37:21 +0800 Mon, 07 Dec 2020 17:25:15 +0800 KubeletHasSufficientMemory kubelet has sufficient memory available DiskPressure False Tue, 08 Dec 2020 09:37:21 +0800 Mon, 07 Dec 2020 17:25:15 +0800 KubeletHasNoDiskPressure kubelet has no disk pressure PIDPressure False Tue, 08 Dec 2020 09:37:21 +0800 Mon, 07 Dec 2020 17:25:15 +0800 KubeletHasSufficientPID kubelet has sufficient PID available Ready True Tue, 08 Dec 2020 09:37:21 +0800 Mon, 07 Dec 2020 17:25:15 +0800 KubeletReady kubelet is posting ready status Addresses: InternalIP: 10.233.96.39 Hostname: hollow-node-0 Capacity: cpu: 1 ephemeral-storage: 0 memory: 3840Mi pods: 110 Allocatable: cpu: 1 ephemeral-storage: 0 memory: 3840Mi pods: 110 System Info: Machine ID: System UUID: Boot ID: Kernel Version: 3.16.0-0.bpo.4-amd64 OS Image: Debian GNU/Linux 7 (wheezy) Operating System: linux Architecture: amd64 Container Runtime Version: docker://1.13.1 Kubelet Version: v0.0.0-master+4d3c9e0c Kube-Proxy Version: v0.0.0-master+4d3c9e0c PodCIDR: 10.233.98.0/24 Non-terminated Pods: (3 in total) Namespace Name CPU Requests CPU Limits Memory Requests Memory Limits AGE --------- ---- ------------ ---------- --------------- ------------- --- kube-system calico-node-29z7g 150m (15%) 300m (30%) 64M (1%) 500M (12%) 16h kube-system kube-proxy-8wcss 0 (0%) 0 (0%) 0 (0%) 0 (0%) 16h kube-system metrics-server-84d6dbd58b-6vqmf 50m (5%) 145m (14%) 125Mi (3%) 375Mi (9%) 16h   作业运行到hollow node\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81  [root@node1 .kube]# kubectl get po -A -owide NAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES default myapp-pod 1/1 Running 0 6s 10.94.251.209 hollow-node-1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-77l7w 0/1 Init:0/1 0 20m 10.233.96.20 hollow-node-3 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-fhlsn 0/1 Init:0/1 0 20m 10.233.96.21 hollow-node-0 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-g9fx8 0/1 Init:0/1 0 20m 10.233.96.19 hollow-node-5 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-gdrlk 0/1 Init:0/1 0 20m 10.233.96.17 hollow-node-1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-lnzc7 0/1 Init:0/1 0 20m 10.233.96.22 hollow-node-4 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-lt9jh 0/1 Init:0/1 0 20m 10.233.96.18 hollow-node-2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-ms5t6 1/1 Running 0 51m 192.168.182.102 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-vxcb7 1/1 Running 0 51m 192.168.182.101 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system coredns-654c8ccdc8-575qx 1/1 Running 0 53m 10.233.90.74 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system coredns-654c8ccdc8-m8ntn 0/1 Pending 0 174d \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system dns-autoscaler-77445c9c8b-b565h 1/1 Running 0 53m 10.233.90.65 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-apiserver-node1 1/1 Running 11 51m 192.168.182.101 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-controller-manager-node1 1/1 Running 11 51m 192.168.182.101 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-72xn7 0/1 ContainerCreating 0 20m 10.233.96.21 hollow-node-0 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-8jw9r 0/1 ContainerCreating 0 20m 10.233.96.19 hollow-node-5 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-92jzz 0/1 ContainerCreating 0 20m 10.233.96.20 hollow-node-3 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-djxjg 0/1 ContainerCreating 0 20m 10.233.96.18 hollow-node-2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-dsghn 1/1 Running 0 51m 192.168.182.101 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-gjzq8 1/1 Running 0 51m 192.168.182.102 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-lpb8m 0/1 ContainerCreating 0 20m 10.233.96.17 hollow-node-1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-sfjlq 0/1 ContainerCreating 0 20m 10.233.96.22 hollow-node-4 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-scheduler-node1 1/1 Running 11 51m 192.168.182.101 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system metrics-server-84d6dbd58b-rbrjd 0/2 ContainerCreating 0 20m \u0026lt;none\u0026gt; hollow-node-3 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-0 2/2 Running 0 20m 10.233.96.21 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-1 2/2 Running 0 20m 10.233.96.17 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-2 2/2 Running 0 20m 10.233.96.18 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-3 2/2 Running 0 20m 10.233.96.20 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-4 2/2 Running 0 20m 10.233.96.22 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-5 2/2 Running 0 20m 10.233.96.19 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; [root@node1 .kube]# kubectl describe po -ndefault myapp-pod Name: myapp-pod Namespace: default Priority: 0 PriorityClassName: \u0026lt;none\u0026gt; Node: hollow-node-1/10.233.96.17 Start Time: Mon, 07 Dec 2020 16:33:50 +0800 Labels: app=myapp version=v1 Annotations: \u0026lt;none\u0026gt; Status: Running IP: 10.94.251.209 Containers: app: Container ID: docker://3033a0ef90209b22 Image: docker.io/busybox:latest Image ID: docker://docker.io/busybox:latest Port: \u0026lt;none\u0026gt; Host Port: \u0026lt;none\u0026gt; Command: sleep 3600 State: Running Started: Mon, 07 Dec 2020 16:33:54 +0800 Ready: True Restart Count: 0 Environment: \u0026lt;none\u0026gt; Mounts: /var/run/secrets/kubernetes.io/serviceaccount from default-token-fm7gj (ro) Conditions: Type Status Initialized True Ready True ContainersReady True PodScheduled True Volumes: default-token-fm7gj: Type: Secret (a volume populated by a Secret) SecretName: default-token-fm7gj Optional: false QoS Class: BestEffort Node-Selectors: \u0026lt;none\u0026gt; Tolerations: node.kubernetes.io/not-ready:NoExecute for 300s node.kubernetes.io/unreachable:NoExecute for 300s Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 17s default-scheduler Successfully assigned default/myapp-pod to hollow-node-1   上面的kubemark和测试hollow-node是缺省默认配置，无法满足项目的k8s测试需要，比如node的自定义资源描述等，所以还需对kubemark和测试hollow-node进行改造。\n修改kubemark（kubelet），重新编译kubemark，重新部署kubemark，查看桩节点信息（资源信息）如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70  Name: hollow-node-0 Roles: \u0026lt;none\u0026gt; Labels: beta.kubernetes.io/arch=amd64 beta.kubernetes.io/os=linux kubernetes.io/arch=amd64 kubernetes.io/hostname=hollow-node-0 kubernetes.io/os=linux Annotations: node.alpha.kubernetes.io/ttl: 0 CreationTimestamp: Tue, 08 Dec 2020 13:34:35 +0800 Taints: \u0026lt;none\u0026gt; Unschedulable: false Conditions: Type Status LastHeartbeatTime LastTransitionTime Reason Message ---- ------ ----------------- ------------------ ------ ------- MemoryPressure False Tue, 08 Dec 2020 13:34:35 +0800 Tue, 08 Dec 2020 13:34:35 +0800 KubeletHasSufficientMemory kubelet has sufficient memory available DiskPressure False Tue, 08 Dec 2020 13:34:35 +0800 Tue, 08 Dec 2020 13:34:35 +0800 KubeletHasNoDiskPressure kubelet has no disk pressure PIDPressure False Tue, 08 Dec 2020 13:34:35 +0800 Tue, 08 Dec 2020 13:34:35 +0800 KubeletHasSufficientPID kubelet has sufficient PID available Ready True Tue, 08 Dec 2020 13:34:35 +0800 Tue, 08 Dec 2020 13:34:35 +0800 KubeletReady kubelet is posting ready status Addresses: InternalIP: 10.233.96.50 Hostname: hollow-node-0 Capacity: cpu: 72 ephemeral-storage: 15726578Mi inspur.com/gpu: 99999 inspur.com/rdma-hca: 99999 memory: 256Gi nvidia.com/gpu: 8 pods: 110 Allocatable: cpu: 72 ephemeral-storage: 15726578Mi inspur.com/gpu: 99999 inspur.com/rdma-hca: 99999 memory: 256Gi nvidia.com/gpu: 8 pods: 110 System Info: Machine ID: System UUID: Boot ID: Kernel Version: 3.16.0-0.bpo.4-amd64 OS Image: Debian GNU/Linux 7 (wheezy) Operating System: linux Architecture: amd64 Container Runtime Version: docker://1.13.1 Kubelet Version: v0.0.0-master+4d3c9e0c Kube-Proxy Version: v0.0.0-master+4d3c9e0c PodCIDR: 10.233.67.0/24 Non-terminated Pods: (3 in total) Namespace Name CPU Requests CPU Limits Memory Requests Memory Limits AGE --------- ---- ------------ ---------- --------------- ------------- --- kube-system calico-node-n5528 150m (0%) 300m (0%) 64M (0%) 500M (0%) 14s kube-system kube-proxy-fxcs4 0 (0%) 0 (0%) 0 (0%) 0 (0%) 14s kube-system metrics-server-84d6dbd58b-sx7sl 50m (0%) 145m (0%) 125Mi (0%) 375Mi (0%) 8s Allocated resources: (Total limits may be over 100 percent, i.e., overcommitted.) Resource Requests Limits -------- -------- ------ cpu 200m (0%) 445m (0%) memory 195072k (0%) 893216k (0%) ephemeral-storage 0 (0%) 0 (0%) inspur.com/gpu 0 0 inspur.com/rdma-hca 0 0 nvidia.com/gpu 0 0 Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Starting 16s kube-proxy, hollow-node-0 Starting kube-proxy.   然后再运行测试pod，pod定义如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  apiVersion:v1kind:Podmetadata:name:myapp-podlabels:app:myappversion:v1spec:containers:- name:appimage:docker.io/busybox:latestimagePullPolicy:IfNotPresentcommand:[\u0026#39;sleep\u0026#39;,\u0026#39;3600\u0026#39;]securityContext:privileged:trueresources:limits:cpu:\u0026#34;1\u0026#34;memory:\u0026#34;2Mi\u0026#34;nvidia.com/gpu:\u0026#34;1\u0026#34;requests:cpu:\u0026#34;1\u0026#34;memory:\u0026#34;2Mi\u0026#34;nvidia.com/gpu:\u0026#34;1\u0026#34;affinity:nodeAffinity:requiredDuringSchedulingIgnoredDuringExecution:# 硬策略nodeSelectorTerms:- matchExpressions:- key:node-role.kubernetes.io/nodeoperator:NotInvalues:- \u0026#34;true\u0026#34;  运行测试pod后的集群信息如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  NAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES default myapp-pod 1/1 Running 0 15s 10.142.241.4 hollow-node-3 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-6n95j 0/1 Init:0/1 0 14m 10.233.96.49 hollow-node-5 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-g5qlq 0/1 Init:0/1 0 14m 10.233.96.51 hollow-node-1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-g6rqs 0/1 Init:0/1 0 14m 10.233.96.46 hollow-node-3 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-m55zq 0/1 Init:0/1 0 14m 10.233.96.47 hollow-node-2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-ms5t6 1/1 Running 1 22h 192.168.182.102 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-n5528 0/1 Init:0/1 0 14m 10.233.96.50 hollow-node-0 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-njrr9 0/1 Init:0/1 0 14m 10.233.96.48 hollow-node-4 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system calico-node-vxcb7 1/1 Running 1 22h 192.168.182.101 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system coredns-654c8ccdc8-575qx 1/1 Running 1 22h 10.233.90.76 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system coredns-654c8ccdc8-m8ntn 0/1 Pending 0 175d \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system dns-autoscaler-77445c9c8b-b565h 1/1 Running 1 22h 10.233.90.77 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-apiserver-node1 1/1 Running 12 22h 192.168.182.101 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-controller-manager-node1 1/1 Running 12 22h 192.168.182.101 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-dsghn 1/1 Running 1 22h 192.168.182.101 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-dzll2 0/1 ContainerCreating 0 14m 10.233.96.46 hollow-node-3 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-fqfqx 0/1 ContainerCreating 0 14m 10.233.96.51 hollow-node-1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-fxcs4 0/1 ContainerCreating 0 14m 10.233.96.50 hollow-node-0 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-gjzq8 1/1 Running 1 22h 192.168.182.102 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-khv5c 0/1 ContainerCreating 0 14m 10.233.96.48 hollow-node-4 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-l7hzh 0/1 ContainerCreating 0 14m 10.233.96.49 hollow-node-5 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-proxy-r5lfv 0/1 ContainerCreating 0 14m 10.233.96.47 hollow-node-2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system kube-scheduler-node1 1/1 Running 12 22h 192.168.182.101 node1 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kube-system metrics-server-84d6dbd58b-sx7sl 0/2 ContainerCreating 0 14m \u0026lt;none\u0026gt; hollow-node-0 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-0 2/2 Running 0 14m 10.233.96.50 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-1 2/2 Running 0 14m 10.233.96.51 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-2 2/2 Running 0 14m 10.233.96.47 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-3 2/2 Running 0 14m 10.233.96.46 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-4 2/2 Running 0 14m 10.233.96.48 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; kubemark hollow-node-5 2/2 Running 0 14m 10.233.96.49 node2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt;   说明： 网络插件和proxy组件的非running态，并不影响集群测试使用，比如proxy使用了\u0026ndash;use-real-proxier=false，并未使用真正的iptables\n测试pod调度到了hollow-node-3上，hollow-node-3节点信息如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69  Name: hollow-node-3 Roles: \u0026lt;none\u0026gt; Labels: beta.kubernetes.io/arch=amd64 beta.kubernetes.io/os=linux kubernetes.io/arch=amd64 kubernetes.io/hostname=hollow-node-3 kubernetes.io/os=linux Annotations: node.alpha.kubernetes.io/ttl: 0 CreationTimestamp: Tue, 08 Dec 2020 13:34:35 +0800 Taints: \u0026lt;none\u0026gt; Unschedulable: false Conditions: Type Status LastHeartbeatTime LastTransitionTime Reason Message ---- ------ ----------------- ------------------ ------ ------- MemoryPressure False Tue, 08 Dec 2020 13:49:06 +0800 Tue, 08 Dec 2020 13:34:35 +0800 KubeletHasSufficientMemory kubelet has sufficient memory available DiskPressure False Tue, 08 Dec 2020 13:49:06 +0800 Tue, 08 Dec 2020 13:34:35 +0800 KubeletHasNoDiskPressure kubelet has no disk pressure PIDPressure False Tue, 08 Dec 2020 13:49:06 +0800 Tue, 08 Dec 2020 13:34:35 +0800 KubeletHasSufficientPID kubelet has sufficient PID available Ready True Tue, 08 Dec 2020 13:49:06 +0800 Tue, 08 Dec 2020 13:34:35 +0800 KubeletReady kubelet is posting ready status Addresses: InternalIP: 10.233.96.46 Hostname: hollow-node-3 Capacity: cpu: 72 ephemeral-storage: 15726578Mi inspur.com/gpu: 99999 inspur.com/rdma-hca: 99999 memory: 256Gi nvidia.com/gpu: 8 pods: 110 Allocatable: cpu: 72 ephemeral-storage: 15726578Mi inspur.com/gpu: 99999 inspur.com/rdma-hca: 99999 memory: 256Gi nvidia.com/gpu: 8 pods: 110 System Info: Machine ID: System UUID: Boot ID: Kernel Version: 3.16.0-0.bpo.4-amd64 OS Image: Debian GNU/Linux 7 (wheezy) Operating System: linux Architecture: amd64 Container Runtime Version: docker://1.13.1 Kubelet Version: v0.0.0-master+4d3c9e0c Kube-Proxy Version: v0.0.0-master+4d3c9e0c PodCIDR: 10.233.69.0/24 Non-terminated Pods: (3 in total) Namespace Name CPU Requests CPU Limits Memory Requests Memory Limits AGE --------- ---- ------------ ---------- --------------- ------------- --- default myapp-pod 1 (1%) 1 (1%) 2Mi (0%) 2Mi (0%) 33s kube-system calico-node-g6rqs 150m (0%) 300m (0%) 64M (0%) 500M (0%) 14m kube-system kube-proxy-dzll2 0 (0%) 0 (0%) 0 (0%) 0 (0%) 14m Allocated resources: (Total limits may be over 100 percent, i.e., overcommitted.) Resource Requests Limits -------- -------- ------ cpu 1150m (1%) 1300m (1%) memory 64548Ki (0%) 502097152 (0%) ephemeral-storage 0 (0%) 0 (0%) inspur.com/gpu 0 0 inspur.com/rdma-hca 0 0 nvidia.com/gpu 1 1 Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Starting 14m kube-proxy, hollow-node-3 Starting kube-proxy.   由上面测试集群信息，可以看到模拟了4个桩节点可用于测试pod调度。\nkubemark源码 程序入口 kubemark根据参数Morph，可执行kubelet和proxy流程，从而实现节点组件功能。\ncmd/kubemark/hollow-node.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72  func run(config *hollowNodeConfig) { if !knownMorphs.Has(config.Morph) { klog.Fatalf(\u0026#34;Unknown morph: %v. Allowed values: %v\u0026#34;, config.Morph, knownMorphs.List()) } // create a client to communicate with API server.  clientConfig, err := config.createClientConfigFromFile() if err != nil { klog.Fatalf(\u0026#34;Failed to create a ClientConfig: %v. Exiting.\u0026#34;, err) } client, err := clientset.NewForConfig(clientConfig) if err != nil { klog.Fatalf(\u0026#34;Failed to create a ClientSet: %v. Exiting.\u0026#34;, err) } if config.Morph == \u0026#34;kubelet\u0026#34; { cadvisorInterface := \u0026amp;cadvisortest.Fake{ NodeName: config.NodeName, } containerManager := cm.NewStubContainerManager() fakeDockerClientConfig := \u0026amp;dockershim.ClientConfig{ DockerEndpoint: libdocker.FakeDockerEndpoint, EnableSleep: true, WithTraceDisabled: true, } hollowKubelet := kubemark.NewHollowKubelet( config.NodeName, client, cadvisorInterface, fakeDockerClientConfig, config.KubeletPort, config.KubeletReadOnlyPort, containerManager, maxPods, podsPerCore, ) hollowKubelet.Run() } if config.Morph == \u0026#34;proxy\u0026#34; { client, err := clientset.NewForConfig(clientConfig) if err != nil { klog.Fatalf(\u0026#34;Failed to create API Server client: %v\u0026#34;, err) } iptInterface := fakeiptables.NewFake() sysctl := fakesysctl.NewFake() execer := \u0026amp;fakeexec.FakeExec{} eventBroadcaster := record.NewBroadcaster() recorder := eventBroadcaster.NewRecorder(legacyscheme.Scheme, v1.EventSource{Component: \u0026#34;kube-proxy\u0026#34;, Host: config.NodeName}) hollowProxy, err := kubemark.NewHollowProxyOrDie( config.NodeName, client, client.CoreV1(), iptInterface, sysctl, execer, eventBroadcaster, recorder, config.UseRealProxier, config.ProxierSyncPeriod, config.ProxierMinSyncPeriod, ) if err != nil { klog.Fatalf(\u0026#34;Failed to create hollowProxy instance: %v\u0026#34;, err) } hollowProxy.Run() } }   hollow_kubelet pkg/kubemark/hollow_kubelet\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58  type HollowKubelet struct { KubeletFlags *options.KubeletFlags KubeletConfiguration *kubeletconfig.KubeletConfiguration KubeletDeps *kubelet.Dependencies } func NewHollowKubelet( nodeName string, client *clientset.Clientset, cadvisorInterface cadvisor.Interface, dockerClientConfig *dockershim.ClientConfig, kubeletPort, kubeletReadOnlyPort int, containerManager cm.ContainerManager, maxPods int, podsPerCore int, ) *HollowKubelet { // -----------------  // Static config  // -----------------  f, c := GetHollowKubeletConfig(nodeName, kubeletPort, kubeletReadOnlyPort, maxPods, podsPerCore) // -----------------  // Injected objects  // -----------------  volumePlugins := emptydir.ProbeVolumePlugins() volumePlugins = append(volumePlugins, secret.ProbeVolumePlugins()...) volumePlugins = append(volumePlugins, projected.ProbeVolumePlugins()...) d := \u0026amp;kubelet.Dependencies{ KubeClient: client, HeartbeatClient: client, DockerClientConfig: dockerClientConfig, CAdvisorInterface: cadvisorInterface, Cloud: nil, OSInterface: \u0026amp;containertest.FakeOS{}, ContainerManager: containerManager, VolumePlugins: volumePlugins, TLSOptions: nil, OOMAdjuster: oom.NewFakeOOMAdjuster(), Mounter: mount.New(\u0026#34;\u0026#34; /* default mount path */), Subpather: \u0026amp;subpath.FakeSubpath{}, } return \u0026amp;HollowKubelet{ KubeletFlags: f, KubeletConfiguration: c, KubeletDeps: d, } } // Starts this HollowKubelet and blocks. func (hk *HollowKubelet) Run() { if err := kubeletapp.RunKubelet(\u0026amp;options.KubeletServer{ KubeletFlags: *hk.KubeletFlags, KubeletConfiguration: *hk.KubeletConfiguration, }, hk.KubeletDeps, false); err != nil { klog.Fatalf(\u0026#34;Failed to run HollowKubelet: %v. Exiting.\u0026#34;, err) } select {} }   hollow_proxy pkg/kubemark/hollow_proxy\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98  type HollowProxy struct { ProxyServer *proxyapp.ProxyServer } type FakeProxier struct{} func (*FakeProxier) Sync() {} func (*FakeProxier) SyncLoop() { select {} } func (*FakeProxier) OnServiceAdd(service *v1.Service) {} func (*FakeProxier) OnServiceUpdate(oldService, service *v1.Service) {} func (*FakeProxier) OnServiceDelete(service *v1.Service) {} func (*FakeProxier) OnServiceSynced() {} func (*FakeProxier) OnEndpointsAdd(endpoints *v1.Endpoints) {} func (*FakeProxier) OnEndpointsUpdate(oldEndpoints, endpoints *v1.Endpoints) {} func (*FakeProxier) OnEndpointsDelete(endpoints *v1.Endpoints) {} func (*FakeProxier) OnEndpointsSynced() {} func NewHollowProxyOrDie( nodeName string, client clientset.Interface, eventClient v1core.EventsGetter, iptInterface utiliptables.Interface, sysctl utilsysctl.Interface, execer utilexec.Interface, broadcaster record.EventBroadcaster, recorder record.EventRecorder, useRealProxier bool, proxierSyncPeriod time.Duration, proxierMinSyncPeriod time.Duration, ) (*HollowProxy, error) { // Create proxier and service/endpoint handlers.  var proxier proxy.ProxyProvider var serviceHandler proxyconfig.ServiceHandler var endpointsHandler proxyconfig.EndpointsHandler if useRealProxier { // Real proxier with fake iptables, sysctl, etc underneath it.  //var err error  proxierIPTables, err := iptables.NewProxier( iptInterface, sysctl, execer, proxierSyncPeriod, proxierMinSyncPeriod, false, 0, \u0026#34;10.0.0.0/8\u0026#34;, nodeName, utilnode.GetNodeIP(client, nodeName), recorder, nil, []string{}, ) if err != nil { return nil, fmt.Errorf(\u0026#34;unable to create proxier: %v\u0026#34;, err) } proxier = proxierIPTables serviceHandler = proxierIPTables endpointsHandler = proxierIPTables } else { proxier = \u0026amp;FakeProxier{} serviceHandler = \u0026amp;FakeProxier{} endpointsHandler = \u0026amp;FakeProxier{} } // Create a Hollow Proxy instance.  nodeRef := \u0026amp;v1.ObjectReference{ Kind: \u0026#34;Node\u0026#34;, Name: nodeName, UID: types.UID(nodeName), Namespace: \u0026#34;\u0026#34;, } return \u0026amp;HollowProxy{ ProxyServer: \u0026amp;proxyapp.ProxyServer{ Client: client, EventClient: eventClient, IptInterface: iptInterface, Proxier: proxier, Broadcaster: broadcaster, Recorder: recorder, ProxyMode: \u0026#34;fake\u0026#34;, NodeRef: nodeRef, OOMScoreAdj: utilpointer.Int32Ptr(0), ResourceContainer: \u0026#34;\u0026#34;, ConfigSyncPeriod: 30 * time.Second, ServiceEventHandler: serviceHandler, EndpointsEventHandler: endpointsHandler, }, }, nil } func (hp *HollowProxy) Run() { if err := hp.ProxyServer.Run(); err != nil { klog.Fatalf(\u0026#34;Error while running proxy: %v\\n\u0026#34;, err) } }   kubemark总结  kubemark实际上是个K8S组件，包含了kubelet和一个controller，模拟桩节点主要使用了kubelet功能。 kubemark通过在真实节点上构造批量的hollow-node的pod方式，模拟运行了大量的桩节点。这些桩节点可以定时跟master同步状态和信息。 kubemark一般用于测试master节点上的组件的性能测试，比如测试调度器和控制器组件性能。 kubemark由于其构造方式，决定其不能测试node节点组件，比如kubelet性能和网络等。  3 测试框架 可参考k8s的perf-test\n  Kubernetes测试系列 - 性能测试\n  kubernetes性能指标体系：clusterloader2\n  clusterloader2的漫漫踩坑路：最详细解析与使用指南\n  clusterloader2设计说明：Cluster loader vision\n  4 附录 参考操作命令。。。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54  [root@test-master ~]# kubectl get secret -A |grep kubeconfig kubemark kubeconfig Opaque 2 94s [root@test-master ~]# kubectl describe secret -nkubemark kubeconfig Name: kubeconfig Namespace: kubemark Labels: \u0026lt;none\u0026gt; Annotations: \u0026lt;none\u0026gt; Type: Opaque Data ==== kubelet.kubeconfig: 5463 bytes kubeproxy.kubeconfig: 5463 bytes #### 如果要删除刚刚创建的secret和 configmap kubectl delete secret -nkubemark kubeconfig kubectl delete configmap -n kubemark node-configmap kubectl delete ns kubemark --force --grace-period=0 #### 强制删除资源 kubectl delete po --force --grace-period=0 -nkube-system kube-proxy-p6k42 ### 删除kubemark命名空间下所有node资源 kubectl delete no --all -n kubemark #### 设置master节点不可调度 # kubectl cordon nodename kubectl cordon node1 # kubectl uncordon nodename #取消 #### 节点打标签 kubectl label node node1 accessswitch=switch1 kubectl label node node1 groupId=defaultGroup kubectl label node node1 node-role.kubernetes.io/master=true kubectl label node node1 node-role.kubernetes.io/node=true kubectl label node node1 switchtype=ether kubectl label node node2 accessswitch=switch1 kubectl label node node2 groupId=defaultGroup kubectl label node node2 node-role.kubernetes.io/node=true kubectl label node node2 switchtype=ether   修改hollow-node信息，不是node的全部信息都可以修改更新，如capacity等字段无法更新\n1  kubectl patch node hollow-node-0 -p \u0026#39;{\u0026#34;spec\u0026#34;:{\u0026#34;unschedulable\u0026#34;:true}}\u0026#39;   e2e测试 编译e2e.test make WHAT=\u0026ldquo;test/e2e/e2e.test\u0026rdquo;\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  # 进入k8s项目，进行测试工具编译 make WHAT=\u0026#34;test/e2e/e2e.test\u0026#34; # 在目录下能够看到输出文件如下： [root@node1 k8s1.14.8modify-wangb]# ll _output/bin/ -h total 241M -rwxr-xr-x. 1 root root 5.9M Dec 7 10:04 conversion-gen -rwxr-xr-x. 1 root root 5.9M Dec 7 10:04 deepcopy-gen -rwxr-xr-x. 1 root root 5.9M Dec 7 10:04 defaulter-gen -rwxr-xr-x. 1 root root 110M Dec 7 17:01 e2e.test -rwxr-xr-x. 1 root root 3.5M Dec 7 10:04 go2make -rwxr-xr-x. 1 root root 2.0M Dec 7 10:04 go-bindata -rwxr-xr-x. 1 root root 99M Dec 7 10:05 kubemark -rwxr-xr-x. 1 root root 10M Dec 7 10:04 openapi-gen # 把 e2e.test 文件拷贝到测试集群的master节点上   需要注意：网上的搜到的文章大多数都是编译e2e的二进制文件直接运行\n1 2 3 4  #./e2e.test --kube-master=192.168.182.101 --host=https://192.168.182.101:6443 --ginkgo.focus=\u0026#34;\\[Performance\\]\u0026#34; --provider=local --kubeconfig=kubemark.kubeconfig --num-nodes=10 --v=3 --ginkgo.failFast --e2e-output-dir=. --report-dir=. ./e2e.test --kube-master=192.168.182.101 --host=https://192.168.182.101:6443 --ginkgo.focus=\u0026#34;\\[Performance\\]\u0026#34; --provider=local --kubeconfig=/root/.kube/config --num-nodes=4 --v=3 --ginkgo.failFast --e2e-output-dir=. --report-dir=.   但其实e2e的性能用例已经被移出主库了 https://github.com/kubernetes/kubernetes/pull/83322，所以在2019.10.1之后出的版本用上面的命令是无法运行性能测试的\nDeployment中pod创建的流程   apiserver收到创建deployment的请求，存储至etcd，告知controller-manager controller-manager创建pod的壳子，打上creationTimeStamp，发送请求到apiserver apiserver收到创建pod的请求，发送至etcd，推送到scheduler。 schduler选择node，填充nodeName，向apiserver更新pod信息。此时pod处于pending状态，pod也没有真正创建。 apiserver向etcd更新pod信息，同时推送到相应节点的kubelet kubelet创建pod，填充HostIP与resourceVersion，向apiserver发送更新请求，pod处于pending状态 apiserver更新pod信息至etcd，同时kubelet继续创建pod。等到容器都处于running状态，kubelet再次发送pod的更新请求给apiserver，此时pod running apiserver收到请求，更新到etcd中，并推送到informer中，informer记录下watchPhase    ","permalink":"http://bingerambo.com/2020-12-08-kubemark-perf-test/","tags":["K8S"],"title":"K8S集群性能测试-kubemark"},{"categories":["Markdown"],"contents":"这篇文章提供了可以在 Hugo 的文章中使用的基本 Markdown 语法示例.\n注意  这篇文章借鉴了一篇很棒的来自 Grav 的文章.\n如果你想了解 Loveit 主题的扩展 Markdown 语法, 请阅读扩展 Markdown 语法页面.\n   事实上, 编写 Web 内容很麻烦. [WYSIWYG]^(所见即所得) 编辑器帮助减轻了这一任务. 但通常会导致代码太糟, 或更糟糕的是, 网页也会很丑.\n没有通常伴随的所有复杂和丑陋的问题, Markdown 是一种更好的生成 HTML 内容的方式.\n一些主要好处是:\n Markdown 简单易学, 几乎没有多余的字符, 因此编写内容也更快. 用 Markdown 书写时出错的机会更少. 可以产生有效的 XHTML 输出. 将内容和视觉显示保持分开, 这样就不会打乱网站的外观. 可以在你喜欢的任何文本编辑器或 Markdown 应用程序中编写内容. Markdown 使用起来很有趣!  John Gruber, Markdown 的作者如是说:\n Markdown 格式的首要设计目标是更具可读性. 最初的想法是 Markdown 格式的文档应当以纯文本形式发布, 而不会看起来像被标签或格式说明所标记. 虽然 Markdown 的语法受到几种现有的文本到 HTML 转换工具的影响, 但 Markdown 语法的最大灵感来源是纯文本电子邮件的格式.\n\u0026ndash; John Gruber  话不多说, 我们来回顾一下 Markdown 的主要语法以及生成的 HTML 样式!\n技巧  :(far fa-bookmark fa-fw): 将此页保存为书签，以备将来参考!   1 标题 从 h2 到 h6 的标题在每个级别上都加上一个 ＃:\n1 2 3 4 5  ## h2 标题 ### h3 标题 #### h4 标题 ##### h5 标题 ###### h6 标题   输出的 HTML 看起来像这样:\n1 2 3 4 5  \u0026lt;h2\u0026gt;h2 标题\u0026lt;/h2\u0026gt; \u0026lt;h3\u0026gt;h3 标题\u0026lt;/h3\u0026gt; \u0026lt;h4\u0026gt;h4 标题\u0026lt;/h4\u0026gt; \u0026lt;h5\u0026gt;h5 标题\u0026lt;/h5\u0026gt; \u0026lt;h6\u0026gt;h6 标题\u0026lt;/h6\u0026gt;   标题 ID  要添加自定义标题 ID, 请在与标题相同的行中将自定义 ID 放在花括号中:\n1  ### 一个很棒的标题 {#custom-id}   输出的 HTML 看起来像这样:\n1  \u0026lt;h3 id=\u0026#34;custom-id\u0026#34;\u0026gt;一个很棒的标题\u0026lt;/h3\u0026gt;      2 注释 注释是和 HTML 兼容的：\n1 2 3  \u0026lt;!-- 这是一段注释 --\u0026gt;   不能看到以下的注释:\n3 水平线 HTML 中的 \u0026lt;hr\u0026gt; 标签是用来在段落元素之间创建一个 \u0026ldquo;专题间隔\u0026rdquo; 的. 使用 Markdown, 你可以用以下方式创建一个 \u0026lt;hr\u0026gt; 标签:\n ___: 三个连续的下划线 ---: 三个连续的破折号 ***: 三个连续的星号  呈现的输出效果如下:\n   4 段落 按照纯文本的方式书写段落, 纯文本在呈现的 HTML 中将用 \u0026lt;p\u0026gt;/\u0026lt;/p\u0026gt; 标签包裹.\n如下段落:\n1 2 3  Lorem ipsum dolor sit amet, graecis denique ei vel, at duo primis mandamus. Et legere ocurreret pri, animal tacimates complectitur ad cum. Cu eum inermis inimicus efficiendi. Labore officiis his ex, soluta officiis concludaturque ei qui, vide sensibus vim ad.   输出的 HTML 看起来像这样:\n1  \u0026lt;p\u0026gt;Lorem ipsum dolor sit amet, graecis denique ei vel, at duo primis mandamus. Et legere ocurreret pri, animal tacimates complectitur ad cum. Cu eum inermis inimicus efficiendi. Labore officiis his ex, soluta officiis concludaturque ei qui, vide sensibus vim ad.\u0026lt;/p\u0026gt;   可以使用一个空白行进行换行.\n5 内联 HTML 元素 如果你需要某个 HTML 标签 (带有一个类), 则可以简单地像这样使用:\n1 2 3 4 5 6 7  Markdown 格式的段落. \u0026lt;div class=\u0026#34;class\u0026#34;\u0026gt; 这是 \u0026lt;b\u0026gt;HTML\u0026lt;/b\u0026gt; \u0026lt;/div\u0026gt; Markdown 格式的段落.   6 强调 加粗 用于强调带有较粗字体的文本片段.\n以下文本片段会被 渲染为粗体.\n1 2  **渲染为粗体** __渲染为粗体__   输出的 HTML 看起来像这样:\n1  \u0026lt;strong\u0026gt;渲染为粗体\u0026lt;/strong\u0026gt;   斜体 用于强调带有斜体的文本片段.\n以下文本片段被 渲染为斜体.\n1 2  *渲染为斜体* _渲染为斜体_   输出的 HTML 看起来像这样:\n1  \u0026lt;em\u0026gt;渲染为斜体\u0026lt;/em\u0026gt;   删除线 按照 [GFM]^(GitHub flavored Markdown) 你可以使用删除线.\n1  ~~这段文本带有删除线.~~   呈现的输出效果如下:\n这段文本带有删除线.\n输出的 HTML 看起来像这样:\n1  \u0026lt;del\u0026gt;这段文本带有删除线.\u0026lt;/del\u0026gt;   组合 加粗, 斜体, 和删除线可以 组合使用.\n1 2 3 4  ***加粗和斜体*** ~~**删除线和加粗**~~ ~~*删除线和斜体*~~ ~~***加粗, 斜体和删除线***~~   呈现的输出效果如下:\n加粗和斜体\n删除线和加粗\n删除线和斜体\n加粗, 斜体和删除线\n输出的 HTML 看起来像这样:\n1 2 3 4  \u0026lt;em\u0026gt;\u0026lt;strong\u0026gt;加粗和斜体\u0026lt;/strong\u0026gt;\u0026lt;/em\u0026gt; \u0026lt;del\u0026gt;\u0026lt;strong\u0026gt;删除线和加粗\u0026lt;/strong\u0026gt;\u0026lt;/del\u0026gt; \u0026lt;del\u0026gt;\u0026lt;em\u0026gt;删除线和斜体\u0026lt;/em\u0026gt;\u0026lt;/del\u0026gt; \u0026lt;del\u0026gt;\u0026lt;em\u0026gt;\u0026lt;strong\u0026gt;加粗, 斜体和删除线\u0026lt;/strong\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/del\u0026gt;   7 引用 用于在文档中引用其他来源的内容块.\n在要引用的任何文本之前添加 \u0026gt;:\n1  \u0026gt; **Fusion Drive** combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined.   呈现的输出效果如下:\n Fusion Drive combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined.\n 输出的 HTML 看起来像这样:\n1 2 3 4 5  \u0026lt;blockquote\u0026gt; \u0026lt;p\u0026gt; \u0026lt;strong\u0026gt;Fusion Drive\u0026lt;/strong\u0026gt; combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined. \u0026lt;/p\u0026gt; \u0026lt;/blockquote\u0026gt;   引用也可以嵌套:\n1 2 3 4  \u0026gt; Donec massa lacus, ultricies a ullamcorper in, fermentum sed augue. Nunc augue augue, aliquam non hendrerit ac, commodo vel nisi. \u0026gt;\u0026gt; Sed adipiscing elit vitae augue consectetur a gravida nunc vehicula. Donec auctor odio non est accumsan facilisis. Aliquam id turpis in dolor tincidunt mollis ac eu diam.   呈现的输出效果如下:\n Donec massa lacus, ultricies a ullamcorper in, fermentum sed augue. Nunc augue augue, aliquam non hendrerit ac, commodo vel nisi.\n Sed adipiscing elit vitae augue consectetur a gravida nunc vehicula. Donec auctor odio non est accumsan facilisis. Aliquam id turpis in dolor tincidunt mollis ac eu diam.\n  8 列表 无序列表 一系列项的列表, 其中项的顺序没有明显关系.\n你可以使用以下任何符号来表示无序列表中的项:\n1 2 3  * 一项内容 - 一项内容 + 一项内容   例如:\n1 2 3 4 5 6 7 8 9 10 11 12  * Lorem ipsum dolor sit amet * Consectetur adipiscing elit * Integer molestie lorem at massa * Facilisis in pretium nisl aliquet * Nulla volutpat aliquam velit * Phasellus iaculis neque * Purus sodales ultricies * Vestibulum laoreet porttitor sem * Ac tristique libero volutpat at * Faucibus porta lacus fringilla vel * Aenean sit amet erat nunc * Eget porttitor lorem   呈现的输出效果如下:\n Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit  Phasellus iaculis neque Purus sodales ultricies Vestibulum laoreet porttitor sem Ac tristique libero volutpat at   Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem  输出的 HTML 看起来像这样:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;Lorem ipsum dolor sit amet\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Consectetur adipiscing elit\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Integer molestie lorem at massa\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Facilisis in pretium nisl aliquet\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Nulla volutpat aliquam velit \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;Phasellus iaculis neque\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Purus sodales ultricies\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Vestibulum laoreet porttitor sem\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Ac tristique libero volutpat at\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Faucibus porta lacus fringilla vel\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Aenean sit amet erat nunc\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Eget porttitor lorem\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt;   有序列表 一系列项的列表, 其中项的顺序确实很重要.\n1 2 3 4 5 6 7 8  1. Lorem ipsum dolor sit amet 2. Consectetur adipiscing elit 3. Integer molestie lorem at massa 4. Facilisis in pretium nisl aliquet 5. Nulla volutpat aliquam velit 6. Faucibus porta lacus fringilla vel 7. Aenean sit amet erat nunc 8. Eget porttitor lorem   呈现的输出效果如下:\n Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem  输出的 HTML 看起来像这样:\n1 2 3 4 5 6 7 8 9 10  \u0026lt;ol\u0026gt; \u0026lt;li\u0026gt;Lorem ipsum dolor sit amet\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Consectetur adipiscing elit\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Integer molestie lorem at massa\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Facilisis in pretium nisl aliquet\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Nulla volutpat aliquam velit\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Faucibus porta lacus fringilla vel\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Aenean sit amet erat nunc\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;Eget porttitor lorem\u0026lt;/li\u0026gt; \u0026lt;/ol\u0026gt;   技巧  如果你对每一项使用 1., Markdown 将自动为每一项编号. 例如:\n1 2 3 4 5 6 7 8  1. Lorem ipsum dolor sit amet 1. Consectetur adipiscing elit 1. Integer molestie lorem at massa 1. Facilisis in pretium nisl aliquet 1. Nulla volutpat aliquam velit 1. Faucibus porta lacus fringilla vel 1. Aenean sit amet erat nunc 1. Eget porttitor lorem   呈现的输出效果如下:\n Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem     任务列表 任务列表使你可以创建带有复选框的列表. 要创建任务列表, 请在任务列表项之前添加破折号 (-) 和带有空格的方括号 ([ ]). 要选择一个复选框，请在方括号之间添加 x ([x]).\n1 2 3  - [x] Write the press release - [ ] Update the website - [ ] Contact the media   呈现的输出效果如下:\n Write the press release Update the website Contact the media  9 代码 行内代码 用 ` 包装行内代码段.\n1  在这个例子中, `\u0026lt;section\u0026gt;\u0026lt;/section\u0026gt;` 会被包裹成 **代码**.   呈现的输出效果如下:\n在这个例子中, \u0026lt;section\u0026gt;\u0026lt;/section\u0026gt; 会被包裹成 代码.\n输出的 HTML 看起来像这样:\n1 2 3  \u0026lt;p\u0026gt; 在这个例子中, \u0026lt;code\u0026gt;\u0026amp;lt;section\u0026amp;gt;\u0026amp;lt;/section\u0026amp;gt;\u0026lt;/code\u0026gt; 会被包裹成 \u0026lt;strong\u0026gt;代码\u0026lt;/strong\u0026gt;. \u0026lt;/p\u0026gt;   缩进代码 将几行代码缩进至少四个空格，例如:\n1 2 3 4  // Some comments line 1 of code line 2 of code line 3 of code   呈现的输出效果如下:\n// Some comments line 1 of code line 2 of code line 3 of code  输出的 HTML 看起来像这样:\n1 2 3 4 5 6 7 8  \u0026lt;pre\u0026gt; \u0026lt;code\u0026gt; // Some comments line 1 of code line 2 of code line 3 of code \u0026lt;/code\u0026gt; \u0026lt;/pre\u0026gt;   围栏代码块 使用 \u0026ldquo;围栏\u0026rdquo; ``` 来生成一段带有语言属性的代码块.\n1 2 3  ```markdown Sample text here... ```   输出的 HTML 看起来像这样:\n1 2 3  \u0026lt;pre language-html\u0026gt; \u0026lt;code\u0026gt;Sample text here...\u0026lt;/code\u0026gt; \u0026lt;/pre\u0026gt;   语法高亮 [GFM]^(GitHub Flavored Markdown) 也支持语法高亮.\n要激活它，只需在第一个代码 \u0026ldquo;围栏\u0026rdquo; 之后直接添加你要使用的语言的文件扩展名, ```js, 语法高亮显示将自动应用于渲染的 HTML 中.\n例如, 在以下 JavaScript 代码中应用语法高亮:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  ```js grunt.initConfig({ assemble: { options: { assets: \u0026#39;docs/assets\u0026#39;, data: \u0026#39;src/data/*.{json,yml}\u0026#39;, helpers: \u0026#39;src/custom-helpers.js\u0026#39;, partials: [\u0026#39;src/partials/**/*.{hbs,md}\u0026#39;] }, pages: { options: { layout: \u0026#39;default.hbs\u0026#39; }, files: { \u0026#39;./\u0026#39;: [\u0026#39;src/templates/pages/index.hbs\u0026#39;] } } } }; ```   呈现的输出效果如下:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  grunt.initConfig({ assemble: { options: { assets: \u0026#39;docs/assets\u0026#39;, data: \u0026#39;src/data/*.{json,yml}\u0026#39;, helpers: \u0026#39;src/custom-helpers.js\u0026#39;, partials: [\u0026#39;src/partials/**/*.{hbs,md}\u0026#39;] }, pages: { options: { layout: \u0026#39;default.hbs\u0026#39; }, files: { \u0026#39;./\u0026#39;: [\u0026#39;src/templates/pages/index.hbs\u0026#39;] } } } };   注意  Hugo 文档中的 语法高亮页面 介绍了有关语法高亮的更多信息, 包括语法高亮的 shortcode.   10 表格 通过在每个单元格之间添加竖线作为分隔线, 并在标题下添加一行破折号 (也由竖线分隔) 来创建表格. 注意, 竖线不需要垂直对齐.\n1 2 3 4 5  | Option | Description | | ------ | ----------- | | data | path to data files to supply the data that will be passed into templates. | | engine | engine to be used for processing templates. Handlebars is the default. | | ext | extension to be used for dest files. |   呈现的输出效果如下:\n   Option Description     data path to data files to supply the data that will be passed into templates.   engine engine to be used for processing templates. Handlebars is the default.   ext extension to be used for dest files.    输出的 HTML 看起来像这样:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  \u0026lt;table\u0026gt; \u0026lt;thead\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;th\u0026gt;Option\u0026lt;/th\u0026gt; \u0026lt;th\u0026gt;Description\u0026lt;/th\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/thead\u0026gt; \u0026lt;tbody\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;data\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;path to data files to supply the data that will be passed into templates.\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;engine\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;engine to be used for processing templates. Handlebars is the default.\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;ext\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;extension to be used for dest files.\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/tbody\u0026gt; \u0026lt;/table\u0026gt;   文本右对齐或居中对齐  在任何标题下方的破折号右侧添加冒号将使该列的文本右对齐.\n在任何标题下方的破折号两边添加冒号将使该列的对齐文本居中.\n1 2 3 4 5  | Option | Description | |:------:| -----------:| | data | path to data files to supply the data that will be passed into templates. | | engine | engine to be used for processing templates. Handlebars is the default. | | ext | extension to be used for dest files. |   呈现的输出效果如下:\n   Option Description     data path to data files to supply the data that will be passed into templates.   engine engine to be used for processing templates. Handlebars is the default.   ext extension to be used for dest files.       11 链接 基本链接 1 2 3  \u0026lt;https://assemble.io\u0026gt; \u0026lt;contact@revolunet.com\u0026gt; [Assemble](https://assemble.io)   呈现的输出效果如下 (将鼠标悬停在链接上，没有提示):\nhttps://assemble.io\ncontact@revolunet.com\nAssemble\n输出的 HTML 看起来像这样:\n1 2 3  \u0026lt;a href=\u0026#34;https://assemble.io\u0026#34;\u0026gt;https://assemble.io\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;mailto:contact@revolunet.com\u0026#34;\u0026gt;contact@revolunet.com\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;https://assemble.io\u0026#34;\u0026gt;Assemble\u0026lt;/a\u0026gt;   添加一个标题 1  [Upstage](https://github.com/upstage/ \u0026#34;Visit Upstage!\u0026#34;)   呈现的输出效果如下 (将鼠标悬停在链接上，会有一行提示):\nUpstage\n输出的 HTML 看起来像这样:\n1  \u0026lt;a href=\u0026#34;https://github.com/upstage/\u0026#34; title=\u0026#34;Visit Upstage!\u0026#34;\u0026gt;Upstage\u0026lt;/a\u0026gt;   定位标记 定位标记使你可以跳至同一页面上的指定锚点. 例如, 每个章节:\n1 2 3 4  ## Table of Contents  * [Chapter 1](#chapter-1) * [Chapter 2](#chapter-2) * [Chapter 3](#chapter-3)   将跳转到这些部分:\n1 2 3 4 5 6 7 8  ## Chapter 1 \u0026lt;a id=\u0026#34;chapter-1\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; Content for chapter one. ## Chapter 2 \u0026lt;a id=\u0026#34;chapter-2\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; Content for chapter one. ## Chapter 3 \u0026lt;a id=\u0026#34;chapter-3\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; Content for chapter one.   注意  定位标记的位置几乎是任意的. 因为它们并不引人注目, 所以它们通常被放在同一行了.   12 脚注 脚注使你可以添加注释和参考, 而不会使文档正文混乱. 当你创建脚注时, 会在添加脚注引用的位置出现带有链接的上标编号. 读者可以单击链接以跳至页面底部的脚注内容.\n要创建脚注引用, 请在方括号中添加插入符号和标识符 ([^1]). 标识符可以是数字或单词, 但不能包含空格或制表符. 标识符仅将脚注引用与脚注本身相关联 - 在脚注输出中, 脚注按顺序编号.\n在中括号内使用插入符号和数字以及用冒号和文本来添加脚注内容 ([^1]：这是一段脚注). 你不一定要在文档末尾添加脚注. 可以将它们放在除列表, 引用和表格等元素之外的任何位置.\n1 2 3 4 5  这是一个数字脚注[^1]. 这是一个带标签的脚注[^label] [^1]: 这是一个数字脚注 [^label]: 这是一个带标签的脚注   这是一个数字脚注1.\n这是一个带标签的脚注2\n13 图片 图片的语法与链接相似, 但包含一个在前面的感叹号.\n1  ![Minion](https://octodex.github.com/images/minion.png)   或者:\n1  ![Alt text](https://octodex.github.com/images/stormtroopocat.jpg \u0026#34;The Stormtroopocat\u0026#34;)   The StormtroopocatAlt text\n\" The Stormtroopocat \n像链接一样, 图片也具有脚注样式的语法:\n1  ![Alt text][id]   The DojocatAlt text\n\" The Dojocat \n稍后在文档中提供参考内容, 用来定义 URL 的位置:\n1  [id]: https://octodex.github.com/images/dojocat.jpg \u0026#34;The Dojocat\u0026#34;   技巧  LoveIt 主题提供了一个包含更多功能的 图片的 shortcode.     这是一个数字脚注 \u0026#x21a9;\u0026#xfe0e;\n 这是一个带标签的脚注 \u0026#x21a9;\u0026#xfe0e;\n  ","permalink":"http://bingerambo.com/basic-markdown-syntax/","tags":["Markdown"],"title":"[转载]Markdown 基本语法"},{"categories":["Markdown"],"contents":"Emoji 可以通过多种方式在 Hugo 项目中启用.\nemojify 方法可以直接在模板中调用, 或者使用行内 Shortcodes.\n要全局使用 emoji, 需要在你的网站配置中设置 enableEmoji 为 true, 然后你就可以直接在文章中输入 emoji 的代码.\n它们以冒号开头和结尾，并且包含 emoji 的 代码:\n1 2 3  去露营啦! {?:}tent: 很快就回来. 真开心! {?:}joy:   呈现的输出效果如下:\n去露营啦! ⛺ 很快就回来.\n真开心! 😂\n以下符号清单是 emoji 代码的非常有用的参考.\n表情与情感 笑脸表情    图标 代码 图标 代码     😀 grinning 😃 smiley   😄 smile 😁 grin   😆 laughing satisfied 😅 sweat_smile   🤣 rofl 😂 joy   🙂 slightly_smiling_face 🙃 upside_down_face   😉 wink 😊 blush   😇 innocent      爱意表情    图标 代码 图标 代码     😍 heart_eyes 😘 kissing_heart   😗 kissing ☺️ relaxed   😚 kissing_closed_eyes 😙 kissing_smiling_eyes    吐舌头表情    图标 代码 图标 代码     😋 yum 😛 stuck_out_tongue   😜 stuck_out_tongue_winking_eye 😝 stuck_out_tongue_closed_eyes   🤑 money_mouth_face      带手的表情    图标 代码 图标 代码     🤗 hugs 🤔 thinking    中性表情    图标 代码 图标 代码     🤐 zipper_mouth_face 😐 neutral_face   😑 expressionless 😶 no_mouth   😏 smirk 😒 unamused   🙄 roll_eyes 😬 grimacing   🤥 lying_face      困倦的表情    图标 代码 图标 代码     😌 relieved 😔 pensive   😪 sleepy 🤤 drooling_face   😴 sleeping      不适的表情    图标 代码 图标 代码     😷 mask 🤒 face_with_thermometer   🤕 face_with_head_bandage 🤢 nauseated_face   🤧 sneezing_face 😵 dizzy_face    戴帽子的表情    图标 代码 图标 代码     🤠 cowboy_hat_face      戴眼镜的表情    图标 代码 图标 代码     😎 sunglasses 🤓 nerd_face    担心的表情    图标 代码 图标 代码     😕 confused 😟 worried   🙁 slightly_frowning_face ☹ frowning_face   😮 open_mouth 😯 hushed   😲 astonished 😳 flushed   😦 frowning 😧 anguished   😨 fearful 😰 cold_sweat   😥 disappointed_relieved 😢 cry   😭 sob 😱 scream   😖 confounded 😣 persevere   😞 disappointed 😓 sweat   😩 weary 😫 tired_face    否定的表情    图标 代码 图标 代码     😤 triumph 😡 pout rage   😠 angry 😈 smiling_imp   👿 imp 💀 skull   ☠️ skull_and_crossbones      特殊打扮的表情    图标 代码 图标 代码     💩 hankey poop shit 🤡 clown_face   👹 japanese_ogre 👺 japanese_goblin   👻 ghost 👽 alien   👾 space_invader 🤖 robot    猫脸表情    图标 代码 图标 代码     😺 smiley_cat 😸 smile_cat   😹 joy_cat 😻 heart_eyes_cat   😼 smirk_cat 😽 kissing_cat   🙀 scream_cat 😿 crying_cat_face   😾 pouting_cat      猴脸表情    图标 代码 图标 代码     🙈 see_no_evil 🙉 hear_no_evil   🙊 speak_no_evil      情感    图标 代码 图标 代码     💋 kiss 💌 love_letter   💘 cupid 💝 gift_heart   💖 sparkling_heart 💗 heartpulse   💓 heartbeat 💞 revolving_hearts   💕 two_hearts 💟 heart_decoration   ❣️ heavy_heart_exclamation 💔 broken_heart   ❤️ heart 💛 yellow_heart   💚 green_heart 💙 blue_heart   💜 purple_heart 🖤 black_heart   💯 100 💢 anger   💥 boom collision 💫 dizzy   💦 sweat_drops 💨 dash   🕳️ hole 💣 bomb   💬 speech_balloon 👁️‍🗨️ eye_speech_bubble   🗯️ right_anger_bubble 💭 thought_balloon   💤 zzz      人与身体 张开手掌的手势    图标 代码 图标 代码     👋 wave 🤚 raised_back_of_hand   🖐️ raised_hand_with_fingers_splayed ✋ hand raised_hand   🖖 vulcan_salute      部分手指的手势    图标 代码 图标 代码     👌 ok_hand ✌️ v   🤞 crossed_fingers 🤘 metal   🤙 call_me_hand      一根手指的手势    图标 代码 图标 代码     👈 point_left 👉 point_right   👆 point_up_2 🖕 fu middle_finger   👇 point_down ☝️ point_up    握紧的手势    图标 代码 图标 代码     👍 +1 thumbsup 👎 -1 thumbsdown   ✊ fist fist_raised 👊 facepunch fist_oncoming punch   🤛 fist_left 🤜 fist_right    两只手    图标 代码 图标 代码     👏 clap 🙌 raised_hands   👐 open_hands 🤝 handshake   🙏 pray      握住东西的手势    图标 代码 图标 代码     ✍️ writing_hand 💅 nail_care   🤳 selfie      身体部位    图标 代码 图标 代码     💪 muscle 👂 ear   👃 nose 👀 eyes   👁️ eye 👅 tongue   👄 lips      人    图标 代码 图标 代码     👶 baby 👦 boy   👧 girl :blonde_man: blonde_man person_with_blond_hair   👨 man 👩 woman   👱‍♀️ blonde_woman 👴 older_man   👵 older_woman      身体动作    图标 代码 图标 代码     🙍‍♀️ frowning_woman person_frowning 🙍‍♂️ frowning_man   🙎‍♀️ person_with_pouting_face pouting_woman 🙎‍♂️ pouting_man   🙅‍♀️ ng_woman no_good no_good_woman 🙅‍♂️ ng_man no_good_man   🙆‍♀️ ok_woman 🙆‍♂️ ok_man   💁‍♀️ information_desk_person sassy_woman tipping_hand_woman 💁‍♂️ sassy_man tipping_hand_man   🙋‍♀️ raising_hand raising_hand_woman 🙋‍♂️ raising_hand_man   🙇‍♂️ bow bowing_man 🙇‍♀️ bowing_woman   🤦‍♂️ man_facepalming 🤦‍♀️ woman_facepalming   🤷‍♂️ man_shrugging 🤷‍♀️ woman_shrugging    人物角色    图标 代码 图标 代码     👨‍⚕️ man_health_worker 👩‍⚕️ woman_health_worker   👨‍🎓 man_student 👩‍🎓 woman_student   👨‍🏫 man_teacher 👩‍🏫 woman_teacher   👨‍⚖️ man_judge 👩‍⚖️ woman_judge   👨‍🌾 man_farmer 👩‍🌾 woman_farmer   👨‍🍳 man_cook 👩‍🍳 woman_cook   👨‍🔧 man_mechanic 👩‍🔧 woman_mechanic   👨‍🏭 man_factory_worker 👩‍🏭 woman_factory_worker   👨‍💼 man_office_worker 👩‍💼 woman_office_worker   👨‍🔬 man_scientist 👩‍🔬 woman_scientist   👨‍💻 man_technologist 👩‍💻 woman_technologist   👨‍🎤 man_singer 👩‍🎤 woman_singer   👨‍🎨 man_artist 👩‍🎨 woman_artist   👨‍✈️ man_pilot 👩‍✈️ woman_pilot   👨‍🚀 man_astronaut 👩‍🚀 woman_astronaut   👨‍🚒 man_firefighter 👩‍🚒 woman_firefighter   👮‍♂️ cop policeman 👮‍♀️ policewoman   🕵 detective male_detective 🕵️‍♀️ female_detective   💂‍♂️ guardsman 💂‍♀️ guardswoman   👷‍♂️ construction_worker construction_worker_man 👷‍♀️ construction_worker_woman   🤴 prince 👸 princess   👳‍♂️ man_with_turban 👳‍♀️ woman_with_turban   👲 man_with_gua_pi_mao 🤵 man_in_tuxedo   👰 bride_with_veil 🤰 pregnant_woman    幻想的人物    图标 代码 图标 代码     👼 angel 🎅 santa   🤶 mrs_claus      人物活动    图标 代码 图标 代码     💆‍♀️ massage massage_woman 💆‍♂️ massage_man   💇‍♀️ haircut haircut_woman 💇‍♂️ haircut_man   🚶‍♂️ walking walking_man 🚶‍♀️ walking_woman   🏃‍♂️ runner running running_man 🏃‍♀️ running_woman   💃 dancer 🕺 man_dancing   🕴️ business_suit_levitating 👯‍♀️ dancers dancing_women   👯‍♂️ dancing_men      体育    图标 代码 图标 代码     🤺 person_fencing 🏇 horse_racing   ⛷️ skier 🏂 snowboarder   🏌️‍♂️ golfing_man 🏌️‍♀️ golfing_woman   🏄‍♂️ surfer surfing_man 🏄‍♀️ surfing_woman   🚣‍♂️ rowboat rowing_man 🚣‍♀️ rowing_woman   🏊‍♂️ swimmer swimming_man 🏊‍♀️ swimming_woman   ⛹️‍♂️ basketball_man ⛹️‍♀️ basketball_woman   🏋️‍♂️ weight_lifting_man 🏋️‍♀️ weight_lifting_woman   🚴‍♂️ bicyclist biking_man 🚴‍♀️ biking_woman   🚵‍♂️ mountain_bicyclist mountain_biking_man 🚵‍♀️ mountain_biking_woman   🤸‍♂️ man_cartwheeling 🤸‍♀️ woman_cartwheeling   🤼‍♂️ men_wrestling 🤼‍♀️ women_wrestling   🤽‍♂️ man_playing_water_polo 🤽‍♀️ woman_playing_water_polo   🤾‍♂️ man_playing_handball 🤾‍♀️ woman_playing_handball   🤹‍♂️ man_juggling 🤹‍♀️ woman_juggling    休息    图标 代码 图标 代码     🛀 bath 🛌 sleeping_bed    家庭    图标 代码 图标 代码     👭 two_women_holding_hands 👫 couple   👬 two_men_holding_hands 👩‍❤️‍💋‍👨 couplekiss_man_woman   👨‍❤️‍💋‍👨 couplekiss_man_man 👩‍❤️‍💋‍👩 couplekiss_woman_woman   👩‍❤️‍👨 couple_with_heart couple_with_heart_woman_man 👨‍❤️‍👨 couple_with_heart_man_man   👩‍❤️‍👩 couple_with_heart_woman_woman 👨‍👩‍👦 family family_man_woman_boy   👨‍👩‍👧 family_man_woman_girl 👨‍👩‍👧‍👦 family_man_woman_girl_boy   👨‍👩‍👦‍👦 family_man_woman_boy_boy 👨‍👩‍👧‍👧 family_man_woman_girl_girl   👨‍👨‍👦 family_man_man_boy 👨‍👨‍👧 family_man_man_girl   👨‍👨‍👧‍👦 family_man_man_girl_boy 👨‍👨‍👦‍👦 family_man_man_boy_boy   👨‍👨‍👧‍👧 family_man_man_girl_girl 👩‍👩‍👦 family_woman_woman_boy   👩‍👩‍👧 family_woman_woman_girl 👩‍👩‍👧‍👦 family_woman_woman_girl_boy   👩‍👩‍👦‍👦 family_woman_woman_boy_boy 👩‍👩‍👧‍👧 family_woman_woman_girl_girl   👨‍👦 family_man_boy 👨‍👦‍👦 family_man_boy_boy   👨‍👧 family_man_girl 👨‍👧‍👦 family_man_girl_boy   👨‍👧‍👧 family_man_girl_girl 👩‍👦 family_woman_boy   👩‍👦‍👦 family_woman_boy_boy 👩‍👧 family_woman_girl   👩‍👧‍👦 family_woman_girl_boy 👩‍👧‍👧 family_woman_girl_girl    人物符号    图标 代码 图标 代码     🗣 speaking_head 👤 bust_in_silhouette   👥 busts_in_silhouette 👣 footprints    动物与自然 哺乳动物    图标 代码 图标 代码     🐵 monkey_face 🐒 monkey   🦍 gorilla 🐶 dog   🐕 dog2 🐩 poodle   🐺 wolf 🦊 fox_face   🐱 cat 🐈 cat2   🦁 lion 🐯 tiger   🐅 tiger2 🐆 leopard   🐴 horse 🐎 racehorse   🦄 unicorn 🦌 deer   🐮 cow 🐂 ox   🐃 water_buffalo 🐄 cow2   🐷 pig 🐖 pig2   🐗 boar 🐽 pig_nose   🐏 ram 🐑 sheep   🐐 goat 🐪 dromedary_camel   🐫 camel 🐘 elephant   🦏 rhinoceros 🐭 mouse   🐁 mouse2 🐀 rat   🐹 hamster 🐰 rabbit   🐇 rabbit2 🐿️ chipmunk   🦇 bat 🐻 bear   🐨 koala 🐼 panda_face   🐾 feet paw_prints      鸟类    图标 代码 图标 代码     🦃 turkey 🐔 chicken   🐓 rooster 🐣 hatching_chick   🐤 baby_chick 🐥 hatched_chick   🐦 bird 🐧 penguin   🕊 dove 🦅 eagle   🦆 duck 🦉 owl    两栖动物    icon code icon code     🐸 frog      爬虫类    图标 代码 图标 代码     🐊 crocodile 🐢 turtle   🦎 lizard 🐍 snake   🐲 dragon_face 🐉 dragon    海洋动物    图标 代码 图标 代码     🐳 whale 🐋 whale2   🐬 dolphin flipper 🐟 fish   🐠 tropical_fish 🐡 blowfish   🦈 shark 🐙 octopus   🐚 shell      虫类    图标 代码 图标 代码     🐌 snail 🦋 butterfly   🐛 bug 🐜 ant   🐝 bee honeybee 🐞 beetle   🕷️ spider 🕸️ spider_web   🦂 scorpion      花类植物    图标 代码 图标 代码     💐 bouquet 🌸 cherry_blossom   💮 white_flower 🏵️ rosette   🌹 rose 🥀 wilted_flower   🌺 hibiscus 🌻 sunflower   🌼 blossom 🌷 tulip    其它植物    图标 代码 图标 代码     🌱 seedling 🌲 evergreen_tree   🌳 deciduous_tree 🌴 palm_tree   🌵 cactus 🌾 ear_of_rice   🌿 herb ☘️ shamrock   🍀 four_leaf_clover 🍁 maple_leaf   🍂 fallen_leaf 🍃 leaves    食物与饮料 水果    图标 代码 图标 代码     🍇 grapes 🍈 melon   🍉 watermelon 🍊 mandarin orange tangerine   🍋 lemon 🍌 banana   🍍 pineapple 🍎 apple   🍏 green_apple 🍐 pear   🍑 peach 🍒 cherries   🍓 strawberry 🥝 kiwi_fruit   🍅 tomato      蔬菜    图标 代码 图标 代码     🥑 avocado 🍆 eggplant   🥔 potato 🥕 carrot   🌽 corn 🌶️ hot_pepper   🥒 cucumber 🍄 mushroom   🥜 peanuts 🌰 chestnut    快餐    图标 代码 图标 代码     🍞 bread 🥐 croissant   🥖 baguette_bread 🥞 pancakes   🧀 cheese 🍖 meat_on_bone   🍗 poultry_leg 🥓 bacon   🍔 hamburger 🍟 fries   🍕 pizza 🌭 hotdog   🌮 taco 🌯 burrito   🥙 stuffed_flatbread 🥚 egg   🍳 fried_egg 🥘 shallow_pan_of_food   🍲 stew 🥗 green_salad   🍿 popcorn      亚洲食物    图标 代码 图标 代码     🍱 bento 🍘 rice_cracker   🍙 rice_ball 🍚 rice   🍛 curry 🍜 ramen   🍝 spaghetti 🍠 sweet_potato   🍢 oden 🍣 sushi   🍤 fried_shrimp 🍥 fish_cake   🍡 dango      海鲜    图标 代码 图标 代码     🦀 crab 🦐 shrimp   🦑 squid      甜点    图标 代码 图标 代码     🍦 icecream 🍧 shaved_ice   🍨 ice_cream 🍩 doughnut   🍪 cookie 🎂 birthday   🍰 cake 🍫 chocolate_bar   🍬 candy 🍭 lollipop   🍮 custard 🍯 honey_pot    饮料    图标 代码 图标 代码     🍼 baby_bottle 🥛 milk_glass   ☕ coffee 🍵 tea   🍶 sake 🍾 champagne   🍷 wine_glass 🍸 cocktail   🍹 tropical_drink 🍺 beer   🍻 beers 🥂 clinking_glasses   🥃 tumbler_glass      餐具    图标 代码 图标 代码     🍽️ plate_with_cutlery 🍴 fork_and_knife   🥄 spoon 🔪 hocho knife   🏺 amphora      旅游与地理 地图    图标 代码 图标 代码     🌍 earth_africa 🌎 earth_americas   🌏 earth_asia 🌐 globe_with_meridians   🗺️ world_map 🗾 japan    地理现象    图标 代码 图标 代码     🏔 mountain_snow ⛰️ mountain   🌋 volcano 🗻 mount_fuji   🏕️ camping ⛱ beach_umbrella   🏜️ desert 🏝️ desert_island   🏞️ national_park      建筑物    图标 代码 图标 代码     🏟️ stadium 🏛️ classical_building   🏗️ building_construction 🏘 houses   🏚 derelict_house 🏠 house   🏡 house_with_garden 🏢 office   🏣 post_office 🏤 european_post_office   🏥 hospital 🏦 bank   🏨 hotel 🏩 love_hotel   🏪 convenience_store 🏫 school   🏬 department_store 🏭 factory   🏯 japanese_castle 🏰 european_castle   💒 wedding 🗼 tokyo_tower   🗽 statue_of_liberty      宗教建筑    图标 代码 图标 代码     ⛪ church 🕌 mosque   🕍 synagogue ⛩️ shinto_shrine   🕋 kaaba      其它地点    图标 代码 图标 代码     ⛲ fountain ⛺ tent   🌁 foggy 🌃 night_with_stars   🏙️ cityscape 🌄 sunrise_over_mountains   🌅 sunrise 🌆 city_sunset   🌇 city_sunrise 🌉 bridge_at_night   ♨️ hotsprings 🎠 carousel_horse   🎡 ferris_wheel 🎢 roller_coaster   💈 barber 🎪 circus_tent    陆路运输    图标 代码 图标 代码     🚂 steam_locomotive 🚃 railway_car   🚄 bullettrain_side 🚅 bullettrain_front   🚆 train2 🚇 metro   🚈 light_rail 🚉 station   🚊 tram 🚝 monorail   🚞 mountain_railway 🚋 train   🚌 bus 🚍 oncoming_bus   🚎 trolleybus 🚐 minibus   🚑 ambulance 🚒 fire_engine   🚓 police_car 🚔 oncoming_police_car   🚕 taxi 🚖 oncoming_taxi   🚗 car red_car 🚘 oncoming_automobile   🚙 blue_car 🚚 truck   🚛 articulated_lorry 🚜 tractor   🏎️ racing_car 🏍 motorcycle   🛵 motor_scooter 🚲 bike   🛴 kick_scooter 🚏 busstop   🛣️ motorway 🛤️ railway_track   🛢️ oil_drum ⛽ fuelpump   🚨 rotating_light 🚥 traffic_light   🚦 vertical_traffic_light 🛑 stop_sign   🚧 construction      水路运输    图标 代码 图标 代码     ⚓ anchor ⛵ boat sailboat   🛶 canoe 🚤 speedboat   🛳️ passenger_ship ⛴️ ferry   🛥️ motor_boat 🚢 ship    空中运输    图标 代码 图标 代码     ✈️ airplane 🛩️ small_airplane   🛫 flight_departure 🛬 flight_arrival   💺 seat 🚁 helicopter   🚟 suspension_railway 🚠 mountain_cableway   🚡 aerial_tramway 🛰️ artificial_satellite   🚀 rocket      旅馆    icon code icon code     🛎️ bellhop_bell      时间    图标 代码 图标 代码     ⌛ hourglass ⏳ hourglass_flowing_sand   ⌚ watch ⏰ alarm_clock   ⏱️ stopwatch ⏲️ timer_clock   🕰️ mantelpiece_clock 🕛 clock12   🕧 clock1230 🕐 clock1   🕜 clock130 🕑 clock2   🕝 clock230 🕒 clock3   🕞 clock330 🕓 clock4   🕟 clock430 🕔 clock5   🕠 clock530 🕕 clock6   🕡 clock630 🕖 clock7   🕢 clock730 🕗 clock8   🕣 clock830 🕘 clock9   🕤 clock930 🕙 clock10   🕥 clock1030 🕚 clock11   🕦 clock1130      天空与天气    图标 代码 图标 代码     🌑 new_moon 🌒 waxing_crescent_moon   🌓 first_quarter_moon 🌔 moon waxing_gibbous_moon   🌕 full_moon 🌖 waning_gibbous_moon   🌗 last_quarter_moon 🌘 waning_crescent_moon   🌙 crescent_moon 🌚 new_moon_with_face   🌛 first_quarter_moon_with_face 🌜 last_quarter_moon_with_face   🌡️ thermometer ☀️ sunny   🌝 full_moon_with_face 🌞 sun_with_face   ⭐ star 🌟 star2   🌠 stars 🌌 milky_way   ☁️ cloud ⛅ partly_sunny   ⛈ cloud_with_lightning_and_rain 🌤 sun_behind_small_cloud   🌥 sun_behind_large_cloud 🌦 sun_behind_rain_cloud   🌧 cloud_with_rain 🌨 cloud_with_snow   🌩 cloud_with_lightning 🌪️ tornado   🌫️ fog 🌬 wind_face   🌀 cyclone 🌈 rainbow   🌂 closed_umbrella ☂️ open_umbrella   ☂️ umbrella ⛱️ parasol_on_ground   ⚡ zap ❄️ snowflake   ☃️ snowman_with_snow ☃️ snowman   ☄️ comet 🔥 fire   💧 droplet 🌊 ocean    活动 事件    图标 代码 图标 代码     🎃 jack_o_lantern 🎄 christmas_tree   🎆 fireworks 🎇 sparkler   ✨ sparkles 🎈 balloon   🎉 tada 🎊 confetti_ball   🎋 tanabata_tree 🎍 bamboo   🎎 dolls 🎏 flags   🎐 wind_chime 🎑 rice_scene   🎀 ribbon 🎁 gift   🎗️ reminder_ribbon 🎟 tickets   🎫 ticket      奖杯与奖牌    图标 代码 图标 代码     🎖️ medal_military 🏆 trophy   🏅 medal_sports 🥇 1st_place_medal   🥈 2nd_place_medal 🥉 3rd_place_medal    体育运动    图标 代码 图标 代码     ⚽ soccer ⚾ baseball   🏀 basketball 🏐 volleyball   🏈 football 🏉 rugby_football   🎾 tennis 🎳 bowling   🦗 cricket 🏑 field_hockey   🏒 ice_hockey 🏓 ping_pong   🏸 badminton 🥊 boxing_glove   🥋 martial_arts_uniform 🥅 goal_net   ⛳ golf ⛸️ ice_skate   🎣 fishing_pole_and_fish 🎽 running_shirt_with_sash   🎿 ski      游戏    图标 代码 图标 代码     🎯 dart 🎱 8ball   🔮 crystal_ball 🎮 video_game   🕹️ joystick 🎰 slot_machine   🎲 game_die ♠️ spades   ♥️ hearts ♦️ diamonds   ♣️ clubs 🃏 black_joker   🀄 mahjong 🎴 flower_playing_cards    艺术与工艺    图标 代码 图标 代码     🎭 performing_arts 🖼 framed_picture   🎨 art      物品 服装    图标 代码 图标 代码     👓 eyeglasses 🕶️ dark_sunglasses   👔 necktie 👕 shirt tshirt   👖 jeans 👗 dress   👘 kimono 👙 bikini   👚 womans_clothes 👛 purse   👜 handbag 👝 pouch   🛍️ shopping 🎒 school_satchel   👞 mans_shoe shoe 👟 athletic_shoe   👠 high_heel 👡 sandal   👢 boot 👑 crown   👒 womans_hat 🎩 tophat   🎓 mortar_board ⛑️ rescue_worker_helmet   📿 prayer_beads 💄 lipstick   💍 ring 💎 gem    声音    图标 代码 图标 代码     🔇 mute 🔈 speaker   🔉 sound 🔊 loud_sound   📢 loudspeaker 📣 mega   📯 postal_horn 🔔 bell   🔕 no_bell      音乐    图标 代码 图标 代码     🎼 musical_score 🎵 musical_note   🎶 notes 🎙️ studio_microphone   🎚️ level_slider 🎛️ control_knobs   🎤 microphone 🎧 headphones   📻 radio      乐器    图标 代码 图标 代码     🎷 saxophone 🎸 guitar   🎹 musical_keyboard 🎺 trumpet   🎻 violin 🥁 drum    电话    图标 代码 图标 代码     📱 iphone 📲 calling   ☎️ phone telephone 📞 telephone_receiver   📟 pager 📠 fax    电脑    图标 代码 图标 代码     🔋 battery 🔌 electric_plug   💻 computer 🖥️ desktop_computer   🖨️ printer ⌨️ keyboard   🖱 computer_mouse 🖲️ trackball   💽 minidisc 💾 floppy_disk   💿 cd 📀 dvd    灯光与影像    图标 代码 图标 代码     🎥 movie_camera 🎞️ film_strip   📽️ film_projector 🎬 clapper   📺 tv 📷 camera   📸 camera_flash 📹 video_camera   📼 vhs 🔍 mag   🔎 mag_right 🕯️ candle   💡 bulb 🔦 flashlight   🏮 izakaya_lantern lantern      书与纸张    图标 代码 图标 代码     📔 notebook_with_decorative_cover 📕 closed_book   📖 book open_book 📗 green_book   📘 blue_book 📙 orange_book   📚 books 📓 notebook   📒 ledger 📃 page_with_curl   📜 scroll 📄 page_facing_up   📰 newspaper 🗞️ newspaper_roll   📑 bookmark_tabs 🔖 bookmark   🏷️ label      钱    图标 代码 图标 代码     💰 moneybag 💴 yen   💵 dollar 💶 euro   💷 pound 💸 money_with_wings   💳 credit_card 💹 chart    邮件    图标 代码 图标 代码     ✉️ email envelope 📧 📧   📨 incoming_envelope 📩 envelope_with_arrow   📤 outbox_tray 📥 inbox_tray   📦 package 📫 mailbox   📪 mailbox_closed 📬 mailbox_with_mail   📭 mailbox_with_no_mail 📮 postbox   🗳 ballot_box      书写    图标 代码 图标 代码     ✏️ pencil2 ✒️ black_nib   🖋 fountain_pen 🖊 pen   🖌 paintbrush 🖍 crayon   📝 memo pencil      办公    图标 代码 图标 代码     💼 briefcase 📁 file_folder   📂 open_file_folder 🗂️ card_index_dividers   📅 date 📆 calendar   🗒 spiral_notepad 🗓 spiral_calendar   📇 card_index 📈 chart_with_upwards_trend   📉 chart_with_downwards_trend 📊 bar_chart   📋 clipboard 📌 pushpin   📍 round_pushpin 📎 paperclip   🖇 paperclips 📏 straight_ruler   📐 triangular_ruler ✂️ scissors   🗃️ card_file_box 🗄️ file_cabinet   🗑️ wastebasket      锁    图标 代码 图标 代码     🔒 lock 🔓 unlock   🔏 lock_with_ink_pen 🔐 closed_lock_with_key   🔑 key 🗝️ old_key    工具    图标 代码 图标 代码     🔨 hammer ⛏️ pick   ⚒️ hammer_and_pick 🛠️ hammer_and_wrench   🗡 dagger ⚔️ crossed_swords   🔫 gun 🏹 bow_and_arrow   🛡️ shield 🔧 wrench   🔩 nut_and_bolt ⚙️ gear   🗜 clamp ⚖ balance_scale   🔗 link ⛓️ chains    科学    图标 代码 图标 代码     ⚗️ alembic 🔬 microscope   🔭 telescope 🛰️ satellite    医疗    图标 代码 图标 代码     💉 syringe 💊 pill    生活用品    图标 代码 图标 代码     🚪 door 🛏️ bed   🛋️ couch_and_lamp 🚽 toilet   🚿 shower 🛁 bathtub   🛒 shopping_cart      其它物品    图标 代码 图标 代码     🚬 smoking ⚰️ coffin   ⚱️ funeral_urn 🗿 moyai    符号 交通标识    图标 代码 图标 代码     🏧 atm 🚮 put_litter_in_its_place   🚰 potable_water ♿ wheelchair   🚹 mens 🚺 womens   🚻 restroom 🚼 baby_symbol   🚾 wc 🛂 passport_control   🛃 customs 🛄 baggage_claim   🛅 left_luggage      警告    图标 代码 图标 代码     ⚠️ warning 🚸 children_crossing   ⛔ no_entry 🚫 no_entry_sign   🚳 no_bicycles 🚭 no_smoking   🚯 do_not_litter 🚱 🚱   🚷 no_pedestrians 📵 no_mobile_phones   🔞 underage ☢ radioactive   ☣ biohazard      箭头    图标 代码 图标 代码     ⬆️ arrow_up ↗️ arrow_upper_right   ➡️ arrow_right ↘️ arrow_lower_right   ⬇️ arrow_down ↙️ arrow_lower_left   ⬅️ arrow_left ↖️ arrow_upper_left   ↕️ arrow_up_down ↔️ left_right_arrow   ↩️ leftwards_arrow_with_hook ↪️ arrow_right_hook   ⤴️ arrow_heading_up ⤵️ arrow_heading_down   🔃 arrows_clockwise 🔄 arrows_counterclockwise   🔙 back 🔚 end   🔛 on 🔜 soon   🔝 top      宗教    图标 代码 图标 代码     🛐 place_of_worship ⚛️ atom_symbol   🕉 om ✡️ star_of_david   ☸️ wheel_of_dharma ☯️ yin_yang   ✝️ latin_cross ☦️ orthodox_cross   ☪️ star_and_crescent ☮️ peace_symbol   🕎 menorah 🔯 six_pointed_star    生肖    图标 代码 图标 代码     ♈ aries ♉ taurus   ♊ gemini ♋ cancer   ♌ leo ♍ virgo   ♎ libra ♏ scorpius   ♐ sagittarius ♑ capricorn   ♒ aquarius ♓ pisces   ⛎ ophiuchus      影像符号    图标 代码 图标 代码     🔀 twisted_rightwards_arrows 🔁 repeat   🔂 repeat_one ▶️ arrow_forward   ⏩ fast_forward ⏭ next_track_button   ⏯ play_or_pause_button ◀️ arrow_backward   ⏪ rewind ⏮️ previous_track_button   🔼 arrow_up_small ⏫ arrow_double_up   🔽 arrow_down_small ⏬ arrow_double_down   ⏸ pause_button ⏹ stop_button   ⏺ record_button 🎦 cinema   🔅 low_brightness 🔆 high_brightness   📶 signal_strength 📳 vibration_mode   📴 mobile_phone_off      数学    图标 代码 图标 代码     ✖️ heavy_multiplication_x ➕ heavy_plus_sign   ➖ heavy_minus_sign ➗ heavy_division_sign    标点符号    图标 代码 图标 代码     ‼️ bangbang ⁉️ interrobang   ❓ question ❔ grey_question   ❕ grey_exclamation ❗ exclamation heavy_exclamation_mark   〰️ wavy_dash      货币    图标 代码 图标 代码     💱 currency_exchange 💲 heavy_dollar_sign    按键符号    图标 代码 图标 代码     #️⃣ hash *️⃣ asterisk   0️⃣ zero 1️⃣ one   2️⃣ two 3️⃣ three   4️⃣ four 5️⃣ five   6️⃣ six 7️⃣ seven   8️⃣ eight 9️⃣ nine   🔟 keycap_ten      字母符号    图标 代码 图标 代码     🔠 capital_abcd 🔡 abcd   🔢 1234 🔣 symbols   🔤 abc 🅰️ a   🆎 ab 🅱️ b   🆑 cl 🆒 cool   🆓 free ℹ️ information_source   🆔 id ⓜ️ m   🆕 new 🆖 ng   🅾️ o2 🆗 ok   🅿️ parking 🆘 sos   🆙 up 🆚 vs   🈁 koko 🈂️ sa   🈷️ u6708 🈶 u6709   🈯 u6307 🉐 ideograph_advantage   🈹 u5272 🈚 u7121   🈲 u7981 🉑 accept   🈸 u7533 🈴 u5408   🈳 u7a7a ㊗️ congratulations   ㊙️ secret 🈺 u55b6   🈵 u6e80      几何符号    图标 代码 图标 代码     🔴 red_circle 🔵 large_blue_circle   ⚫ black_circle ⚪ white_circle   ⬛ black_large_square ⬜ white_large_square   ◼️ black_medium_square ◻️ white_medium_square   ◾ black_medium_small_square ◽ white_medium_small_square   ▪️ black_small_square ▫️ white_small_square   🔶 large_orange_diamond 🔷 large_blue_diamond   🔸 small_orange_diamond 🔹 small_blue_diamond   🔺 small_red_triangle 🔻 small_red_triangle_down   💠 diamond_shape_with_a_dot_inside 🔘 radio_button   🔳 white_square_button 🔲 black_square_button    其它符合    图标 代码 图标 代码     ♻️ recycle ⚜️ fleur_de_lis   🔱 trident 📛 name_badge   🔰 beginner ⭕ o   ✅ white_check_mark ☑️ ballot_box_with_check   ✔️ heavy_check_mark ❌ x   ❎ negative_squared_cross_mark ➰ curly_loop   ➿ loop 〽️ part_alternation_mark   ✳️ eight_spoked_asterisk ✴️ eight_pointed_black_star   ❇️ sparkle ©️ copyright   ®️ registered ™️ tm    旗帜 常用旗帜    图标 代码 图标 代码     🏁 checkered_flag 🚩 triangular_flag_on_post   🎌 crossed_flags 🏴 black_flag   🏳 white_flag 🏳️‍🌈 rainbow_flag    国家和地区旗帜    图标 代码 图标 代码     🇦🇩 andorra 🇦🇪 united_arab_emirates   🇦🇫 afghanistan 🇦🇬 antigua_barbuda   🇦🇮 anguilla 🇦🇱 albania   🇦🇲 armenia 🇦🇴 angola   🇦🇶 antarctica 🇦🇷 argentina   🇦🇸 american_samoa 🇦🇹 austria   🇦🇺 australia 🇦🇼 aruba   🇦🇽 aland_islands 🇦🇿 azerbaijan   🇧🇦 bosnia_herzegovina 🇧🇧 barbados   🇧🇩 bangladesh 🇧🇪 belgium   🇧🇫 burkina_faso 🇧🇬 bulgaria   🇧🇭 bahrain 🇧🇮 burundi   🇧🇯 benin 🇧🇱 st_barthelemy   🇧🇲 bermuda 🇧🇳 brunei   🇧🇴 bolivia 🇧🇶 caribbean_netherlands   🇧🇷 brazil 🇧🇸 bahamas   🇧🇹 bhutan 🇧🇼 botswana   🇧🇾 belarus 🇧🇿 belize   🇨🇦 canada 🇨🇨 cocos_islands   🇨🇩 congo_kinshasa 🇨🇫 central_african_republic   🇨🇬 congo_brazzaville 🇨🇭 switzerland   🇨🇮 cote_divoire 🇨🇰 cook_islands   🇨🇱 chile 🇨🇲 cameroon   🇨🇳 cn 🇨🇴 colombia   🇨🇷 costa_rica 🇨🇺 cuba   🇨🇻 cape_verde 🇨🇼 curacao   🇨🇽 christmas_island 🇨🇾 cyprus   🇨🇿 czech_republic 🇩🇪 de   🇩🇯 djibouti 🇩🇰 denmark   🇩🇲 dominica 🇩🇴 dominican_republic   🇩🇿 algeria 🇪🇨 ecuador   🇪🇪 estonia 🇪🇬 egypt   🇪🇭 western_sahara 🇪🇷 eritrea   🇪🇸 es 🇪🇹 ethiopia   🇪🇺 eu european_union 🇫🇮 finland   🇫🇯 fiji 🇫🇰 falkland_islands   🇫🇲 micronesia 🇫🇴 faroe_islands   🇫🇷 fr 🇬🇦 gabon   🇬🇧 gb uk 🇬🇩 grenada   🇬🇪 georgia 🇬🇫 french_guiana   🇬🇬 guernsey 🇬🇭 ghana   🇬🇮 gibraltar 🇬🇱 greenland   🇬🇲 gambia 🇬🇳 guinea   🇬🇵 guadeloupe 🇬🇶 equatorial_guinea   🇬🇷 greece 🇬🇸 south_georgia_south_sandwich_islands   🇬🇹 guatemala 🇬🇺 guam   🇬🇼 guinea_bissau 🇬🇾 guyana   🇭🇰 hong_kong 🇭🇳 honduras   🇭🇷 croatia 🇭🇹 haiti   🇭🇺 hungary 🇮🇨 canary_islands   🇮🇩 indonesia 🇮🇪 ireland   🇮🇱 israel 🇮🇲 isle_of_man   🇮🇳 india 🇮🇴 british_indian_ocean_territory   🇮🇶 iraq 🇮🇷 iran   🇮🇸 iceland 🇮🇹 it   🇯🇪 jersey 🇯🇲 jamaica   🇯🇴 jordan 🇯🇵 jp   🇰🇪 kenya 🇰🇬 kyrgyzstan   🇰🇭 cambodia 🇰🇮 kiribati   🇰🇲 comoros 🇰🇳 st_kitts_nevis   🇰🇵 north_korea 🇰🇷 kr   🇰🇼 kuwait 🇰🇾 cayman_islands   🇰🇿 kazakhstan 🇱🇦 laos   🇱🇧 lebanon 🇱🇨 st_lucia   🇱🇮 liechtenstein 🇱🇰 sri_lanka   🇱🇷 liberia 🇱🇸 lesotho   🇱🇹 lithuania 🇱🇺 luxembourg   🇱🇻 latvia 🇱🇾 libya   🇲🇦 morocco 🇲🇨 monaco   🇲🇩 moldova 🇲🇪 montenegro   🇲🇬 madagascar 🇲🇭 marshall_islands   🇲🇰 macedonia 🇲🇱 mali   🇲🇲 myanmar 🇲🇳 mongolia   🇲🇴 macau 🇲🇵 northern_mariana_islands   🇲🇶 martinique 🇲🇷 mauritania   🇲🇸 montserrat 🇲🇹 malta   🇲🇺 mauritius 🇲🇻 maldives   🇲🇼 malawi 🇲🇽 mexico   🇲🇾 malaysia 🇲🇿 mozambique   🇳🇦 namibia 🇳🇨 new_caledonia   🇳🇪 niger 🇳🇫 norfolk_island   🇳🇬 nigeria 🇳🇮 nicaragua   🇳🇱 netherlands 🇳🇴 norway   🇳🇵 nepal 🇳🇷 nauru   🇳🇺 niue 🇳🇿 new_zealand   🇴🇲 oman 🇵🇦 panama   🇵🇪 peru 🇵🇫 french_polynesia   🇵🇬 papua_new_guinea 🇵🇭 philippines   🇵🇰 pakistan 🇵🇱 poland   🇵🇲 st_pierre_miquelon 🇵🇳 pitcairn_islands   🇵🇷 puerto_rico 🇵🇸 palestinian_territories   🇵🇹 portugal 🇵🇼 palau   🇵🇾 paraguay 🇶🇦 qatar   🇷🇪 reunion 🇷🇴 romania   🇷🇸 serbia 🇷🇺 ru   🇷🇼 rwanda 🇸🇦 saudi_arabia   🇸🇧 solomon_islands 🇸🇨 seychelles   🇸🇩 sudan 🇸🇪 sweden   🇸🇬 singapore 🇸🇭 st_helena   🇸🇮 slovenia 🇸🇰 slovakia   🇸🇱 sierra_leone 🇸🇲 san_marino   🇸🇳 senegal 🇸🇴 somalia   🇸🇷 suriname 🇸🇸 south_sudan   🇸🇹 sao_tome_principe 🇸🇻 el_salvador   🇸🇽 sint_maarten 🇸🇾 syria   🇸🇿 swaziland 🇹🇨 turks_caicos_islands   🇹🇩 chad 🇹🇫 french_southern_territories   🇹🇬 togo 🇹🇭 thailand   🇹🇯 tajikistan 🇹🇰 tokelau   🇹🇱 timor_leste 🇹🇲 turkmenistan   🇹🇳 tunisia 🇹🇴 tonga   🇹🇷 tr 🇹🇹 trinidad_tobago   🇹🇻 tuvalu 🇹🇼 taiwan   🇹🇿 tanzania 🇺🇦 ukraine   🇺🇬 uganda 🇺🇸 us   🇺🇾 uruguay 🇺🇿 uzbekistan   🇻🇦 vatican_city 🇻🇨 st_vincent_grenadines   🇻🇪 venezuela 🇻🇬 british_virgin_islands   🇻🇮 us_virgin_islands 🇻🇳 vietnam   🇻🇺 vanuatu 🇼🇫 wallis_futuna   🇼🇸 samoa 🇽🇰 kosovo   🇾🇪 yemen 🇾🇹 mayotte   🇿🇦 south_africa 🇿🇲 zambia   🇿🇼 zimbabwe     ","permalink":"http://bingerambo.com/emoji-support/","tags":["emoji"],"title":"[转载]Emoji 支持"},{"categories":["音乐"],"contents":"收集了一些经典好吹的口琴谱子，【持续更新。。。】\n布鲁斯口琴C调第1把位音阶图 送别 爱尔兰画眉 天空之城 星之所在 追梦人 平凡之路 喀秋莎 三套车 啊，朋友再见 The girl I left behind me 演奏视频地址\n","permalink":"http://bingerambo.com/2018-09-26-kouqin/","tags":["音乐","口琴"],"title":"口琴简谱集"},{"categories":["Linux"],"contents":" 配置国内阿里yum源\n yum源配置步骤 根据官网的说明，分别有 CentOS 6、CentOS 7、CentOS 8等配置操作步骤。\n1. 备份操作 备份，将 CentOS-Base.repo 为CentOS-Base.repo.backup\n1  mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup   2. 下载yum源配置文件 下载新的 http://mirrors.aliyun.com/repo/Centos-7.repo，并命名为CentOS-Base.repo\n1  wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo   或者\n1  curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo   3. 清除缓存 1 2 3 4  # 清除系统所有的yum缓存 yum clean all # 生成yum缓存  yum makecache   epel源 安装和配置 1. 查看可用的epel源 1  yum list | grep epel-release   示例：\n1 2 3  [java@localhost yum.repos.d]$ yum list | grep epel-release epel-release.noarch 7-11 extras [java@localhost yum.repos.d]$   2. 安装 epel 1 2  yum install -y epel-release   3. 配置阿里镜像提供的epel源 1  wget -O /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo   或者\n1  curl -o /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo   4. 清除缓存 1 2 3 4  # 清除系统所有的yum缓存 yum clean all # 生成yum缓存  yum makecache   5. 其它命令 1 2 3 4 5 6 7  #查看所有的yum源： yum repolist all #查看可用的yum源： yum repolist enabled   ","permalink":"http://bingerambo.com/2017-06-26-change-yum-repo/","tags":["Linux"],"title":"centos7切换国内yum源"},{"categories":["Python"],"contents":" 用 virtualenv 来管理多个开发环境，virtualenvwrapper 使得virtualenv变得更好用\n python虚拟环境搭建 1 2  # 安装虚拟环境 pip install virtualenv   安装配置  安装: (sudo) pip install virtualenv virtualenvwrapper Linux/Mac OSX 下：  修改~/.bash_profile或其它环境变量相关文件(如 .bashrc 或用 ZSH 之后的 .zshrc)，添加以下语句\n1 2 3 4 5 6  export WORKON_HOME=$HOME/.virtualenvs export PROJECT_HOME=$HOME/workspace source /usr/local/bin/virtualenvwrapper.sh #修改后使之立即生效(也可以重启终端使之生效)： source ~/.bash_profile   Windows 下：\n1  pip install virtualenvwrapper-win     1.设置环境变量\n 设置WORK_HOME环境变量：例如，WORK_HOME ： D:\\virtualenv    2.新建虚拟环境\n  1  mkvirtualenv virtualtest   注：因为前一步设置了WORK_HOME，所有虚拟环境将安装到 E:\\virtualenv\n 3.查看安装的所有虚拟环境  1  workon    使用方法： mkvirtualenv env_test：创建运行环境env_test  workon env_test: 工作在 env_test 环境 或 从其它环境切换到 env_test 环境\ndeactivate: 退出终端环境\n 其它的：  rmvirtualenv ENV：删除运行环境ENV\nmkproject mic：创建mic项目和运行环境mic\nmktmpenv：创建临时运行环境\nlsvirtualenv: 列出可用的运行环境\nlssitepackages: 列出当前环境安装了的包\n创建的环境是独立的，互不干扰\n  列出所有虚拟环境 lsvirtualenv\n  激活虚拟环境 workon venv   进入虚拟环境目录 cdvirtualenv\n  进入虚拟环境的site-packages目录 cdsitepackages\n  列出site-packages目录的所有软件包 lssitepackages\n  停止虚拟环境 deactivate\n  删除虚拟环境 rmvitualenv venv\n  重建Python环境  冻结环境  所谓 冻结(freeze) 环境，就是将当前环境的软件包等固定下来:\n1 2  # 安装包列表保存到文件packages.txt中 pip freeze \u0026gt;d:\\packages.txt　   重建环境  重建(rebuild) 环境就是在部署的时候，在生产环境安装好对应版本的软件包，不要出现版本兼容等问题:\n1  pip install -r d:\\packages.txt # 配合pip，可以批量安装对应版本的软件包，快速重建环境，完成部署。   ","permalink":"http://bingerambo.com/2017-04-28-virtualenvl-py/","tags":["Python"],"title":"Python虚拟环境搭建"},{"categories":["Python"],"contents":"PIP安装：更换安装源，使用国内镜像。   对于Python开发用户来讲，经常使用PIP安装软件包。但是由于PIP默认安装源是在国外，经常出现下载后安装出错问题。所以把PIP安装源替换成国内镜像，可以大幅提升下载速度，还可以提高安装成功率。\n国内源： 新版ubuntu要求使用https源，要注意。\n清华：https://pypi.tuna.tsinghua.edu.cn/simple\n阿里云：http://mirrors.aliyun.com/pypi/simple/\n中国科技大学 https://pypi.mirrors.ustc.edu.cn/simple/\n华中理工大学：http://pypi.hustunique.com/\n山东理工大学：http://pypi.sdutlinux.org/\u0026nbsp;\n豆瓣：http://pypi.douban.com/simple/\n临时使用： 可以在使用pip的时候加参数-i http://pypi.douban.com/simple/ 例如：pip install -i http://pypi.douban.com/simple/ django，这样就会从豆瓣这边的镜像去安装django库。 \u0026nbsp;\n永久修改，一劳永逸： Linux下，修改 ~/.pip/pip.conf (没有就创建一个文件夹及文件。文件夹要加“.”，表示是隐藏文件夹)\n内容如下：\n[global] index-url = https://pypi.douban.com/simple/\n [install] trusted-host=mirrors.aliyun.com  windows下，直接在user目录中创建一个pip目录，如：C:\\Users\\xx\\pip，新建文件pip.ini。内容同上。\n  ","permalink":"http://bingerambo.com/2017-04-26-pip-install-py/","tags":["Python"],"title":"PIP安装：更换安装源，使用国内镜像"},{"categories":["Python"],"contents":" 项目中有时会写些py脚本文件，为当作项目工具，方便无Python环境下使用，所以需要打包成exe文件。\n Python打包exe  Q：py生成exe，总共需几步？ A：总共分三步！  1. 安装PyInstaller 1  pip install PyInstaller    注意：安装包名区分大小写  2. 打包脚本:TargetPy2exe.py.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  #!/usr/bin/env python3 # -*- coding: utf-8 -*- \u0026#34;\u0026#34;\u0026#34; @version: ?? @author: Binge @file: TargetPy2exe.py.py @time: 2017-02-07 11:21 @description: convert py to exe by pyinstaller \u0026#34;\u0026#34;\u0026#34; from PyInstaller.__main__ import run if __name__ == \u0026#39;__main__\u0026#39;: # 设置打包exe参数：目标py、打包参数 # -F 打包成一个exe文件 # -w 使用窗口，无控制台 # -c 使用控制台，无窗口 # --icon = 图标路径 # --upx-dir 使用upx压缩 # upx391w ups程序目录文件路径 # opts = [\u0026#39;tvn_process.py\u0026#39;, \u0026#39;-F\u0026#39;] opts = [\u0026#39;tvn_process.py\u0026#39;, \u0026#39;-F\u0026#39;, \u0026#39;-w\u0026#39;] # opts = [\u0026#39;tvn_process.py\u0026#39;, \u0026#39;-F\u0026#39;, \u0026#39;-c\u0026#39;] # opts = [\u0026#39;tvn_process.py\u0026#39;, \u0026#39;-F\u0026#39;, \u0026#39;-w\u0026#39;, \u0026#39;--upx-dir\u0026#39;, \u0026#39;upx391w\u0026#39;] # opts = [\u0026#39;tvn_process.py\u0026#39;, \u0026#39;-F\u0026#39;, \u0026#39;-w\u0026#39;,\u0026#39;--icon=tvn_process.ico\u0026#39;,\u0026#39;--upx-dir\u0026#39;,\u0026#39;upx391w\u0026#39;] run(opts)   3. 运行打包脚本，即可生成exe文件","permalink":"http://bingerambo.com/2017-03-12-package-py-2-exe/","tags":["Python"],"title":"Python如何打包exe"},{"categories":["生活"],"contents":" “夕阳最美时，也总是将近黄昏。 世上有很多事都是这样子的，尤其是一些特别辉煌美好的事。 所以你不必伤感，也不用惋惜，纵然到江湖去赶上了春，也不必留住它。 因为这就是人生，有些事你留也留不住。 你一定要先学会忍受它的无情，才会懂得享受它的温柔。 ” ——古龙\n 前言 年关将至，总会回想起这一年，完成了哪些事情，未完成哪些事情，收获了什么。。。 想来想去，都是些小事情。这点小事，虽不值得大书特写轰轰烈烈纪念，但还是添两笔，记录一下。 \n 小结 一、学习  技术变得快，还要赶紧追。 用小站来整理学习笔记，效果不错。 阿尔法狗来了。。。  二、爱好  锻炼：2016没有练，腹肌木有了，胸肌木有了，嘛都木有了。 单车：这一年，断断续续骑了段时间，没有拉100公里以上的长途，速度也没飚过40公里时速。属于慢速短途悠闲骑。 其它没有玩耍的就不再啰嗦。  三、小站  小站开张半年，只攒了（复制）5篇文章，看来忙（懒）得不轻。 借索大侠的话说：“程序猿应该有自己的空间吧，虽然这个东西并不算什么”。有了小站，也方便做资料整理和学习记录。  四、其它 什么都木有干！！！\n五、计划  设定小目标，希望能够完成它。 加强锻炼，召回腹肌。 小站常更新。  后记 还有一事：前段时间坐三角翼小飞机，体验了爬升、俯冲、失重下降、大转弯、低空过场等动作。所以，以后如果有人问：你咋不上天呢？我就可以答：我真上过天，还吼过。。。 希望新一年，自己能够像小飞机那样飞得潇洒！\n 最后，祝各位看官：鸡年大吉，万事如意~~~ 友情推荐   Tuantuan.G：是设计师，也是小伙伴。有想法，有理念。爱画画，有创意。从视觉设计，到UI平面。哪怕通宵达旦，也要设计漂亮。。。去她那里逛逛吧：@Tuantuan.G\n  索洪波：是程序员，也是段子手，低调深刻有内涵。去他的小站看看吧：@索洪波\n ","permalink":"http://bingerambo.com/2017-01-24-year-report/","tags":["生活"],"title":"2016，6了什么"},{"categories":["JS"],"contents":" 从网上整理的JavaScript的正则表达式，实际项目使用时，还需再做测验 ——Binge\n 技巧  整数或者小数：^[0-9]+.{0,1}[0-9]{0,2}$\n只能输入数字：\u0026quot;^[0-9]*$\u0026quot;。\n只能输入n位的数字：\u0026quot;^\\d{n}$\u0026quot;。\n只能输入至少n位的数字：\u0026quot;^\\d{n,}$\u0026quot;。\n只能输入m~n位的数字：。\u0026quot;^\\d{m,n}$\u0026quot;\n只能输入零和非零开头的数字：\u0026quot;^(0|[1-9][0-9]*)$\u0026quot;。\n只能输入有两位小数的正实数：\u0026quot;^[0-9]+(.[0-9]{2})?$\u0026quot;。\n只能输入有1~3位小数的正实数：\u0026quot;^[0-9]+(.[0-9]{1,3})?$\u0026quot;。\n只能输入非零的正整数：\u0026quot;^+?[1-9][0-9]*$\u0026quot;。\n只能输入非零的负整数：\u0026quot;^-[1-9][0-9*$\u0026quot;。\n只能输入长度为3的字符：\u0026quot;^.{3}$\u0026quot;。\n只能输入由26个英文字母组成的字符串：\u0026quot;^[A-Za-z]+$\u0026quot;。\n只能输入由26个大写英文字母组成的字符串：\u0026quot;^[A-Z]+$\u0026quot;。\n只能输入由26个小写英文字母组成的字符串：\u0026quot;^[a-z]+$\u0026quot;。\n只能输入由数字和26个英文字母组成的字符串：\u0026quot;^[A-Za-z0-9]+$\u0026quot;。\n只能输入由数字、26个英文字母或者下划线组成的字符串：\u0026quot;^\\w+$\u0026quot;。\n验证用户密码：\u0026quot;^[a-zA-Z]\\w{5,17}$\u0026ldquo;正确格式为：以字母开头，长度在6~18之间，只能包含字符、数字和下划线。\n验证是否含有^%\u0026amp;',;=?$\u0026quot;等字符：\u0026quot;[^%\u0026amp;',;=?$\\x22]+\u0026quot;。\n只能输入汉字：\u0026quot;^[\\u4e00-\\u9fa5]{0,}$\u0026rdquo;\n验证Email地址：\u0026quot;^\\w+([-+.]\\w+)@\\w+([-.]\\w+).\\w+([-.]\\w+)*$\u0026quot;。\n验证InternetURL：\u0026quot;^http://([\\w-]+.)+[\\w-]+(/[\\w-./?%\u0026amp;=]*)?$\u0026quot;。\n验证电话号码：\u0026quot;^((\\d{3,4}-)|\\d{3.4}-)?\\d{7,8}$\u0026ldquo;正确格式为：\u0026ldquo;XXX-XXXXXXX\u0026rdquo;、\u0026ldquo;XXXX-XXXXXXXX\u0026rdquo;、\u0026ldquo;XXX-XXXXXXX\u0026rdquo;、\u0026ldquo;XXX-XXXXXXXX\u0026rdquo;、\u0026ldquo;XXXXXXX\u0026quot;和\u0026quot;XXXXXXXX\u0026rdquo;。\n验证身份证号（15位或18位数字）：\u0026quot;^\\d{15}|\\d{18}$\u0026quot;。\n验证一年的12个月：\u0026quot;^(0?[1-9]|1[0-2])$\u0026ldquo;正确格式为：\u0026ldquo;01\u0026quot;～\u0026quot;09\u0026quot;和\u0026quot;1\u0026quot;～\u0026quot;12\u0026rdquo;。\n验证一个月的31天：\u0026quot;^((0?[1-9])|((1|2)[0-9])|30|31)$\u0026ldquo;正确格式为；\u0026ldquo;01\u0026quot;～\u0026quot;09\u0026quot;和\u0026quot;1\u0026quot;～\u0026quot;31\u0026rdquo;。\n匹配中文字符的正则表达式： [\\u4e00-\\u9fa5]\n匹配双字节字符(包括汉字在内)：[^\\x00-\\xff]\n   应用：计算字符串的长度（一个双字节字符长度计2，ASCII字符计1）\n1 2  String.prototype.len=function(){return this.replace(/[^\\x00-\\xff]/g,\u0026#34;aa\u0026#34;).length;}   技巧  匹配空行的正则表达式：\\n[\\s| ]*\\r\n匹配html标签的正则表达式：\u0026lt;(.)\u0026gt;(.)\u0026lt;/(.)\u0026gt;|\u0026lt;(.)/\u0026gt;\n匹配首尾空格的正则表达式：(^\\s*)|(\\s*$)\n   应用：javascript中没有像vbscript那样的trim函数，我们就可以利用这个表达式来实现，如下：\n1 2 3 4  String.prototype.trim = function() { return this.replace(/(^\\s*)|(\\s*$)/g, \u0026#34;\u0026#34;); }   利用正则表达式分解和转换IP地址：\n下面是利用正则表达式匹配IP地址，并将IP地址转换成对应数值的Javascript程序：\n1 2 3 4 5 6 7 8 9 10 11 12  function IP2V(ip) { re=/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)/g //匹配IP地址的正则表达式 if(re.test(ip)) { return RegExp.$1*Math.pow(255,3))+RegExp.$2*Math.pow(255,2))+RegExp.$3*255+RegExp.$4*1 } else { throw new Error(\u0026#34;Not a valid IP address!\u0026#34;) } }   不过上面的程序如果不用正则表达式，而直接用split函数来分解可能更简单，程序如下：\n1 2 3  var ip=\u0026#34;10.100.20.168\u0026#34; ip=ip.split(\u0026#34;.\u0026#34;) alert(\u0026#34;IP值是：\u0026#34;+(ip[0]*255*255*255+ip[1]*255*255+ip[2]*255+ip[3]*1))   匹配Email地址的正则表达式：\\w+([-+.]\\w+)@\\w+([-.]\\w+).\\w+([-.]\\w+)*\n匹配网址URL的正则表达式：http://([\\w-]+.)+[\\w-]+(/[\\w- ./?%\u0026amp;=]*)?\n利用正则表达式限制网页表单里的文本框输入内容：\n用正则表达式限制只能输入中文：\n1 2  var onkeyup=\u0026#34;value=value.replace(/[^\\u4E00-\\u9FA5]/g,\u0026#39;\u0026#39;)\u0026#34; var onbeforepaste=\u0026#34;clipboardData.setData(\u0026#39;text\u0026#39;,clipboardData.getData(\u0026#39;text\u0026#39;).replace(/[^\\u4E00-\\u9FA5]/g,\u0026#39;\u0026#39;))\u0026#34;   用正则表达式限制只能输入全角字符：\n1 2  var onkeyup=\u0026#34;value=value.replace(/[^\\uFF00-\\uFFFF]/g,\u0026#39;\u0026#39;)\u0026#34; var onbeforepaste=\u0026#34;clipboardData.setData(\u0026#39;text\u0026#39;,clipboardData.getData(\u0026#39;text\u0026#39;).replace(/[^\\uFF00-\\uFFFF]/g,\u0026#39;\u0026#39;))\u0026#34;   用正则表达式限制只能输入数字：\n1 2  var onkeyup=\u0026#34;value=value.replace(/[^\\d]/g,\u0026#39;\u0026#39;) \u0026#34; var onbeforepaste=\u0026#34;clipboardData.setData(\u0026#39;text\u0026#39;,clipboardData.getData(\u0026#39;text\u0026#39;).replace(/[^\\d]/g,\u0026#39;\u0026#39;))\u0026#34;   用正则表达式限制只能输入数字和英文：\n1 2  var onkeyup=\u0026#34;value=value.replace(/[\\W]/g,\u0026#39;\u0026#39;) \u0026#34; var onbeforepaste=\u0026#34;clipboardData.setData(\u0026#39;text\u0026#39;,clipboardData.getData(\u0026#39;text\u0026#39;).replace(/[^\\d]/g,\u0026#39;\u0026#39;))\u0026#34;   技巧  匹配中文字符的正则表达式： [\\u4e00-\\u9fa5]\n评注：匹配中文还真是个头疼的事，有了这个表达式就好办了\n匹配双字节字符(包括汉字在内)：[^\\x00-\\xff]\n评注：可以用来计算字符串的长度（一个双字节字符长度计2，ASCII字符计1）\n匹配空白行的正则表达式：\\n\\s*\\r\n评注：可以用来删除空白行\n匹配HTML标记的正则表达式：\u0026lt;(\\S*?)[^\u0026gt;]*\u0026gt;.*?|\u0026lt;.*? /\u0026gt;\n评注：网上流传的版本太糟糕，上面这个也仅仅能匹配部分，对于复杂的嵌套标记依旧无能为力\n匹配首尾空白字符的正则表达式：^\\s*|\\s*$\n评注：可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式\n匹配Email地址的正则表达式：\\w+([-+.]\\w+)@\\w+([-.]\\w+).\\w+([-.]\\w+)*\n评注：表单验证时很实用\n匹配网址URL的正则表达式：[a-zA-z]+://[^\\s]*\n评注：网上流传的版本功能很有限，上面这个基本可以满足需求\n匹配帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：^[a-zA-Z][a-zA-Z0-9_]{4,15}$\n评注：表单验证时很实用\n匹配国内电话号码：\\d{3}-\\d{8}|\\d{4}-\\d{7}\n评注：匹配形式如 0511-4405222 或 021-87888822\n匹配腾讯QQ号：[1-9][0-9]{4,}\n评注：腾讯QQ号从10000开始\n匹配中国邮政编码：[1-9]\\d{5}(?!\\d)\n评注：中国邮政编码为6位数字\n匹配身份证：\\d{15}|\\d{18}\n评注：中国的身份证为15位或18位\n匹配ip地址：\\d+.\\d+.\\d+.\\d+\n评注：提取ip地址时有用\n匹配特定数字：\n^[1-9]\\d*$　//匹配正整数\n^-[1-9]\\d*$ //匹配负整数\n^-?[1-9]\\d*$　//匹配整数\n^[1-9]\\d*|0$　//匹配非负整数（正整数 + 0）\n^-[1-9]\\d*|0$　//匹配非正整数（负整数 + 0）\n^[1-9]\\d*.\\d*|0.\\d*[1-9]\\d*$　//匹配正浮点数\n^-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*)$　//匹配负浮点数\n^-?([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0)$　//匹配浮点数\n^[1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0$　//匹配非负浮点数（正浮点数 + 0）\n^(-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*))|0?.0+|0$　//匹配非正浮点数（负浮点数 + 0）\n评注：处理大量数据时有用，具体应用时注意修正\n匹配特定字符串：\n^[A-Za-z]+$　//匹配由26个英文字母组成的字符串\n^[A-Z]+$　//匹配由26个英文字母的大写组成的字符串\n^[a-z]+$　//匹配由26个英文字母的小写组成的字符串\n^[A-Za-z0-9]+$　//匹配由数字和26个英文字母组成的字符串\n^\\w+$　//匹配由数字、26个英文字母或者下划线组成的字符串\n评注：最基本也是最常用的一些表达式\n整理出来的一些常用的正则表达式所属分类: JScript (三)\nEmail : /^\\w+([-+.]\\w+)@\\w+([-.]\\w+).\\w+([-.]\\w+)*$/\nisEmail1 : /^\\w+([.-]\\w+)@\\w+([.-]\\w+).\\w+$/;\nisEmail2 : /^.@[^_]$/;\nPhone : /^(((\\d{3}))|(\\d{3}-))?((0\\d{2,3})|0\\d{2,3}-)?[1-9]\\d{6,7}$/\nMobile : /^(((\\d{3}))|(\\d{3}-))?13\\d{9}$/\nUrl : /^http://[A-Za-z0-9]+.[A-Za-z0-9]+[/=?%-\u0026amp;_~`@[]':+!]([^\u0026lt;\u0026gt;\u0026quot;\u0026quot;])$/\nIdCard : /^\\d{15}(\\d{2}[A-Za-z0-9])?$/\nCurrency : /^\\d+(.\\d+)?$/\nNumber : /^\\d+$/\nCode : /^[1-9]\\d{5}$/\nQQ : /^[1-9]\\d{4,8}$/\nInteger : /^[-+]?\\d+$/\nDouble : /^[-+]?\\d+(.\\d+)?$/\nEnglish : /^[A-Za-z]+$/\nChinese : /^[\\u0391-\\uFFE5]+$/\nUnSafe : /^(([A-Z]|[a-z]|\\d*|[-_~!@#$%^\u0026amp;*.()[]{}\u0026lt;\u0026gt;?\\/'\u0026quot;]*)|.{0,5})$|\\s/\nPassWord :^[\\w]{6,12}$\nZipCode : ^[\\d]{6}\n/^(+\\d+ )?((\\d+) )?[\\d ]+$/; //这个是国际通用的电话号码判断\n/^(1[0-2]\\d|\\d{1,2})$/; //这个是年龄的判断\n/^\\d+.\\d{2}$/; //这个是判断输入的是否为货币值\n   1 2 3 4 5 6 7 8 9 10 11  \u0026lt;!-- IP地址有效性验证函数--\u0026gt; \u0026lt;script language=javascript runat=server\u0026gt; ip_ip = \u0026#39;(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|\\\\d\\\\d|\\\\d)\u0026#39;; ip_ipdot = ip + \u0026#39;\\\\.\u0026#39;; isIPaddress = new RegExp(\u0026#39;^\u0026#39;+ip_ipdot+ip_ipdot+ipdot+ip_ip+\u0026#39;$\u0026#39;); \u0026lt;/script\u0026gt;   应用：计算字符串的长度（一个双字节字符长度计2，ASCII字符计1）\n1  String.prototype.len=function(){return this.replace([^\\x00-\\xff]/g,\u0026#34;aa\u0026#34;).length;}   应用：javascript中没有像vbscript那样的trim函数，我们就可以利用这个表达式来实现，如下：\n1 2 3 4 5 6 7  String.prototype.trim = function() { return this.replace(/(^\\s*)|(\\s*$)/g, \u0026#34;\u0026#34;); }   技巧  匹配空行的正则表达式：\\n[\\s| ]*\\r\n匹配HTML标记的正则表达式：/\u0026lt;(.)\u0026gt;.\u0026lt;/\\1\u0026gt;|\u0026lt;(.*) /\u0026gt;/\n匹配首尾空格的正则表达式：(^\\s*)|(\\s*$)\n匹配Email地址的正则表达式：\\w+([-+.]\\w+)@\\w+([-.]\\w+).\\w+([-.]\\w+)*\n匹配网址URL的正则表达式：http://([\\w-]+.)+[\\w-]+(/[\\w- ./?%\u0026amp;=]*)?\n^\\d+$　//匹配非负整数（正整数 + 0）\n^[0-9][1-9][0-9]$　//匹配正整数\n^((-\\d+)|(0+))$　//匹配非正整数（负整数 + 0）\n^-[0-9][1-9][0-9]$　//匹配负整数\n^-?\\d+$　//匹配整数\n^\\d+(.\\d+)?$　//匹配非负浮点数（正浮点数 + 0）\n^(([0-9]+.[0-9][1-9][0-9])|([0-9][1-9][0-9].[0-9]+)|([0-9][1-9][0-9]))$　//匹配正浮点数\n^((-\\d+(.\\d+)?)|(0+(.0+)?))$　//匹配非正浮点数（负浮点数 + 0）\n^(-(([0-9]+.[0-9][1-9][0-9])|([0-9][1-9][0-9].[0-9]+)|([0-9][1-9][0-9])))$ //匹配负浮点数\n^(-?\\d+)(.\\d+)?$\n  ","permalink":"http://bingerambo.com/2016-09-06-javascript-regexpression/","tags":["JS"],"title":"JS正则表达式大全"},{"categories":["JS"],"contents":" JQuery源码-Deferred 寥寥代码，犀利锋锐，设计思想，值得学习 ——Binge\n  Deferred的概念请看第一篇 http://www.cnblogs.com/aaronjs/p/3348569.html \u0026nbsp;\n****************** 构建Deferred对象时候的流程图**************************   \u0026nbsp;\n**********************源码解析********************** \u0026nbsp;\n因为callback被剥离出去后，整个deferred就显得非常的精简\n   jQuery.extend({ Deferred : \u0026lt;/span\u0026gt;\u0026lt;span style=\u0026quot;color:rgb(0,0,255); line-height:1.5!important\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;\u0026lt;span style=\u0026quot;line-height:1.5!important\u0026quot;\u0026gt;(){} when : \u0026lt;/span\u0026gt;\u0026lt;span style=\u0026quot;color:rgb(0,0,255); line-height:1.5!important\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;\u0026lt;span style=\u0026quot;line-height:1.5!important\u0026quot;\u0026gt;()  )}     对于extend的继承这个东东，在之前就提及过jquery如何处理内部jquery与init相互引用this的问题\n对于JQ的整体架构一定要弄懂 http://www.cnblogs.com/aaronjs/p/3278578.html 所以当jQuery.extend只有一个参数的时候，其实就是对jQuery静态方法的一个扩展\n我们在具体看看2个静态方法内部都干了些什么：\nDeferred整体结构：\n源码精简了部分代码\n   Deferred: function( func ) {var tuples =[//action, add listener, listener list, final state [ \u0026ldquo;resolve\u0026rdquo;, \u0026ldquo;done\u0026rdquo;, jQuery.Callbacks(\u0026ldquo;once memory\u0026rdquo;), \u0026ldquo;resolved\u0026rdquo;], [ \u0026ldquo;reject\u0026rdquo;, \u0026ldquo;fail\u0026rdquo;, jQuery.Callbacks(\u0026ldquo;once memory\u0026rdquo;), \u0026ldquo;rejected\u0026rdquo;], [ \u0026ldquo;notify\u0026rdquo;, \u0026ldquo;progress\u0026rdquo;, jQuery.Callbacks(\u0026ldquo;memory\u0026rdquo;) ] ], state = \u0026ldquo;pending\u0026rdquo;, promise ={ state: function() {}, always: function() {}, then: function( /fnDone, fnFail, fnProgress /) { },//Get a promise for this deferred //If obj is provided, the promise aspect is added to the object promise: function( obj ) {} }, deferred ={}; jQuery.each( tuples, function( i, tuple ) { deferred[ tuple[0] + \u0026ldquo;With\u0026rdquo; ] =list.fireWith; }); promise.promise( deferred ); //All done! returndeferred; },      显而易见Deferred是个工厂类，返回的是内部构建的deferred对象    tuples 创建三个$.Callbacks对象，分别表示成功，失败，处理中三种状态  创建了一个promise对象，具有state、always、then、primise方法  扩展primise对象生成最终的Deferred对象，返回该对象   这里其实就是3个处理,但是有个优化代码的地方,就是把共性的代码给抽象出来,通过动态生成了\n具体源码分析:  Deferred自身则围绕这三个对象进行更高层次的抽象  触发回调函数列表执行(函数名) 添加回调函数（函数名） 回调函数列表（jQuery.Callbacks对象） deferred最终状态（第三组数据除外）     var tuples =[//action, add listener, listener list, final state [ \u0026ldquo;resolve\u0026rdquo;, \u0026ldquo;done\u0026rdquo;, jQuery.Callbacks(\u0026ldquo;once memory\u0026rdquo;), \u0026ldquo;resolved\u0026rdquo;], [ \u0026ldquo;reject\u0026rdquo;, \u0026ldquo;fail\u0026rdquo;, jQuery.Callbacks(\u0026ldquo;once memory\u0026rdquo;), \u0026ldquo;rejected\u0026rdquo;], [ \u0026ldquo;notify\u0026rdquo;, \u0026ldquo;progress\u0026rdquo;, jQuery.Callbacks(\u0026ldquo;memory\u0026rdquo;) ] ],     这里抽象出2组阵营： 1组：回调方法/事件订阅  done，fail，progress  2组：通知方法/事件发布  resolve，reject，notify，resolveWith，rejectWith，notifyWith  tuples 元素集 其实是把相同有共同特性的代码的给合并成一种结构，然后通过一次处理\n   jQuery.each( tuples, function( i, tuple ) {var list = tuple[ 2], stateString = tuple[ 3]; promise[ tuple[1] ] =list.add;if( stateString ) { list.add(function() { state =stateString;//[ reject_list | resolve_list ].disable; progress_list.lock }, tuples[ i ^ 1 ][ 2 ].disable, tuples[ 2 ][ 2].lock ); } deferred[ tuple[0] ] = function() { deferred[ tuple[0] + \u0026ldquo;With\u0026rdquo; ]( this === deferred ? promise : this, arguments );return this; }; deferred[ tuple[0] + \u0026ldquo;With\u0026rdquo; ] =list.fireWith; });     对于tuples的3条数据集是分2部分处理的\n第一部分将回调函数存入  promise[ tuple[1] ] = list.add;  其实就是给promise赋予3个回调函数\npromise.done = $.Callbacks(\u0026ldquo;once memory\u0026rdquo;).add  promise.fail = $.Callbacks(\u0026ldquo;once memory\u0026rdquo;).add  promise.progressl = $.Callbacks(\u0026ldquo;memory\u0026rdquo;).add  如果存在deferred最终状态\n默认会预先向doneList,failList中的list添加三个回调函数\n   if( stateString ) { list.add(function() {//state = [ resolved | rejected ] state =stateString;//[ reject_list | resolve_list ].disable; progress_list.lock }, tuples[ i ^ 1 ][ 2 ].disable, tuples[ 2 ][ 2].lock ); }     ************************************************************* 这里有个小技巧\ni ^ 1 按位异或运算符 所以实际上第二个传参数是1、0索引对调了，所以取值是failList.disable与doneList.disable\n*************************************************************  通过stateString有值这个条件，预先向doneList,failList中的list添加三个回调函数  分别是:\ndoneList : [changeState, failList.disable, processList.lock] failList : [changeState, doneList.disable, processList.lock]   changeState 改变状态的匿名函数，deferred的状态，分为三种：pending(初始状态), resolved(解决状态), rejected(拒绝状态)  不论deferred对象最终是resolve（还是reject），在首先改变对象状态之后，都会disable另一个函数列表failList(或者doneList)  然后lock processList保持其状态，最后执行剩下的之前done（或者fail）进来的回调函数  所以第一步最终都是围绕这add方法 done/fail/是list.add也就是 callbacks.add ，将回调函数存入回调对象中   第二部分很简单，给deferred对象扩充6个方法 resolve/reject/notify 是 callbacks.fireWith ，执行回调函数  resolveWith/rejectWith/notifyWith 是 callbacks.fireWith 队列方法引用   最后合并promise到deferred\npromise.promise( deferred ); jQuery.extend( obj, promise )  所以最终通过工厂方法Deferred构建的异步对象带的所有的方法了\nreturn 内部的deferred对象了\n 由此可见我们在\nvar defer = $.Deferred(); //构建异步对象  的时候,内部的对象就有了4个属性方法了\ndeferred: Object always: function () { done: function () { fail: function () { notify: function () { notifyWith: function ( context, args ) { pipe: function ( /* fnDone, fnFail, fnProgress */ ) { progress: function () { promise: function ( obj ) { reject: function () { rejectWith: function ( context, args ) { resolve: function () { resolveWith: function ( context, args ) { state: function () { then: function ( /* fnDone, fnFail, fnProgress */ ) {   promise: Object always: function () { done: function () { fail: function () { pipe: function ( /* fnDone, fnFail, fnProgress */ ) { progress: function () { promise: function ( obj ) { state: function () { then: function ( /* fnDone, fnFail, fnProgress */ ) {   state: \u0026ldquo;pending\u0026rdquo; tuples: Array[3]  构造图\n以上只是在初始化构建的时候，我们往下看看动态执行时候的处理\n *****************执行期***********************  一个最简单的demo为例子\n   var d =$.Deferred();\nsetTimeout(function(){ d.resolve(22) },0);\nd.then(function(val){ console.log(val); })     当延迟对象被 resolved 时，任何通过 deferred.then或deferred.done 添加的 doneCallbacks，都会被调用。回调函数的执行顺序和它们被添加的顺序是一样的。传递给 deferred.resolve() 的 args 参数，会传给每个回调函数。当延迟对象进入 resolved 状态后，再添加的任何 doneCallbacks，当它们被添加时，就会被立刻执行，并带上传入给 .resolve()的参数   换句话说，我们调用d.resolve(22) 就等于是调用\n匿名函数并传入参数值 22\nfunction(val){ console.log(val); //22 }  当前实际的使用中会有各种复杂的组合情况，但是整的外部调用流程就是这样的\n***************** resolve的实现 *******************  我们回顾下，其实Deferred对象，内部的实现还是Callbacks对象，只是在外面再封装了一层API，供接口调用 d.resolve(22)  实际上调用的就是通过这个代码生成的\ndeferred[ tuple[0] ] = function() { deferred[ tuple[0] + \u0026ldquo;With\u0026rdquo; ]( this === deferred ? promise : this, arguments );return this; }; deferred[ tuple[0] + \u0026ldquo;With\u0026rdquo; ] = list.fireWith;  deferred.resolveWith()  最终执行的就是 list.fireWith callbacks.fireWith()  所以最终又回到回调对象 callbacks中的私有方法 fire()了 Callbacks会通过\n callbacks.add()  把回调函数给注册到内部的 list = [] 上,我们回来过看看  deferred.then()  d.then(function(val){ console.log(val); })  ***************** then的实现 *******************     then: function( /*fnDone, fnFail, fnProgress */) {var fns =arguments;return jQuery.Deferred(function( newDefer ) { jQuery.each( tuples, function( i, tuple ) {var action = tuple[ 0], fn = jQuery.isFunction( fns[ i ] ) \u0026amp;\u0026amp;fns[ i ];//deferred[ done | fail | progress ] for forwarding actions to newDefer deferred[ tuple[1] ](function() {//省略\u0026hellip;\u0026hellip;\u0026hellip;\u0026hellip; }); }); fns = null; }).promise(); },     递归jQuery.Deferred 传递了func 链式调用了promise()  因为在异步对象的方法都是嵌套找作用域属性方法的 这里我额外的提及一下作用域 var d = $.Deferred();  这个异步对象d是作用域是如何呢？\n第一层：无可争议，浏览器环境下最外层是 window\n第二层：jquery本身是一个闭包\n第三层: Deferred工厂方法产生的作用域\n如果用d.then()方法呢？\n很明显then方法又是嵌套在内部的函数，所以执行的时候都默认会包含以上三层作用域+自己本身函数产生的作用域了\n我们用个简单图描绘下\n  根据规则，在最内部的函数能够访问上层作用域的所有的变量  我们先从使用的层面去考虑下结构设计: demo 1    var defer =$.Deferred();var filtered = defer.then(function( value ) {return value * 2; });\ndefer.resolve( 5);\nfiltered.done(function( value ) { console.log(value) //10 });     demo 2    var defer =$.Deferred();\ndefer.then(function(value) {return value * 2; }).then(function(value) {return value * 2; }).done(function(value) { alert(value) //20 });\ndefer.resolve( 5 );     其实这里就是涉及到defer.then().then().done() 链式调用了 API是这么定义的: deferred.then( doneFilter [, failFilter ] [, progressFilter ] )  从jQuery 1.8开始, 方法返回一个新的promise（承诺），通过一个函数，可以过滤deferred（延迟）的状态和值。替换现在过时的deferred.pipe()方法。 doneFilter 和 failFilter函数过滤原deferred（延迟）的解决/拒绝的状态和值。 progressFilter 函数过滤器的任何调用到原有的deferred（延迟）的notify 和 notifyWith的方法。 这些过滤器函数可以返回一个新的值传递给的 promise（承诺）的.done() 或 .fail() 回调，或他们可以返回另一个观察的对象（递延，承诺等）传递给它的解决/拒绝的状态和值promise（承诺）的回调。 如果过滤函数是空，或没有指定，promise（承诺）将得到与原来值相同解决（resolved）或拒绝（rejected）。   我们抓住几点：\n返回的是新的promise对象 内部有一个滤器函数  从demo 1中我们就能看到\n经过x.then()方法处理的代码中返回的this（filtered ）,不是原来的$.Deferred()所有产生的那个异步对象(defer )了 所以，每经过一个then那么内部处理的this都要被重新设置，那么为什么要这样处理呢？ 源码\n   then: function( /fnDone, fnFail, fnProgress /) {var fns =arguments;//分别为deferred的三个callbacklist添加回调函数，根据fn的是否是函数，分为两种情况 return jQuery.Deferred(function( newDefer ) { jQuery.each( tuples, function( i, tuple ) {var action = tuple[ 0], fn = jQuery.isFunction( fns[ i ] ) \u0026amp;\u0026amp;fns[ i ];//deferred[ done | fail | progress ] for forwarding actions to newDefer deferred[ tuple[1] ](function() {var returned = fn \u0026amp;\u0026amp; fn.apply( this, arguments );if ( returned \u0026amp;\u0026amp;jQuery.isFunction( returned.promise ) ) { returned.promise() .done( newDefer.resolve ) .fail( newDefer.reject ) .progress( newDefer.notify ); } else{ newDefer[ action + \u0026ldquo;With\u0026rdquo; ]( this === promise ? newDefer.promise() : this, fn ?[ returned ] : arguments ); } }); }); fns = null; }).promise(); },     在Deferred传递实参的时候，支持一个flag，jQuery.Deferred(func)\n传递一个回调函数\n//Call given func if any if( func ) { func.call( deferred, deferred ); }  所以newDefer可以看作是\nnewDefer = $.Deferred();  那么func回调的处理的就是过滤函数了\n   deferred[ tuple[1] ](function() {var returned = fn \u0026amp;\u0026amp; fn.apply( this, arguments );if ( returned \u0026amp;\u0026amp;jQuery.isFunction( returned.promise ) ) { returned.promise() .done( newDefer.resolve ) .fail( newDefer.reject ) .progress( newDefer.notify ); } else{ newDefer[ action + \u0026ldquo;With\u0026rdquo; ]( this === promise ? newDefer.promise() : this, fn ?[ returned ] : arguments ); } });     这里其实也有编译函数的概念，讲未来要执行的代码，预先通过闭包函数也保存起来，使其访问各自的作用域\n第一步\n分解tuples元素集\njQuery.each( tuples, function( i, tuple ) {//过滤函数第一步处理 }）  第二步\n分别为deferred[ done | fail | progress ]执行对应的add方法，增加过滤函数给done | fail | progress 方法 deferred[ tuple[1] ]（ 传入过滤函数 ）//过滤函数 执行的时候在分解  代码即\ndeferred[done] = list.add = callback.add  第三步\n返回return jQuery.Deferred().promise()\n此时构建了一个新的Deferred对象，但是返回的的是经过promise()方法处理后的，返回的是一个受限的promise对象 所以整个then方法就处理了2个事情\n构建一个新的deferred对象，返回受限的promise对象 给父deferred对象的[ done | fail | progress ]方法都增加一个过滤函数的方法  我们知道defer.then方法返回的是一个新的jQuery.Deferred().promise()对象\n那么我们把defer.then返回的称之为子对象,那么如何与父对象 var defer = $.Deferred() 关联的起来的 我看看源码\ndeferred[ tuple[1] ](//过滤函数//)  deferred其实就是根级父对象的引用,所以就嵌套再深,其实都是调用了父对象deferred[ done | fail | progress 执行add罢了 从图中就能很明显的看到 2个不同的deferred对象中 done fail progress分别都保存了不同的处理回调了  deferred.resolve( args )  当延迟对象被 resolved 时，任何通过 deferred.then 或 deferred.done  添加的 doneCallbacks，都会被调用  回调函数的执行顺序和它们被添加的顺序是一样的 传递给 deferred.resolve() 的 args 参数，会传给每个回调函数  当延迟对象进入 resolved 状态后，再添加的任何 doneCallbacks，当它们被添加时，就会被立刻执行，并带上传入给 .resolve() 的参数   流程如图\n流程解析：\n1 执行fire()方法，递归执行list所有包含的处理方法\n2 执行了默认的 changeState, disable, lock 方法、\n3 执行过滤函数\n根据 var returned = fn.apply( this, arguments )的返回值(称作returnReferred)是否是deferred对象 返回值是deferred对象，那么在returnReferred对象的三个回调函数列表中添加newDeferred的resolve(reject,notify)方法，也就是说newDeferrred的执行依赖returnDeferred的状态  不是函数的情况（如值为undefined或者null等），直接链接到newDeferred的resolve(reject,notify)方法，也就是说 newDeferrred的执行依赖外层的调用者deferred的状态或者说是执行动作（resolve还是reject或者是notify） 此时deferred.then()相当于将自己的callbacklist和newDeferred的callbacklist连接起来    下面就是嵌套deferred对象的划分了\n 源码还是要靠自己去折腾的\n思想的提高比较难的，我们可以借鉴设计的思路，代码书写方式都是有益无害的\n流程的分析已经比较透彻了，下一章在讲解when的实现\n写这东西太耗精力了，如果对您有帮助，请点击  推荐支持  一下……………  非常感谢《 jQuery 2.0.3 源码分析 Deferred（最细的实现剖析，带图）》转载文章和Aaron的教程图示，如对你有用，请推荐一把。 阅读原文\n $(function(){ $('img').each(function(index,element){ if($(this).attr('alt') == '复制代码'){ $(this).hide(); } }); });  ","permalink":"http://bingerambo.com/2016-08-03-javascript-design-02/","tags":["JS"],"title":"JavaScript 模式设计-02"},{"categories":["JS"],"contents":" \u0026ldquo;The key is to acknowledge from the start that you have no idea how this will grow. When you accept that you don\u0026rsquo;t know everything, you begin to design the system defensively. You identify the key areas that may change, which often is very easy when you put a little bit of time into it. For instance, you should expect that any part of the app that communicates with another system will likely change, so you need to abstract that away.\u0026rdquo; ——一切皆可变，所以要抽象。\n 模块论  大家可能都或多或少地使用了模块化的代码，模块是一个完整的强健程序架构的一部分，每个模块都是为了单独的目的为创建的，回到Gmail，我们来个例子，chat聊天模块看起来是个单独的一部分，其实它是有很多单独的子模块来构成，例如里面的表情模块其实就是单独的子模块，也被用到了发送邮件的窗口上。 另外一个是模块可以动态加载，删除和替换。 在JavaScript里，我们有几种方式来实现模块，大家熟知的是module模式和对象字面量,如果你已经熟悉这些，请忽略此小节，直接跳到CommonJS部分。 Module模式 module模式是一个比较流行的设计模式，它可以通过大括号封装私有的变量，方法，状态的，通过包装这些内容，一般全局的对象不能直接访问，在这个设计模式里，只返回一个API，其它的内容全部被封装成私有的了。 另外，这个模式和自执行的函数表达式比较相似，唯一的不同是module返回的是对象，而自执行函数表达式返回的是function。 众所周知， JavaScript不想其它语言一样有访问修饰符，不能为每个字段或者方法声明private,public修饰符，那这个模式我们是如何实现的呢？那就是return一个对象，里面包括一些公开的方法，这些方法有能力去调用内部的对象。 看一下，下面的代码，这段代码是一个自执行代码，声明里包括了一个全局的对象basketModule， basket数组是一个私有的，所以你的整个程序是不能访问这个私有数组的，同时我们return了一个对象，其内包含了3个方法（例如addItem,getItemCount,getTotal)，这3个方法可以访问私有的basket数组。 var basketModule = (function() {\nvar basket = []; //privatereturn { //exposed to public　addItem: function(values) {\nbasket.push(values);\n},\ngetItemCount: function() {\nreturn basket.length;\n},\ngetTotal: function(){\nvar q = this.getItemCount(),p=0;\nwhile(q--){\np+= basket[q].price;\n}\nreturn p;\n}\n}\n}());   同时注意，我们return的对象直接赋值给了basketModule，所以我们可以像下面一样使用： //basketModule is an object with properties which can also be methodsbasketModule.addItem({item:'bread',price:0.5});\nbasketModule.addItem({item:'butter',price:0.3});\nconsole.log(basketModule.getItemCount());\nconsole.log(basketModule.getTotal());\n//however, the following will not work:console.log(basketModule.basket);//(undefined as not inside the returned object)console.log(basket); //(only exists within the scope of the closure)   那在各个流行的类库（如Dojo, jQuery)里是如何来做呢？  Dojo   Dojo试图使用dojo.declare来提供class风格的声明方式，我们可以利用它来实现Module模式，例如如果你想再store命名空间下声明basket对象，那么可以这么做：  //traditional way var store = window.store || {};\nstore.basket = store.basket || {};\n//using dojo.setObject dojo.setObject(\"store.basket.object\", (function() {\nvar basket = [];\nfunction privateMethod() {\nconsole.log(basket);\n}\nreturn {\npublicMethod: function(){\nprivateMethod();\n}\n};\n}()));  结合dojo.provide一起来使用，非常强大。\n YUI 下面的代码是YUI原始的实现方式：\nYAHOO.store.basket = function () {\n//\"private\" variables: var myPrivateVar = \"I can be accessed only within YAHOO.store.basket .\";\n//\"private\" method: var myPrivateMethod = function () {\nYAHOO.log(\"I can be accessed only from within YAHOO.store.basket\");\n}\nreturn {\nmyPublicProperty: \"I'm a public property.\",\nmyPublicMethod: function () {\nYAHOO.log(\"I'm a public method.\");\n//Within basket, I can access \"private\" vars and methods: YAHOO.log(myPrivateVar);\nYAHOO.log(myPrivateMethod());\n//The native scope of myPublicMethod is store so we can //access public members using \"this\": YAHOO.log(this.myPublicProperty);\n}\n};\n} ();  \u0026nbsp;\n jQuery  jQuery里有很多Module模式的实现，我们来看一个不同的例子，一个library函数声明了一个新的library，然后创建该library的时候，在document.ready里自动执行init方法。 function library(module) {\n$(function() {\nif (module.init) {\nmodule.init();\n}\n});\nreturn module;\n}\nvar myLibrary = library(function() {\nreturn {\ninit: function() {\n/*implementation*/\n}\n};\n}());   对象自面量 对象自面量使用大括号声明，并且使用的时候不需要使用new关键字，如果对一个模块里的属性字段的publice/private不是很在意的话，可以使用这种方式，不过请注意这种方式和JSON的不同。对象自面量： var item={name: \"tom\", value:123}  JSON: var item={\"name\":\"tom\", \"value\":123} 。 var myModule = {\nmyProperty: 'someValue',\n//object literals can contain properties and methods. //here, another object is defined for configuration //purposes: myConfig: {\nuseCaching: true,\nlanguage: 'en'\n},\n//a very basic method myMethod: function () {\nconsole.log('I can haz functionality?');\n},\n//output a value based on current configuration myMethod2: function () {\nconsole.log('Caching is:' + (this.myConfig.useCaching) ? 'enabled' : 'disabled');\n},\n//override the current configuration myMethod3: function (newConfig) {\nif (typeof newConfig == 'object') {\nthis.myConfig = newConfig;\nconsole.log(this.myConfig.language);\n}\n}\n};\nmyModule.myMethod(); //I can haz functionalitymyModule.myMethod2(); //outputs enabledmyModule.myMethod3({ language: 'fr', useCaching: false }); //fr   CommonJS 关于 CommonJS的介绍，这里就不多说了，博客园有很多帖子都有介绍，我们这里要提一下的是CommonJS标准里里有2个重要的参数exports和require，exports是代表要加载的模块，require是代表这些加载的模块需要依赖其它的模块，也需要将它加载进来。  /*Example of achieving compatibility with AMD and standard CommonJS by putting boilerplate around the standard CommonJS module format:\n*/\n(function(define){\ndefine(function(require,exports){\n//module contents var dep1 = require(\"dep1\");\nexports.someExportedFunction = function(){...};\n//... });\n})(typeof define==\"function\"?define:function(factory){factory(require,exports)});   有很多CommonJS标准的模块加载实现，我比较喜欢的是RequireJS，它能否非常好的加载模块以及相关的依赖模块，来一个简单的例子，例如需要将图片转化成ASCII码，我们先加载encoder模块，然后获取他的encodeToASCII方法，理论上代码应该是如下：  var encodeToASCII = require(\"encoder\").encodeToASCII;\nexports.encodeSomeSource = function(){\n//其它操作以后，然后调用encodeToASCII }   但是上述代码并没用工作，因为encodeToASCII函数并没用附加到window对象上，所以不能使用，改进以后的代码需要这样才行：  define(function(require, exports, module) {\nvar encodeToASCII = require(\"encoder\").encodeToASCII;\nexports.encodeSomeSource = function(){\n//process then call encodeToASCII }\n});  CommonJS 潜力很大，但是由于大叔不太熟，所以就不过多地介绍了。\nFacade模式  Facade模式在本文架构里占有重要角色，关于这个模式很多JavaScript类库或者框架里都有体现，其中最大的作用，就是包括High level的API，以此来隐藏具体的实现，这就是说，我们只暴露接口，内部的实现我们可以自己做主，也意味着内部实现的代码可以很容易的修改和更新，比如今天你是用jQuery来实现的，明天又想换YUI了，这就非常方便了。 下面这个例子了，可以看到我们提供了很多私有的方法，然后通过暴露一个简单的 API来让外界执行调用内部的方法：\nvar module = (function () {\nvar _private = {\ni: 5,\nget: function () {\nconsole.log('current value:' + this.i);\n},\nset: function (val) {\nthis.i = val;\n},\nrun: function () {\nconsole.log('running');\n},\njump: function () {\nconsole.log('jumping');\n}\n};\nreturn {\nfacade: function (args) {\n_private.set(args.val);\n_private.get();\nif (args.run) {\n_private.run();\n}\n}\n}\n} ());\nmodule.facade({run:true,val:10});//outputs current value: 10, running   Facade和下面我们所说的mediator的区别是，facade只提供现有存在的功能，而mediator可以增加新功能。 \u0026nbsp;\nMediator模式  讲modiator之前，我们先来举个例子，机场飞行控制系统，也就是传说中的塔台，具有绝对的权利，他可以控制任何一架飞机的起飞和降落时间以及地方，而飞机和飞机之前不允许通信，也就是说塔台是机场的核心，mediator就相当于这个塔台。  mediator就是用在程序里有多个模块，而你又不想让各个模块有依赖的话，那通过mediator模式可以达到集中控制的目的。实际场景中也是，mediator封装了很多不想干的模块，让他们通过mediator联系在一起，同时也松耦合他们，使得他们之间必须通过mediator才能通信。  那mediator模式的优点是什么？那就是解耦，如果你之前对观察者模式比较了解的话，那理解下面的mediator图就相对简单多了，下图是一个high level的mediator模式图：  想想一下，各模块是发布者，mediator既是发布者又是订阅者。\n Module 1向Mediator广播一个实际，说需要做某事  Mediator捕获消息以后，立即启动处理该消息需要使用的Module 2，Module 2处理结束以后返回信息给Mediator   与此同时，Mediator也启动了Module 3，当接受Module 2 返回消息的时候自动记录日志到Module 3里    可以看到，各模块之间并没有通信，另外Mediator也可以实现监控各模块状态的功能，例如如果Module 3出错了，Mediator可以暂时只想其它模块，然后重启Module 3，然后继续执行。  回顾一下，可以看到，Mediator的优点是：松耦合的模块由同一的Mediator来控制，模块只需要广播和监听事件就可以了，而模块之间不需要直接联系，另外，一次信息的处理可以使用多个模块，也方便我们以后统一的添加新的模块到现有的控制逻辑里。 确定是：由于所有的模块直接都不能直接通信，所有相对来说，性能方面可能会有少许下降，但是我认为这是值得的。\n\u0026nbsp;\n我们根据上面的讲解来一个简单的Demo：\n var mediator = (function(){\nvar subscribe = function(channel, fn){\nif (!mediator.channels[channel]) mediator.channels[channel] = [];\nmediator.channels[channel].push({ context: this, callback: fn });\nreturn this;\n},\npublish = function(channel){\nif (!mediator.channels[channel]) return false;\nvar args = Array.prototype.slice.call(arguments, 1);\nfor (var i = 0, l = mediator.channels[channel].length; i \u0026lt; l; i++) {\nvar subscription = mediator.channels[channel][i];\nsubscription.callback.apply(subscription.context, args);\n}\nreturn this;\n};\nreturn {\nchannels: {},\npublish: publish,\nsubscribe: subscribe,\ninstallTo: function(obj){\nobj.subscribe = subscribe;\nobj.publish = publish;\n}\n};\n}());  然后有2个模块分别调用：\n //Pub/sub on a centralized mediator mediator.name = \"tim\";\nmediator.subscribe('nameChange', function(arg){\nconsole.log(this.name);\nthis.name = arg;\nconsole.log(this.name);\n});\nmediator.publish('nameChange', 'david'); //tim, david //Pub/sub via third party mediator var obj = { name: 'sam' };\nmediator.installTo(obj);\nobj.subscribe('nameChange', function(arg){\nconsole.log(this.name);\nthis.name = arg;\nconsole.log(this.name);\n});\nobj.publish('nameChange', 'john'); //sam, john   应用Facade: 应用程序核心的抽象   一个facade是作为应用程序核心的一个抽象来工作的，在mediator和模块之间负责通信，各个模块只能通过这个facade来和程序核心进行通信。作为抽象的职责是确保任何时候都能为这些模块提供一个始终如一的接口（consistent interface），和sendbox controller的角色比较类似。所有的模块组件通过它和mediator通信，所以facade需要是可靠的，可信赖的，同时作为为模块提供接口的功能，facade还需要扮演另外一个角色，那就是安全控制，也就是决定程序的哪个部分可以被一个模块访问，模块组件只能调用他们自己的方法，并且不能访问任何未授权的内容。例如，一个模块可能广播dataValidationCompletedWriteToDB，这里的安全检查需要确保该模块拥有数据库的写权限。  总之，mediator只有在facade授权检测以后才能进行信息处理。 应用Mediator：应用程序的核心  Mediator是作为应用程序核心的角色来工作的，我们简单地来说一下他的职责。最核心的工作就是管理模块的生命周期（lifecycle），当这个核心扑捉到任何信息进来的时候，他需要判断程序如何来处理\u0026mdash;\u0026mdash;也就是说决定启动或停止哪一个或者一些模块。当一个模块开始启动的时候，它应该能否自动执行，而不需要应用程序核心来决定是否该执行（比如，是否要在DOM ready的时候才能执行），所以说需要模块自身需要去判定。 你可能还有问题，就是一个模块在什么情况下才会停止。当程序探测到一个模块失败了，或者是出错了，程序需要做决定来防止继续执行该模块里的方法，以便这个组件可以重新启动，目的主要是提高用户体验。 另外，该核心应该可以动态添加或者删除模块，而不影响其他任何功能。常见的例子是，一个模块在页面加载初期是不可用，但是用户操作以后，需要动态加载这个模块然后执行，就像Gmail里的chat聊天功能一样，从性能优化的目的来看，应该是很好理解的吧。 异常错误处理，也是由应用程序核心来处理的，另外各模块在广播信息的时候，也广播任何错误到该核心里，以便程序核心可以根据情况去停止/重启这些模块。这也是松耦合架构一个很重要的部分，我们不需要手工改变任何模块，通过mediator使用发布/订阅就可以来做到这个。 组装起来  各模块 包含了程序里各种各样的功能，他们有信息需要处理的时候，发布信息通知程序（这是他们的主要职责），下面的QA小节里提到了，模块可以依赖一些DOM工具操作方法，但是不应该和系统的其它模块有依赖，一个模块不应该关注如下内容：  哪个对象或者模块订阅了这个模块发布的信息 这些对象是客户端对象还是服务器端对象 多少对象订阅了你的信息  \u0026nbsp;\n  Facade抽象 应用程序的核心，避免各个模块之间直接通信，它从各模块上订阅信息，也负责授权检测，确保每个模块有用自己单独的授权。   Mediator(应用程序核心）使用mediator模式扮演发布/订阅管理器的角色，负责模块管理以及启动/停止模块执行，可以动态加载以及重启有错误的模块。   这个架构的结果是：各模块之间没有依赖，因为松耦合的应用，它们可以很容易地被测试和维护，各模块可以很容易地在其它项目里被重用，也可以在不影响程序的情况下动态添加和删除。  感谢Nicholas Zakas的原始贴，将思想总结在一起,感谢Andree Hansson的technical review,感谢Rebecca Murphey, Justin Meyer, John Hann, Peter Michaux, Paul Irish和Alex Sexton,他们所有的人都提供了和本Session相关的很多资料。\n也非常感谢博客园的汤姆大叔(TomXu），将本Session的内容整理成中文版本，如对你有用，请推荐一把。 阅读原文\n","permalink":"http://bingerambo.com/2016-07-11-javascript-design-01/","tags":["JS"],"title":"JavaScript 模式设计-01"},{"categories":null,"contents":"随笔杂记  :(fas fa-sync fa-spin): 记点滴✒️，积跬步💪   2020-12-11 kubernetes 源码分析 参考电子书目\nkubernetes k8s源码分析\n2018-07-27 开启新的征程。。。\n2017-03-25 深度学习，看论文的速度赶不上出论文的速度。\n2016-08-01 在这座喧嚣的城市，每天低头的忙碌，浮躁的心情，使得渐渐不再关心身边的人，慢慢不再留意周遭景物。而Tuantuan.G的随笔图文，以发现美的心灵，撷取了这座城和你我身边的美丽片景。。。\n2016-07-09 小站开张了😆。。。\n","permalink":"http://bingerambo.com/notes/","tags":null,"title":"随记"},{"categories":["生活"],"contents":"开博了，等你来\n “只有初恋般的热情和宗教般的意志，人才可能成就某种事业。” ——路遥\n 前言 Binge Blog 终于慢腾腾地开通了。。。\n两年前就想搭个站玩玩，结果各种原因未能实现。\n直到今年，这种想法日益强烈，光说不干假把式，于是，利用两个周末时间，完成自己的小站。\n这样，能有个地儿可以折腾点自己的东西，还是蛮有意思的。\n正所谓：站不在大，好玩就中！\n 正文 关于小站：\n1. 找空间  稳定； 大，大，大； 便于管理； 要流行； 要时尚； \u0026hellip;\u0026hellip;  于是，我选择了Octocat。。。\n注：Octocat（章鱼猫）＝ Octopus（章鱼）+ Cat（猫）\n2. 注册域名   刚开始，在godaddy注册了域名。没有VISA和paypal不要紧，可使用alipay支付宝。 用了两三天，便收到了godaddy的邮件通知：将要收回域名，付款将会全额退还。具体原因，此处不赘述。最后，收到退款，免费玩了三天域名。\n  分享下godaddy域名使用体会：\n 优点：  com域名免认证，可快速生效； 可以使用优惠码，价格有优惠；   缺点：  国内会出现无法解析的问题，需要自己动手解决； 会公开域名注册人的信息（包括联系电话），如果想要隐私保护，需要额外付费才能享受信息保护服务。 以前的价格优势已无，对于部分域名注册费用还要比国内贵得多；      后来，就在万网注册个域名。com域名带认证，不到半天就搞定。\n  分享下万网域名使用体会：\n 流程简单，配置方便； 阿里云解析，生效速度很快。比如一些免认证的域名，一两分钟就能生效使用； 域名购买后，有账单发票，且有域名证书图片。便于用户声明域名所有权。    小站域名：\n bingerambo.com：外号binge名称域名已被国外注册。想起《第一滴血》里史泰龙扮演的硬汉兰博。于是就再加上rambo,便有了bingerambo。    3. 内容  自己整理：笔记和感想，有关技术、阅读、兴趣和其它杂谈。希望积跬步，致千里。 好友原创：好友写的文章，分享到小站。 欢迎投稿：文章、图片都可。 如果您的原创和投稿，入驻小站，都是小编我的荣幸。  4. 友情链接介绍   Tuantuan.G：是设计师，也是小伙伴。有想法，有理念。爱画画，有创意。从视觉设计，到UI平面。哪怕通宵达旦，也要设计漂亮。。。去她那里逛逛吧：@Tuantuan.G\n  索洪波：是程序员，也是段子手，低调深刻有内涵。去他的小站看看吧：@索洪波\n  后记 小站发布，记录点滴生活。。。\n  特别感谢 [Tuantuan.G]，在百忙之余，提供了丰富的图片素材。让我方便修图，配图攒文。同时，也对小站的完善提出了宝贵建议，并分享其原创作品。\n  感谢看到这里的你。。。\n   最后，希望来这儿逛的你，好心情~~~\n","permalink":"http://bingerambo.com/2016-07-09-hello-binge-blog/","tags":["生活"],"title":"Welcome to Binge Blog"},{"categories":null,"contents":"自言   偶尔复制点代码，偶尔鼓捣些东西。\n花鸟鱼虫，稀松不通。\n文明精神，野蛮体魄。\n借我三千虎贲，踏破贺兰山缺。\n  我是术业不精的运动程序猿，搭个小站，随写心得。欢迎大家来逛~~~ o(∩_∩)o     ","permalink":"http://bingerambo.com/about/","tags":null,"title":"关于"},{"categories":null,"contents":"\n","permalink":"http://bingerambo.com/search/","tags":null,"title":"Search"}]